!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var n=t();for(var r in n)("object"==typeof exports?exports:e)[r]=n[r]}}(window,(function(){return function(e){var t=window.webpackHotUpdate;window.webpackHotUpdate=function(e,n){!function(e,t){if(!y[e]||!S[e])return;for(var n in S[e]=!1,t)Object.prototype.hasOwnProperty.call(t,n)&&(f[n]=t[n]);0==--m&&0===b&&T()}(e,n),t&&t(e,n)};var n,r=!0,i="37a40b406cf59715ddc8",o={},s=[],a=[];function c(e){var t=A[e];if(!t)return P;var r=function(r){return t.hot.active?(A[r]?-1===A[r].parents.indexOf(e)&&A[r].parents.push(e):(s=[e],n=r),-1===t.children.indexOf(r)&&t.children.push(r)):(console.warn("[HMR] unexpected require("+r+") from disposed module "+e),s=[]),P(r)},i=function(e){return{configurable:!0,enumerable:!0,get:function(){return P[e]},set:function(t){P[e]=t}}};for(var o in P)Object.prototype.hasOwnProperty.call(P,o)&&"e"!==o&&"t"!==o&&Object.defineProperty(r,o,i(o));return r.e=function(e){return"ready"===d&&h("prepare"),b++,P.e(e).then(t,(function(e){throw t(),e}));function t(){b--,"prepare"===d&&(_[e]||C(e),0===b&&0===m&&T())}},r.t=function(e,t){return 1&t&&(e=r(e)),P.t(e,-2&t)},r}function u(e){var t={_acceptedDependencies:{},_declinedDependencies:{},_selfAccepted:!1,_selfDeclined:!1,_disposeHandlers:[],_main:n!==e,active:!0,accept:function(e,n){if(void 0===e)t._selfAccepted=!0;else if("function"==typeof e)t._selfAccepted=e;else if("object"==typeof e)for(var r=0;r<e.length;r++)t._acceptedDependencies[e[r]]=n||function(){};else t._acceptedDependencies[e]=n||function(){}},decline:function(e){if(void 0===e)t._selfDeclined=!0;else if("object"==typeof e)for(var n=0;n<e.length;n++)t._declinedDependencies[e[n]]=!0;else t._declinedDependencies[e]=!0},dispose:function(e){t._disposeHandlers.push(e)},addDisposeHandler:function(e){t._disposeHandlers.push(e)},removeDisposeHandler:function(e){var n=t._disposeHandlers.indexOf(e);n>=0&&t._disposeHandlers.splice(n,1)},check:E,apply:w,status:function(e){if(!e)return d;l.push(e)},addStatusHandler:function(e){l.push(e)},removeStatusHandler:function(e){var t=l.indexOf(e);t>=0&&l.splice(t,1)},data:o[e]};return n=void 0,t}var l=[],d="idle";function h(e){d=e;for(var t=0;t<l.length;t++)l[t].call(null,e)}var p,f,g,m=0,b=0,_={},S={},y={};function v(e){return+e+""===e?+e:e}function E(e){if("idle"!==d)throw new Error("check() is only allowed in idle status");return r=e,h("check"),(t=1e4,t=t||1e4,new Promise((function(e,n){if("undefined"==typeof XMLHttpRequest)return n(new Error("No browser support"));try{var r=new XMLHttpRequest,o=P.p+""+i+".hot-update.json";r.open("GET",o,!0),r.timeout=t,r.send(null)}catch(e){return n(e)}r.onreadystatechange=function(){if(4===r.readyState)if(0===r.status)n(new Error("Manifest request to "+o+" timed out."));else if(404===r.status)e();else if(200!==r.status&&304!==r.status)n(new Error("Manifest request to "+o+" failed."));else{try{var t=JSON.parse(r.responseText)}catch(e){return void n(e)}e(t)}}}))).then((function(e){if(!e)return h("idle"),null;S={},_={},y=e.c,g=e.h,h("prepare");var t=new Promise((function(e,t){p={resolve:e,reject:t}}));f={};return C(0),"prepare"===d&&0===b&&0===m&&T(),t}));var t}function C(e){y[e]?(S[e]=!0,m++,function(e){var t=document.createElement("script");t.charset="utf-8",t.src=P.p+""+e+"."+i+".hot-update.js",document.head.appendChild(t)}(e)):_[e]=!0}function T(){h("ready");var e=p;if(p=null,e)if(r)Promise.resolve().then((function(){return w(r)})).then((function(t){e.resolve(t)}),(function(t){e.reject(t)}));else{var t=[];for(var n in f)Object.prototype.hasOwnProperty.call(f,n)&&t.push(v(n));e.resolve(t)}}function w(t){if("ready"!==d)throw new Error("apply() is only allowed in ready status");var n,r,a,c,u;function l(e){for(var t=[e],n={},r=t.slice().map((function(e){return{chain:[e],id:e}}));r.length>0;){var i=r.pop(),o=i.id,s=i.chain;if((c=A[o])&&!c.hot._selfAccepted){if(c.hot._selfDeclined)return{type:"self-declined",chain:s,moduleId:o};if(c.hot._main)return{type:"unaccepted",chain:s,moduleId:o};for(var a=0;a<c.parents.length;a++){var u=c.parents[a],l=A[u];if(l){if(l.hot._declinedDependencies[o])return{type:"declined",chain:s.concat([u]),moduleId:o,parentId:u};-1===t.indexOf(u)&&(l.hot._acceptedDependencies[o]?(n[u]||(n[u]=[]),p(n[u],[o])):(delete n[u],t.push(u),r.push({chain:s.concat([u]),id:u})))}}}}return{type:"accepted",moduleId:e,outdatedModules:t,outdatedDependencies:n}}function p(e,t){for(var n=0;n<t.length;n++){var r=t[n];-1===e.indexOf(r)&&e.push(r)}}t=t||{};var m={},b=[],_={},S=function(){console.warn("[HMR] unexpected require("+C.moduleId+") to disposed module")};for(var E in f)if(Object.prototype.hasOwnProperty.call(f,E)){var C;u=v(E);var T=!1,w=!1,O=!1,x="";switch((C=f[E]?l(u):{type:"disposed",moduleId:E}).chain&&(x="\nUpdate propagation: "+C.chain.join(" -> ")),C.type){case"self-declined":t.onDeclined&&t.onDeclined(C),t.ignoreDeclined||(T=new Error("Aborted because of self decline: "+C.moduleId+x));break;case"declined":t.onDeclined&&t.onDeclined(C),t.ignoreDeclined||(T=new Error("Aborted because of declined dependency: "+C.moduleId+" in "+C.parentId+x));break;case"unaccepted":t.onUnaccepted&&t.onUnaccepted(C),t.ignoreUnaccepted||(T=new Error("Aborted because "+u+" is not accepted"+x));break;case"accepted":t.onAccepted&&t.onAccepted(C),w=!0;break;case"disposed":t.onDisposed&&t.onDisposed(C),O=!0;break;default:throw new Error("Unexception type "+C.type)}if(T)return h("abort"),Promise.reject(T);if(w)for(u in _[u]=f[u],p(b,C.outdatedModules),C.outdatedDependencies)Object.prototype.hasOwnProperty.call(C.outdatedDependencies,u)&&(m[u]||(m[u]=[]),p(m[u],C.outdatedDependencies[u]));O&&(p(b,[C.moduleId]),_[u]=S)}var R,I=[];for(r=0;r<b.length;r++)u=b[r],A[u]&&A[u].hot._selfAccepted&&I.push({module:u,errorHandler:A[u].hot._selfAccepted});h("dispose"),Object.keys(y).forEach((function(e){!1===y[e]&&function(e){delete installedChunks[e]}(e)}));for(var N,M,D=b.slice();D.length>0;)if(u=D.pop(),c=A[u]){var L={},k=c.hot._disposeHandlers;for(a=0;a<k.length;a++)(n=k[a])(L);for(o[u]=L,c.hot.active=!1,delete A[u],delete m[u],a=0;a<c.children.length;a++){var U=A[c.children[a]];U&&((R=U.parents.indexOf(u))>=0&&U.parents.splice(R,1))}}for(u in m)if(Object.prototype.hasOwnProperty.call(m,u)&&(c=A[u]))for(M=m[u],a=0;a<M.length;a++)N=M[a],(R=c.children.indexOf(N))>=0&&c.children.splice(R,1);for(u in h("apply"),i=g,_)Object.prototype.hasOwnProperty.call(_,u)&&(e[u]=_[u]);var V=null;for(u in m)if(Object.prototype.hasOwnProperty.call(m,u)&&(c=A[u])){M=m[u];var B=[];for(r=0;r<M.length;r++)if(N=M[r],n=c.hot._acceptedDependencies[N]){if(-1!==B.indexOf(n))continue;B.push(n)}for(r=0;r<B.length;r++){n=B[r];try{n(M)}catch(e){t.onErrored&&t.onErrored({type:"accept-errored",moduleId:u,dependencyId:M[r],error:e}),t.ignoreErrored||V||(V=e)}}}for(r=0;r<I.length;r++){var j=I[r];u=j.module,s=[u];try{P(u)}catch(e){if("function"==typeof j.errorHandler)try{j.errorHandler(e)}catch(n){t.onErrored&&t.onErrored({type:"self-accept-error-handler-errored",moduleId:u,error:n,originalError:e}),t.ignoreErrored||V||(V=n),V||(V=e)}else t.onErrored&&t.onErrored({type:"self-accept-errored",moduleId:u,error:e}),t.ignoreErrored||V||(V=e)}}return V?(h("fail"),Promise.reject(V)):(h("idle"),new Promise((function(e){e(b)})))}var A={};function P(t){if(A[t])return A[t].exports;var n=A[t]={i:t,l:!1,exports:{},hot:u(t),parents:(a=s,s=[],a),children:[]};return e[t].call(n.exports,n,n.exports,c(t)),n.l=!0,n.exports}return P.m=e,P.c=A,P.d=function(e,t,n){P.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},P.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},P.t=function(e,t){if(1&t&&(e=P(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(P.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)P.d(n,r,function(t){return e[t]}.bind(null,r));return n},P.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return P.d(t,"a",t),t},P.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},P.p="/dist",P.h=function(){return i},c(28)(P.s=28)}([function(e,t,n){"use strict";var r,i,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.VxError=void 0;var s=n(1),a=n(2);t.VxError=function(e){function t(n){for(var r=[],i=1;i<arguments.length;i++)r[i-1]=arguments[i];var o=this,a=t.codeToMessage(n);if((o=e.call(this,a)||this).code=n,o.name="Error",t.captureStackTrace)t.captureStackTrace(o,o.constructor);else{var c=new Error;c.stack&&(o.stack=c.stack)}var u=0;return n==t.CODE.EPARAMTYPE||n==t.CODE.EPARAMVALUE||n==t.CODE.EINCONSISTPARAMS?(++u,r.length>=0&&(r[1],1)&&(o._parameter=r[1])):n!=t.CODE.EMISSINGPROP&&n!=t.CODE.EPROPTYPE&&n!=t.CODE.EPROPVALUE||(++u,r.length>=1&&(r[1],1)&&(o._property=r[1])),n!=t.CODE.EPARAMTYPE&&n!=t.CODE.EPROPTYPE||(++u,r.length>=1&&(r[1],1)&&(o._typeExpected=r[1])),n==t.CODE.ESTATE&&(++u,r.length>=1&&(r[0],1)&&(o._stateDescription=r[0])),r.length>=u&&(r[u],1)&&(o._point=r[u]),++u,r.length>=u&&(r[u],1)&&(o._subsystemId=r[u]),++u,r.length>=u&&(r[u],1)&&(o._notes=r[u]),o._subsystemId&&s.Logger.loggerInfo&&s.Logger.log(o._subsystemId,o.extendedMessage),console&&console.log&&console.log("Error dump",o),Object.setPrototypeOf(o,t.prototype),o}return o(t,e),Object.defineProperty(t.prototype,"extendedMessage",{get:function(){return this._stateDescription&&(this._extendedMessage+=" ("+this._stateDescription+")"),this._point&&(this._extendedMessage+=" at "+this._point),this._parameter&&(this._extendedMessage+=", parameter is "+this._parameter),this._property&&(this._extendedMessage+=", property is "+this._property),this._typeExpected&&(this._extendedMessage+=", "+this._typeExpected+" expected"),this._notes&&(this._extendedMessage+=" ("+this._notes+")"),this._extendedMessage},enumerable:!1,configurable:!0}),t.prototype.toString=function(){var e=a.Tools.findKeyByValue(t.CODE,this.code);return this.name+(e?" ["+e+"]: ":": ")+this.extendedMessage},t.prototype.toErrorObject=function(){return{code:this.code,point:this._point,parameter:this._parameter,property:this._property,typeExpected:this._typeExpected,notes:this._notes,subsystemId:this._subsystemId}},t.codeToMessage=function(e){return e<t.CODE._MIN||e>t.CODE._MAX||!t.MESSAGE.hasOwnProperty(e)?t.MESSAGE[t.CODE.EUNKNOWN]:t.MESSAGE[e]},t.CODE=Object.create(Object.prototype,{_MIN:{value:0,writable:!1,configurable:!1,enumerable:!1},EUNKNOWN:{value:0,writable:!1,configurable:!1,enumerable:!0},ENUMPARAMS:{value:1,writable:!1,configurable:!1,enumerable:!0},EPARAMTYPE:{value:2,writable:!1,configurable:!1,enumerable:!0},EPARAMVALUE:{value:3,writable:!1,configurable:!1,enumerable:!0},EINCONSISTPARAMS:{value:4,writable:!1,configurable:!1,enumerable:!0},EMISSINGPROP:{value:5,writable:!1,configurable:!1,enumerable:!0},EPROPTYPE:{value:6,writable:!1,configurable:!1,enumerable:!0},EPROPVALUE:{value:7,writable:!1,configurable:!1,enumerable:!0},ESTATE:{value:8,writable:!1,configurable:!1,enumerable:!0},ECONSTRAINS:{value:9,writable:!1,configurable:!1,enumerable:!0},_MAX:{value:9,writable:!1,configurable:!1,enumerable:!1}}),t.MESSAGE=Object.create(Object.prototype,((i={})[t.CODE.EUNKNOWN]={value:"unknown error",writable:!1,configurable:!1,enumerable:!0},i[t.CODE.ENUMPARAMS]={value:"incorrect number of parameters",writable:!1,configurable:!1,enumerable:!0},i[t.CODE.EPARAMTYPE]={value:"unexpected parameter type",writable:!1,configurable:!1,enumerable:!0},i[t.CODE.EPARAMVALUE]={value:"invalid parameter value",writable:!1,configurable:!1,enumerable:!0},i[t.CODE.EINCONSISTPARAMS]={value:"inconsistent parameters",writable:!1,configurable:!1,enumerable:!0},i[t.CODE.EMISSINGPROP]={value:"required property not set",writable:!1,configurable:!1,enumerable:!0},i[t.CODE.EPROPTYPE]={value:"unexpected property type",writable:!1,configurable:!1,enumerable:!0},i[t.CODE.EPROPVALUE]={value:"invalid property value",writable:!1,configurable:!1,enumerable:!0},i[t.CODE.ESTATE]={value:"call in unexpected state",writable:!1,configurable:!1,enumerable:!0},i[t.CODE.ECONSTRAINS]={value:"internal constrains violation",writable:!1,configurable:!1,enumerable:!0},i)),t.captureStackTrace=Error.captureStackTrace,t}(Error)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Logger=void 0,n(29);var r=function(){function e(){}return e.log=function(t,n){if(e.loggerInfo){var r=new Date;e.loggerInfo(r,t,n)}},e.logTraffic=function(t){if(e.loggerTraf){var n=(new Date).toUTCString();e.loggerTraf(n+" "+t)}},e.logXmppError=function(t,n,r){var i=r||"",o=n.getElementsByTagName("error");if(o&&o.length>0){var s=o[0].getAttribute("code"),a=o[0].innerHTML,c={};s&&(i.length>0&&(i+=", "),i+="error code = "+s,c.code=s),a&&(i.length>0&&(i+=", "),i+="error data = "+a,c.data=a)}e.log(t,i)},e.trace=function(){var e=void 0;if(Error.captureStackTrace){var t={};Error.captureStackTrace(t),t.stack&&(e=t.stack)}if(!e){var n=Error();n.stack&&(e=n.stack)}if(e){var r=e.split("\n"),i=("Error"==r[0]||-1===r[0].indexOf("@")&&-1===r[0].indexOf("at")?r[2]:r[1]).trim();console.log("TRACE: "+i)}},e}();t.Logger=r},function(e,t,n){"use strict";var r=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(t,"__esModule",{value:!0}),t.Tools=void 0;var i=n(7),o=n(0);t.Tools={getRandomInt:function(e,t){return void 0===e&&(e=0),void 0===t&&(t=Number.MAX_SAFE_INTEGER),Math.floor(Math.random()*(t-e+1))+e},getRandomString:function(e){for(var t,n="";n.length<e;)n+=(t=void 0,(t=Math.floor(62*Math.random()))<10?t:t<36?String.fromCharCode(t+55):String.fromCharCode(t+61));return n},makeUuid:function(){function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()},createUniqueId:function(){return this.getRandomString(8)},nextInternalId:1,generateInternalId:function(){return this.nextInternalId++},isValidDomainName:function(e){return!(!e||"string"!=typeof e)&&!!e.match(/^(([A-Za-z0-9\-_]+)\.)+([A-Za-z]+)$/g)},validateAndFormatDomainName:function(e,n,r){if(!t.Tools.isValidDomainName(e))throw new o.VxError(o.VxError.CODE.EPARAMVALUE,"domain",n,r);return e.toLowerCase()},isValidIssuerName:function(e){return!(!e||"string"!=typeof e)&&!!e.match(/^[A-Za-z0-9\-_]+$/g)},validateIssuerName:function(e,n,r){if("string"!=typeof e)throw new o.VxError(o.VxError.CODE.EPARAMTYPE,"issuer","string",n,r);if(!t.Tools.isValidIssuerName(e))throw new o.VxError(o.VxError.CODE.EPARAMVALUE,"issuer",n,r)},isValidUserName:function(e){return!(!e||"string"!=typeof e)&&!!e.match(/^[A-Za-z0-9\-_]+$/g)},validateUserName:function(e,n,r){if("string"!=typeof e)throw new o.VxError(o.VxError.CODE.EPARAMTYPE,"userName","string",n,r);if(!t.Tools.isValidUserName(e))throw new o.VxError(o.VxError.CODE.EPARAMVALUE,"userName",n,r)},isValidChannelName:function(e){return!(!e||"string"!=typeof e)&&!!e.match(/^[A-Za-z0-9-]+$/g)},validateChannelName:function(e,n,r){if("string"!=typeof e)throw new o.VxError(o.VxError.CODE.EPARAMTYPE,"channelName","string",n,r);if(!t.Tools.isValidChannelName(e))throw new o.VxError(o.VxError.CODE.EPARAMVALUE,"channelName",n,r)},isValidChannelType:function(e){return e===i.ChannelSession.CHANTYPE.ECHO||e===i.ChannelSession.CHANTYPE.CONF},validateChannelType:function(e,n,r){if(typeof e!=typeof i.ChannelSession.CHANTYPE.CONF)throw new o.VxError(o.VxError.CODE.EPARAMTYPE,"channelType",typeof i.ChannelSession.CHANTYPE.CONF,n,r);if(!t.Tools.isValidChannelType(e))throw new o.VxError(o.VxError.CODE.EPARAMVALUE,"channelType",n,r)},isValidEnvironmentId:function(e){return!(!e||"string"!=typeof e)&&!!e.match(/^[A-Za-z0-9-_]+$/g)},validateEnvironmentId:function(e,n,r){if("string"!=typeof e)throw new o.VxError(o.VxError.CODE.EPARAMTYPE,"environmentId","string",n,r);if(!t.Tools.isValidEnvironmentId(e))throw new o.VxError(o.VxError.CODE.EPARAMVALUE,"environmentId",n,r)},isInteger:function(e){return"number"==typeof e?e>=0&&Math.trunc(e)===e:/^\d+$/.test(e)},isIntegerInRange:function(e,n,r){return t.Tools.isInteger(e)&&e>=n&&e<=r},isValidIpAddress:function(e){return/^(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/.test(e)},isValidHttpUri:function(e){return/^(?:(?:(?:https?|ftp):)?\/\/)(?:\S+(?::\S*)?@)?(?:(?!(?:10|127)(?:\.\d{1,3}){3})(?!(?:169\.254|192\.168)(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z0-9\u00a1-\uffff][a-z0-9\u00a1-\uffff_-]{0,62})?[a-z0-9\u00a1-\uffff]\.)+(?:[a-z\u00a1-\uffff]{2,}\.?))(?::\d{2,5})?(?:[/?#]\S*)?$/i.test(e)},isValidWsUri:function(e){return new RegExp("^(wss?)\\:\\/\\/(((([a-z0-9\\-_]+)\\.)+([a-z]+))|((25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)))(\\:([0-9]+))?(\\/[a-zA-Z0-9\\-\\.\\_\\~\\%\\!\\$\\&\\(\\)\\*\\+\\,\\;\\=]+)*/?$").test(e)},base64UrlEscape:function(e){return e.replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")},base64UrlEncode:function(e){var n=btoa(e);return n=t.Tools.base64UrlEscape(n)},propCount:function(e){var t=0;for(var n in e)e.hasOwnProperty(n)&&++t;return t},clearObject:function(e){for(var t in e)e.hasOwnProperty(t)&&delete e[t]},objectToFormData:function(e){var t,n,i=new FormData;try{for(var o=r(Object.keys(e)),s=o.next();!s.done;s=o.next()){var a=s.value;i.append(a,e[a])}}catch(e){t={error:e}}finally{try{s&&!s.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}return i},formDataToObject:function(e){var t={};return e.forEach((function(e,n){t[n]=e})),t},findKeyByValue:function(e,t){for(var n in e)if(e.hasOwnProperty(n)&&e[n]==t)return n;return null},callFunctionForArrayOrString:function(e,t){if(Array.isArray(e)){for(var n=!1,r=0;r<e.length;++r)n=t(e[r])||n;return n}if("object"!=typeof e||e instanceof String)return("string"==typeof e||e instanceof String)&&t(e);n=!1;for(var i in e)n=t(e[i])||n;return n},callFunctionForSetOrObject:function(e,t,n,i,s,a,c){var u,l,d,h;if(void 0===i&&(i=void 0),void 0===s&&(s=void 0),void 0===a&&(a=void 0),void 0===c&&(c=void 0),Array.isArray(e)){for(var p=!1,f=0;f<e.length;++f){var g=e[f];if(!t||g instanceof t)p=!!n(g)||p;else if(arguments.length>=5)throw new o.VxError(o.VxError.CODE.EPARAMTYPE,i,s,a,c)}return p}if(e instanceof Set){p=!1;try{for(var m=r(e),b=m.next();!b.done;b=m.next()){g=b.value;if(!t||g instanceof t)p=!!n(g)||p;else if(arguments.length>=5)throw new o.VxError(o.VxError.CODE.EPARAMTYPE,i,s,a,c)}}catch(e){u={error:e}}finally{try{b&&!b.done&&(l=m.return)&&l.call(m)}finally{if(u)throw u.error}}return p}if(e instanceof Map){p=!1;try{for(var _=r(e.values()),S=_.next();!S.done;S=_.next()){g=S.value;if(!t||g instanceof t)p=!!n(g)||p;else if(arguments.length>=5)throw new o.VxError(o.VxError.CODE.EPARAMTYPE,i,s,a,c)}}catch(e){d={error:e}}finally{try{S&&!S.done&&(h=_.return)&&h.call(_)}finally{if(d)throw d.error}}return p}if(!t||e instanceof t)return n(e);if(arguments.length>=5)throw new o.VxError(o.VxError.CODE.EPARAMTYPE,i,s,a,c);return!1},sleep:function(e){return new Promise((function(t){return setTimeout(t,e)}))}}},function(e,t,n){"use strict";const r={generateIdentifier:function(){return Math.random().toString(36).substring(2,12)}};r.localCName=r.generateIdentifier(),r.splitLines=function(e){return e.trim().split("\n").map(e=>e.trim())},r.splitSections=function(e){return e.split("\nm=").map((e,t)=>(t>0?"m="+e:e).trim()+"\r\n")},r.getDescription=function(e){const t=r.splitSections(e);return t&&t[0]},r.getMediaSections=function(e){const t=r.splitSections(e);return t.shift(),t},r.matchPrefix=function(e,t){return r.splitLines(e).filter(e=>0===e.indexOf(t))},r.parseCandidate=function(e){let t;t=0===e.indexOf("a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" ");const n={foundation:t[0],component:{1:"rtp",2:"rtcp"}[t[1]]||t[1],protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],address:t[4],port:parseInt(t[5],10),type:t[7]};for(let e=8;e<t.length;e+=2)switch(t[e]){case"raddr":n.relatedAddress=t[e+1];break;case"rport":n.relatedPort=parseInt(t[e+1],10);break;case"tcptype":n.tcpType=t[e+1];break;case"ufrag":n.ufrag=t[e+1],n.usernameFragment=t[e+1];break;default:void 0===n[t[e]]&&(n[t[e]]=t[e+1])}return n},r.writeCandidate=function(e){const t=[];t.push(e.foundation);const n=e.component;"rtp"===n?t.push(1):"rtcp"===n?t.push(2):t.push(n),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.address||e.ip),t.push(e.port);const r=e.type;return t.push("typ"),t.push(r),"host"!==r&&e.relatedAddress&&e.relatedPort&&(t.push("raddr"),t.push(e.relatedAddress),t.push("rport"),t.push(e.relatedPort)),e.tcpType&&"tcp"===e.protocol.toLowerCase()&&(t.push("tcptype"),t.push(e.tcpType)),(e.usernameFragment||e.ufrag)&&(t.push("ufrag"),t.push(e.usernameFragment||e.ufrag)),"candidate:"+t.join(" ")},r.parseIceOptions=function(e){return e.substring(14).split(" ")},r.parseRtpMap=function(e){let t=e.substring(9).split(" ");const n={payloadType:parseInt(t.shift(),10)};return t=t[0].split("/"),n.name=t[0],n.clockRate=parseInt(t[1],10),n.channels=3===t.length?parseInt(t[2],10):1,n.numChannels=n.channels,n},r.writeRtpMap=function(e){let t=e.payloadType;void 0!==e.preferredPayloadType&&(t=e.preferredPayloadType);const n=e.channels||e.numChannels||1;return"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(1!==n?"/"+n:"")+"\r\n"},r.parseExtmap=function(e){const t=e.substring(9).split(" ");return{id:parseInt(t[0],10),direction:t[0].indexOf("/")>0?t[0].split("/")[1]:"sendrecv",uri:t[1],attributes:t.slice(2).join(" ")}},r.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&"sendrecv"!==e.direction?"/"+e.direction:"")+" "+e.uri+(e.attributes?" "+e.attributes:"")+"\r\n"},r.parseFmtp=function(e){const t={};let n;const r=e.substring(e.indexOf(" ")+1).split(";");for(let e=0;e<r.length;e++)n=r[e].trim().split("="),t[n[0].trim()]=n[1];return t},r.writeFmtp=function(e){let t="",n=e.payloadType;if(void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.parameters&&Object.keys(e.parameters).length){const r=[];Object.keys(e.parameters).forEach(t=>{void 0!==e.parameters[t]?r.push(t+"="+e.parameters[t]):r.push(t)}),t+="a=fmtp:"+n+" "+r.join(";")+"\r\n"}return t},r.parseRtcpFb=function(e){const t=e.substring(e.indexOf(" ")+1).split(" ");return{type:t.shift(),parameter:t.join(" ")}},r.writeRtcpFb=function(e){let t="",n=e.payloadType;return void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach(e=>{t+="a=rtcp-fb:"+n+" "+e.type+(e.parameter&&e.parameter.length?" "+e.parameter:"")+"\r\n"}),t},r.parseSsrcMedia=function(e){const t=e.indexOf(" "),n={ssrc:parseInt(e.substring(7,t),10)},r=e.indexOf(":",t);return r>-1?(n.attribute=e.substring(t+1,r),n.value=e.substring(r+1)):n.attribute=e.substring(t+1),n},r.parseSsrcGroup=function(e){const t=e.substring(13).split(" ");return{semantics:t.shift(),ssrcs:t.map(e=>parseInt(e,10))}},r.getMid=function(e){const t=r.matchPrefix(e,"a=mid:")[0];if(t)return t.substring(6)},r.parseFingerprint=function(e){const t=e.substring(14).split(" ");return{algorithm:t[0].toLowerCase(),value:t[1].toUpperCase()}},r.getDtlsParameters=function(e,t){return{role:"auto",fingerprints:r.matchPrefix(e+t,"a=fingerprint:").map(r.parseFingerprint)}},r.writeDtlsParameters=function(e,t){let n="a=setup:"+t+"\r\n";return e.fingerprints.forEach(e=>{n+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"}),n},r.parseCryptoLine=function(e){const t=e.substring(9).split(" ");return{tag:parseInt(t[0],10),cryptoSuite:t[1],keyParams:t[2],sessionParams:t.slice(3)}},r.writeCryptoLine=function(e){return"a=crypto:"+e.tag+" "+e.cryptoSuite+" "+("object"==typeof e.keyParams?r.writeCryptoKeyParams(e.keyParams):e.keyParams)+(e.sessionParams?" "+e.sessionParams.join(" "):"")+"\r\n"},r.parseCryptoKeyParams=function(e){if(0!==e.indexOf("inline:"))return null;const t=e.substring(7).split("|");return{keyMethod:"inline",keySalt:t[0],lifeTime:t[1],mkiValue:t[2]?t[2].split(":")[0]:void 0,mkiLength:t[2]?t[2].split(":")[1]:void 0}},r.writeCryptoKeyParams=function(e){return e.keyMethod+":"+e.keySalt+(e.lifeTime?"|"+e.lifeTime:"")+(e.mkiValue&&e.mkiLength?"|"+e.mkiValue+":"+e.mkiLength:"")},r.getCryptoParameters=function(e,t){return r.matchPrefix(e+t,"a=crypto:").map(r.parseCryptoLine)},r.getIceParameters=function(e,t){const n=r.matchPrefix(e+t,"a=ice-ufrag:")[0],i=r.matchPrefix(e+t,"a=ice-pwd:")[0];return n&&i?{usernameFragment:n.substring(12),password:i.substring(10)}:null},r.writeIceParameters=function(e){let t="a=ice-ufrag:"+e.usernameFragment+"\r\na=ice-pwd:"+e.password+"\r\n";return e.iceLite&&(t+="a=ice-lite\r\n"),t},r.parseRtpParameters=function(e){const t={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},n=r.splitLines(e)[0].split(" ");t.profile=n[2];for(let i=3;i<n.length;i++){const o=n[i],s=r.matchPrefix(e,"a=rtpmap:"+o+" ")[0];if(s){const n=r.parseRtpMap(s),i=r.matchPrefix(e,"a=fmtp:"+o+" ");switch(n.parameters=i.length?r.parseFmtp(i[0]):{},n.rtcpFeedback=r.matchPrefix(e,"a=rtcp-fb:"+o+" ").map(r.parseRtcpFb),t.codecs.push(n),n.name.toUpperCase()){case"RED":case"ULPFEC":t.fecMechanisms.push(n.name.toUpperCase())}}}r.matchPrefix(e,"a=extmap:").forEach(e=>{t.headerExtensions.push(r.parseExtmap(e))});const i=r.matchPrefix(e,"a=rtcp-fb:* ").map(r.parseRtcpFb);return t.codecs.forEach(e=>{i.forEach(t=>{e.rtcpFeedback.find(e=>e.type===t.type&&e.parameter===t.parameter)||e.rtcpFeedback.push(t)})}),t},r.writeRtpDescription=function(e,t){let n="";n+="m="+e+" ",n+=t.codecs.length>0?"9":"0",n+=" "+(t.profile||"UDP/TLS/RTP/SAVPF")+" ",n+=t.codecs.map(e=>void 0!==e.preferredPayloadType?e.preferredPayloadType:e.payloadType).join(" ")+"\r\n",n+="c=IN IP4 0.0.0.0\r\n",n+="a=rtcp:9 IN IP4 0.0.0.0\r\n",t.codecs.forEach(e=>{n+=r.writeRtpMap(e),n+=r.writeFmtp(e),n+=r.writeRtcpFb(e)});let i=0;return t.codecs.forEach(e=>{e.maxptime>i&&(i=e.maxptime)}),i>0&&(n+="a=maxptime:"+i+"\r\n"),t.headerExtensions&&t.headerExtensions.forEach(e=>{n+=r.writeExtmap(e)}),n},r.parseRtpEncodingParameters=function(e){const t=[],n=r.parseRtpParameters(e),i=-1!==n.fecMechanisms.indexOf("RED"),o=-1!==n.fecMechanisms.indexOf("ULPFEC"),s=r.matchPrefix(e,"a=ssrc:").map(e=>r.parseSsrcMedia(e)).filter(e=>"cname"===e.attribute),a=s.length>0&&s[0].ssrc;let c;const u=r.matchPrefix(e,"a=ssrc-group:FID").map(e=>e.substring(17).split(" ").map(e=>parseInt(e,10)));u.length>0&&u[0].length>1&&u[0][0]===a&&(c=u[0][1]),n.codecs.forEach(e=>{if("RTX"===e.name.toUpperCase()&&e.parameters.apt){let n={ssrc:a,codecPayloadType:parseInt(e.parameters.apt,10)};a&&c&&(n.rtx={ssrc:c}),t.push(n),i&&(n=JSON.parse(JSON.stringify(n)),n.fec={ssrc:a,mechanism:o?"red+ulpfec":"red"},t.push(n))}}),0===t.length&&a&&t.push({ssrc:a});let l=r.matchPrefix(e,"b=");return l.length&&(l=0===l[0].indexOf("b=TIAS:")?parseInt(l[0].substring(7),10):0===l[0].indexOf("b=AS:")?1e3*parseInt(l[0].substring(5),10)*.95-16e3:void 0,t.forEach(e=>{e.maxBitrate=l})),t},r.parseRtcpParameters=function(e){const t={},n=r.matchPrefix(e,"a=ssrc:").map(e=>r.parseSsrcMedia(e)).filter(e=>"cname"===e.attribute)[0];n&&(t.cname=n.value,t.ssrc=n.ssrc);const i=r.matchPrefix(e,"a=rtcp-rsize");t.reducedSize=i.length>0,t.compound=0===i.length;const o=r.matchPrefix(e,"a=rtcp-mux");return t.mux=o.length>0,t},r.writeRtcpParameters=function(e){let t="";return e.reducedSize&&(t+="a=rtcp-rsize\r\n"),e.mux&&(t+="a=rtcp-mux\r\n"),void 0!==e.ssrc&&e.cname&&(t+="a=ssrc:"+e.ssrc+" cname:"+e.cname+"\r\n"),t},r.parseMsid=function(e){let t;const n=r.matchPrefix(e,"a=msid:");if(1===n.length)return t=n[0].substring(7).split(" "),{stream:t[0],track:t[1]};const i=r.matchPrefix(e,"a=ssrc:").map(e=>r.parseSsrcMedia(e)).filter(e=>"msid"===e.attribute);return i.length>0?(t=i[0].value.split(" "),{stream:t[0],track:t[1]}):void 0},r.parseSctpDescription=function(e){const t=r.parseMLine(e),n=r.matchPrefix(e,"a=max-message-size:");let i;n.length>0&&(i=parseInt(n[0].substring(19),10)),isNaN(i)&&(i=65536);const o=r.matchPrefix(e,"a=sctp-port:");if(o.length>0)return{port:parseInt(o[0].substring(12),10),protocol:t.fmt,maxMessageSize:i};const s=r.matchPrefix(e,"a=sctpmap:");if(s.length>0){const e=s[0].substring(10).split(" ");return{port:parseInt(e[0],10),protocol:e[1],maxMessageSize:i}}},r.writeSctpDescription=function(e,t){let n=[];return n="DTLS/SCTP"!==e.protocol?["m="+e.kind+" 9 "+e.protocol+" "+t.protocol+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctp-port:"+t.port+"\r\n"]:["m="+e.kind+" 9 "+e.protocol+" "+t.port+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctpmap:"+t.port+" "+t.protocol+" 65535\r\n"],void 0!==t.maxMessageSize&&n.push("a=max-message-size:"+t.maxMessageSize+"\r\n"),n.join("")},r.generateSessionId=function(){return Math.random().toString().substr(2,22)},r.writeSessionBoilerplate=function(e,t,n){let i;const o=void 0!==t?t:2;i=e||r.generateSessionId();return"v=0\r\no="+(n||"thisisadapterortc")+" "+i+" "+o+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},r.getDirection=function(e,t){const n=r.splitLines(e);for(let e=0;e<n.length;e++)switch(n[e]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return n[e].substring(2)}return t?r.getDirection(t):"sendrecv"},r.getKind=function(e){return r.splitLines(e)[0].split(" ")[0].substring(2)},r.isRejected=function(e){return"0"===e.split(" ",2)[1]},r.parseMLine=function(e){const t=r.splitLines(e)[0].substring(2).split(" ");return{kind:t[0],port:parseInt(t[1],10),protocol:t[2],fmt:t.slice(3).join(" ")}},r.parseOLine=function(e){const t=r.matchPrefix(e,"o=")[0].substring(2).split(" ");return{username:t[0],sessionId:t[1],sessionVersion:parseInt(t[2],10),netType:t[3],addressType:t[4],address:t[5]}},r.isValidSDP=function(e){if("string"!=typeof e||0===e.length)return!1;const t=r.splitLines(e);for(let e=0;e<t.length;e++)if(t[e].length<2||"="!==t[e].charAt(1))return!1;return!0},e.exports=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AccountId=void 0;var r=n(1),i=n(2),o=n(0),s=function(){function e(t,n,s,a){if(r.Logger.trace(),void 0!==n&&void 0!==s)i.Tools.validateIssuerName(t,"AccountId()","CORE"),i.Tools.validateUserName(n,"AccountId()","CORE"),this.domain=i.Tools.validateAndFormatDomainName(s,"AccountId()","CORE"),this._isComplete=!0,this.issuer=t.toString(),this.name=n,this.resource=null,this.environmentId="",a&&(this.environmentId=a,i.Tools.validateEnvironmentId(a,"AccountId()","CORE"));else if("string"==typeof t||t instanceof String){var c=t.match(/^\.([A-Za-z0-9\-_]+)\.([A-Za-z0-9\-_]+)\.(?:([A-Za-z0-9\-_]+)\.)?@(([a-z0-9\-_]+\.)+([a-z]+))(\/([a-zA-Z0-9\-_@]+))?$/);if(c&&c.length>=4)this._isComplete=!0,this.issuer=c[1],this.name=c[2],this.environmentId=c[3]||"",this.domain=c[4],this.resource=c[7]?c[7]:null;else{if(!((c=t.match(/^([A-Za-z0-9\-_.]+)@(([a-z0-9\-_]+\.)+([a-z]+))(\/([a-zA-Z0-9\-_@]+))?$/))&&c.length>=3))throw new o.VxError(o.VxError.CODE.EPARAMVALUE,"jid","AccountId()","CORE");this._isComplete=!1,this._originalUri=t.toString(),this.issuer=null,this.environmentId="",this.name=c[1],this.domain=c[2],this.resource=c[6]?c[6]:null}}else{if(!(t instanceof e))throw new o.VxError(o.VxError.CODE.EPARAMTYPE,"accountId","string or AccountId","AccountId()","CORE");this._isComplete=t._isComplete,this.issuer=t.issuer,this.name=t.name,this.domain=t.domain,this.environmentId=t.environmentId,"resource"in t&&(this.resource=t.resource),"_originalUri"in t&&(this._originalUri=t._originalUri)}Object.defineProperties(this,{issuer:{writable:!1,configurable:!1,enumerable:!0},name:{writable:!1,configurable:!1,enumerable:!0},domain:{writable:!1,configurable:!1,enumerable:!0},environmentId:{writable:!1,configurable:!1,enumerable:!0},resource:{writable:!1,configurable:!1,enumerable:!0},_isComplete:{writable:!1,configurable:!1,enumerable:!1},_originalUri:{writable:!1,configurable:!1,enumerable:!1}})}return Object.defineProperty(e.prototype,"accountName",{get:function(){return this._isComplete?this.issuer&&this.name?this.environmentId?"."+this.issuer+"."+this.name+"."+this.environmentId+".":"."+this.issuer+"."+this.name+".":"":this.name?this.name:""},enumerable:!1,configurable:!0}),e.prototype.toString=function(){return this._isComplete?"."+this.issuer+"."+this.name+(""!==this.environmentId?"."+this.environmentId:"")+".@"+this.domain+("resource"in this&&this.resource?"/"+this.resource:""):this._originalUri},e.prototype.equals=function(t){return t instanceof e&&(!0===this._isComplete&&this._isComplete===t._isComplete&&this.issuer===t.issuer&&this.name===t.name&&this.environmentId===t.environmentId&&this.domain===t.domain||!1===this._isComplete&&this._isComplete===t._isComplete&&this._originalUri===t._originalUri)},e.prototype.isEmpty=function(){return this._isComplete&&(!this.issuer||!this.name||!this.domain)||!this._isComplete&&!this._originalUri},e.prototype.valueOf=function(){return this.toString()},e}();t.AccountId=s},function(e,t,n){(function(t){var r;e.exports=(r=r||function(e,r){var i;if("undefined"!=typeof window&&window.crypto&&(i=window.crypto),"undefined"!=typeof self&&self.crypto&&(i=self.crypto),"undefined"!=typeof globalThis&&globalThis.crypto&&(i=globalThis.crypto),!i&&"undefined"!=typeof window&&window.msCrypto&&(i=window.msCrypto),!i&&void 0!==t&&t.crypto&&(i=t.crypto),!i)try{i=n(49)}catch(e){}var o=function(){if(i){if("function"==typeof i.getRandomValues)try{return i.getRandomValues(new Uint32Array(1))[0]}catch(e){}if("function"==typeof i.randomBytes)try{return i.randomBytes(4).readInt32LE()}catch(e){}}throw new Error("Native crypto module could not be used to get secure random number.")},s=Object.create||function(){function e(){}return function(t){var n;return e.prototype=t,n=new e,e.prototype=null,n}}(),a={},c=a.lib={},u=c.Base={extend:function(e){var t=s(this);return e&&t.mixIn(e),t.hasOwnProperty("init")&&this.init!==t.init||(t.init=function(){t.$super.init.apply(this,arguments)}),t.init.prototype=t,t.$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},l=c.WordArray=u.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=null!=t?t:4*e.length},toString:function(e){return(e||h).stringify(this)},concat:function(e){var t=this.words,n=e.words,r=this.sigBytes,i=e.sigBytes;if(this.clamp(),r%4)for(var o=0;o<i;o++){var s=n[o>>>2]>>>24-o%4*8&255;t[r+o>>>2]|=s<<24-(r+o)%4*8}else for(var a=0;a<i;a+=4)t[r+a>>>2]=n[a>>>2];return this.sigBytes+=i,this},clamp:function(){var t=this.words,n=this.sigBytes;t[n>>>2]&=4294967295<<32-n%4*8,t.length=e.ceil(n/4)},clone:function(){var e=u.clone.call(this);return e.words=this.words.slice(0),e},random:function(e){for(var t=[],n=0;n<e;n+=4)t.push(o());return new l.init(t,e)}}),d=a.enc={},h=d.Hex={stringify:function(e){for(var t=e.words,n=e.sigBytes,r=[],i=0;i<n;i++){var o=t[i>>>2]>>>24-i%4*8&255;r.push((o>>>4).toString(16)),r.push((15&o).toString(16))}return r.join("")},parse:function(e){for(var t=e.length,n=[],r=0;r<t;r+=2)n[r>>>3]|=parseInt(e.substr(r,2),16)<<24-r%8*4;return new l.init(n,t/2)}},p=d.Latin1={stringify:function(e){for(var t=e.words,n=e.sigBytes,r=[],i=0;i<n;i++){var o=t[i>>>2]>>>24-i%4*8&255;r.push(String.fromCharCode(o))}return r.join("")},parse:function(e){for(var t=e.length,n=[],r=0;r<t;r++)n[r>>>2]|=(255&e.charCodeAt(r))<<24-r%4*8;return new l.init(n,t)}},f=d.Utf8={stringify:function(e){try{return decodeURIComponent(escape(p.stringify(e)))}catch(e){throw new Error("Malformed UTF-8 data")}},parse:function(e){return p.parse(unescape(encodeURIComponent(e)))}},g=c.BufferedBlockAlgorithm=u.extend({reset:function(){this._data=new l.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=f.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(t){var n,r=this._data,i=r.words,o=r.sigBytes,s=this.blockSize,a=o/(4*s),c=(a=t?e.ceil(a):e.max((0|a)-this._minBufferSize,0))*s,u=e.min(4*c,o);if(c){for(var d=0;d<c;d+=s)this._doProcessBlock(i,d);n=i.splice(0,c),r.sigBytes-=u}return new l.init(n,u)},clone:function(){var e=u.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0}),m=(c.Hasher=g.extend({cfg:u.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){g.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(t,n){return new e.init(n).finalize(t)}},_createHmacHelper:function(e){return function(t,n){return new m.HMAC.init(e,n).finalize(t)}}}),a.algo={});return a}(Math),r)}).call(this,n(12))},function(e,t){t.getArg=function(e,t,n){if(t in e)return e[t];if(3===arguments.length)return n;throw new Error('"'+t+'" is a required argument.')};var n=/^(?:([\w+\-.]+):)?\/\/(?:(\w+:\w+)@)?([\w.-]*)(?::(\d+))?(.*)$/,r=/^data:.+\,.+$/;function i(e){var t=e.match(n);return t?{scheme:t[1],auth:t[2],host:t[3],port:t[4],path:t[5]}:null}function o(e){var t="";return e.scheme&&(t+=e.scheme+":"),t+="//",e.auth&&(t+=e.auth+"@"),e.host&&(t+=e.host),e.port&&(t+=":"+e.port),e.path&&(t+=e.path),t}function s(e){var n=e,r=i(e);if(r){if(!r.path)return e;n=r.path}for(var s,a=t.isAbsolute(n),c=n.split(/\/+/),u=0,l=c.length-1;l>=0;l--)"."===(s=c[l])?c.splice(l,1):".."===s?u++:u>0&&(""===s?(c.splice(l+1,u),u=0):(c.splice(l,2),u--));return""===(n=c.join("/"))&&(n=a?"/":"."),r?(r.path=n,o(r)):n}function a(e,t){""===e&&(e="."),""===t&&(t=".");var n=i(t),a=i(e);if(a&&(e=a.path||"/"),n&&!n.scheme)return a&&(n.scheme=a.scheme),o(n);if(n||t.match(r))return t;if(a&&!a.host&&!a.path)return a.host=t,o(a);var c="/"===t.charAt(0)?t:s(e.replace(/\/+$/,"")+"/"+t);return a?(a.path=c,o(a)):c}t.urlParse=i,t.urlGenerate=o,t.normalize=s,t.join=a,t.isAbsolute=function(e){return"/"===e.charAt(0)||n.test(e)},t.relative=function(e,t){""===e&&(e="."),e=e.replace(/\/$/,"");for(var n=0;0!==t.indexOf(e+"/");){var r=e.lastIndexOf("/");if(r<0)return t;if((e=e.slice(0,r)).match(/^([^\/]+:\/)?\/*$/))return t;++n}return Array(n+1).join("../")+t.substr(e.length+1)};var c=!("__proto__"in Object.create(null));function u(e){return e}function l(e){if(!e)return!1;var t=e.length;if(t<9)return!1;if(95!==e.charCodeAt(t-1)||95!==e.charCodeAt(t-2)||111!==e.charCodeAt(t-3)||116!==e.charCodeAt(t-4)||111!==e.charCodeAt(t-5)||114!==e.charCodeAt(t-6)||112!==e.charCodeAt(t-7)||95!==e.charCodeAt(t-8)||95!==e.charCodeAt(t-9))return!1;for(var n=t-10;n>=0;n--)if(36!==e.charCodeAt(n))return!1;return!0}function d(e,t){return e===t?0:null===e?1:null===t?-1:e>t?1:-1}t.toSetString=c?u:function(e){return l(e)?"$"+e:e},t.fromSetString=c?u:function(e){return l(e)?e.slice(1):e},t.compareByOriginalPositions=function(e,t,n){var r=d(e.source,t.source);return 0!==r||0!==(r=e.originalLine-t.originalLine)||0!==(r=e.originalColumn-t.originalColumn)||n||0!==(r=e.generatedColumn-t.generatedColumn)||0!==(r=e.generatedLine-t.generatedLine)?r:d(e.name,t.name)},t.compareByGeneratedPositionsDeflated=function(e,t,n){var r=e.generatedLine-t.generatedLine;return 0!==r||0!==(r=e.generatedColumn-t.generatedColumn)||n||0!==(r=d(e.source,t.source))||0!==(r=e.originalLine-t.originalLine)||0!==(r=e.originalColumn-t.originalColumn)?r:d(e.name,t.name)},t.compareByGeneratedPositionsInflated=function(e,t){var n=e.generatedLine-t.generatedLine;return 0!==n||0!==(n=e.generatedColumn-t.generatedColumn)||0!==(n=d(e.source,t.source))||0!==(n=e.originalLine-t.originalLine)||0!==(n=e.originalColumn-t.originalColumn)?n:d(e.name,t.name)},t.parseSourceMapInput=function(e){return JSON.parse(e.replace(/^\)]}'[^\n]*\n/,""))},t.computeSourceURL=function(e,t,n){if(t=t||"",e&&("/"!==e[e.length-1]&&"/"!==t[0]&&(e+="/"),t=e+t),n){var r=i(n);if(!r)throw new Error("sourceMapURL could not be parsed");if(r.path){var c=r.path.lastIndexOf("/");c>=0&&(r.path=r.path.substring(0,c+1))}t=a(o(r),t)}return s(t)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ChannelSession=t.ChanType=void 0;var r,i,o,s=n(13),a=n(1),c=n(4),u=n(9),l=n(0),d=n(10),h=n(15),p=n(14),f=n(16),g=n(2),m=n(26),b=n(27);!function(e){e.ECHO="e",e.CONF="g"}(r=t.ChanType||(t.ChanType={})),function(e){e[e.OFF=0]="OFF",e[e.ON=1]="ON",e[e.ENABLING=2]="ENABLING",e[e.DISABLING=3]="DISABLING",e[e.NOTSUPPORTED=4]="NOTSUPPORTED"}(i||(i={})),function(e){e[e.NOTHINGTODO=0]="NOTHINGTODO",e[e.CANSTART=1]="CANSTART",e[e.NOTPOSSIBLE=2]="NOTPOSSIBLE",e[e.NOTSUPPORTED=3]="NOTSUPPORTED"}(o||(o={}));var _=t.ChannelSession=function(){function e(e,t){var n,r,o,f,_=this;if(this._className="ChannelSession",this._internalId=g.Tools.generateInternalId(),this._self=this,this._isStarted=!1,this._inviteInProgress=!1,this._inviteCompleted=!1,this._audioConnectScheduled=!1,this._audioDisconnectScheduled=!1,this._textConnectScheduled=!1,this._textDisconnectScheduled=!1,this._wsUriPatchPanel=void 0,this._wsConnectionPatchPanel=void 0,this._isWSPPConnected=!1,this._participantsByRoomNick={},this._arrRTCPC={},this.overrideRTCPCMode=void 0,this._audioState=i.OFF,this._textState=i.OFF,this._participants={},this._isEstablished=!1,this._cbOnSessionEstablished=void 0,this._cbOnSessionTerminated=void 0,this._cbOnParticipantAdded=void 0,this._cbOnParticipantUpdated=void 0,this._cbOnParticipantRemoved=void 0,this._cbOnChannelTextMessage=void 0,this._cbOnAudioStateUpdated=void 0,this._cbOnTextStateUpdated=void 0,this._cbOnRemoteStream=void 0,this.onStartSessionResponse=function(e,t,n,r){a.Logger.trace(),_._isEstablished=!0,_.log(_._logPrefixSession+" established successfully"),_._cbOnSessionEstablished&&"function"==typeof _._cbOnSessionEstablished&&_._cbOnSessionEstablished(_),_.setIsTextConnected(n),_.setIsAudioConnected(t)},this.onStartSessionVxError=function(e){a.Logger.trace(),e?a.Logger.logXmppError(_._logSubsystemId,e,_._logPrefixSessionStarting):_.log(_._logPrefixSessionStarting+": timeout, no expected response from the server"),_.onChannelSessionTerminatedInternal()},this.onRemoveSessionSetUnavailableResponse=function(e,t){a.Logger.trace(),e||_.log(_._logPrefixSessionRemoving+" warning: timeout while waiting response to the presence type=unavailable"),_.onChannelSessionTerminatedInternal()},this.onChannelSessionTerminatedInternal=function(){a.Logger.trace(),_.log(_._logPrefixSession+" terminated"),_.releaseChannelSessionResourcesMedia(),_._isEstablished=!1,_._cbOnSessionTerminated&&"function"==typeof _._cbOnSessionTerminated&&_._cbOnSessionTerminated(_),_.loginSession.onChannelSessionTerminatedInternal(_)},this.onSetAudioConnectedResponse=function(e,t){return a.Logger.trace(),_._audioState==i.ENABLING?(_._audioState=i.ON,_.log("audioState changed to ON")):_._audioState==i.DISABLING&&(_._audioState=i.OFF,_.log("audioState changed to OFF")),_._cbOnAudioStateUpdated&&"function"==typeof _._cbOnAudioStateUpdated&&_._cbOnAudioStateUpdated(_,_._audioState),_.performSetAudioOrTextConnectedScheduledActions(),!1},this.onSetTextConnectedResponse=function(e,t){return a.Logger.trace(),_._textState==i.ENABLING?(_._textState=i.ON,_.log("textState changed to ON")):_._textState==i.DISABLING&&(_._textState=i.OFF,_.log("textState changed to OFF")),_._cbOnTextStateUpdated&&"function"==typeof _._cbOnTextStateUpdated&&_._cbOnTextStateUpdated(_,_._textState),_.performSetAudioOrTextConnectedScheduledActions(),!1},this.onSetTextOrAudioConnectedVxError=function(e){a.Logger.trace(),e?a.Logger.logXmppError(_._logSubsystemId,e,_._logPrefixSession):_.log("Timeout while waiting a response to the text/audio indicators stanza"),_.onChannelSessionTerminatedInternal()},this.onInviteResponse=function(e){a.Logger.trace();var t=e.getElementsByTagName("invite");if(t&&t.length>0){var n=t[0].innerHTML,r=void 0;"ws://"==n.substring(0,5)||"wss://"==n.substring(0,6)?(_.log(_._logPrefixSessionStarting+": invite succeeded, WS URI is "+n),_.initiateWsConnectionWithPatchPanel(n)):null!==(r=_.parsePPMessage(n,!0))&&r.addrtcpc?(_.afterInviteSucceeded(),_.initPeerConnection(r.addrtcpc)):(_.log(_._logPrefixSessionStarting+": invite succeeded, but the response is invalid, neither WS URI nor b64/XML command: "+n),_.onInviteFailed())}else _.log(_._logPrefixSessionStarting+": <invite> element is absent in response to the invite request"),_.onInviteFailed()},this.onInviteVxError=function(e){if(a.Logger.trace(),e){var t=_._logPrefixSessionStarting+": invite failed";a.Logger.logXmppError(_._logSubsystemId,e,t)}else _.log(_._logPrefixSessionStarting+" fatal error: timeout while waiting response to the invite request");_.onInviteFailed()},this.onInviteFailed=function(){a.Logger.trace(),_._inviteInProgress=!1,_._inviteCompleted=!1,_.removeSession(!0)},this._handOnParticipantUpdated=void 0,this._handOnParticipantRemoved=void 0,this._handOnGroupMessage=void 0,this.onParticipantUpdatedInternal=function(e){if(e.hasAttribute("type"))return!0;a.Logger.trace();var t=void 0,n=void 0,r=!1,o=void 0,u=void 0,l=void 0,d=void 0,p=e.getElementsByTagName("x");if(p&&p.length>0){var f=p[0],g=f.getElementsByTagName("item");if(g&&g.length>0){var b=g[0];t=b.getAttribute("jid"),n=s.Strophe.getBareJidFromJid(t),o=b.getAttribute("affiliation"),u=b.getAttribute("role")}var S=f.getElementsByTagName("status");if(S&&S.length>0)for(var y=0;y<S.length;++y){"110"==S[0].getAttribute("code")&&(r=!0)}}if(!n)return _.log("Ignored presence update for unidentified participant: "+m.Xml.xmlToString(e)),!0;var v,E=t,C=!(E in _._participants),T=/preventChannelListUpdate=true/gi.test(window.location.search);if(C){var w=new c.AccountId(n);v=new h.Participant(_,E,w,r)}else v=_._participants[E];var A=e.getAttribute("from");A&&(l=s.Strophe.getResourceFromJid(A)),C||(d=v.roomNickname);var P=!1,O=!1,x=e.getElementsByTagName("m");if(x&&x.length>0){var R=x[0];R.getElementsByTagName("audio").length>0&&(P=!0),R.getElementsByTagName("text").length>0&&(O=!0)}v.roomNickname=l,v.affiliation=o,v.role=u,v.inAudio=P,v.inText=O,C&&(v.localMute=i.OFF),C&&(_._participants[E]=v,_._participantsByRoomNick[l]=v),C||l==d||(delete _._participantsByRoomNick[d],_._participantsByRoomNick[l]=v),_.log("Participant "+(C?"added":"updated")+": "+v.account.toString()+" roomNickname="+v.roomNickname+" affiliation="+v.affiliation+" role="+v.role+" inAudio="+v.inAudio+" inText="+v.inText+" isSelf="+v.isSelf+" in "+_._logPrefixSession);var I=C?_._cbOnParticipantAdded:_._cbOnParticipantUpdated;return!T&&I&&"function"==typeof I&&I(_,v),!0},this.onParticipantRemovedInternal=function(e){a.Logger.trace();var t=void 0,n=void 0,r=e.getElementsByTagName("x");if(r&&r.length>0){var i=r[0].getElementsByTagName("item");if(i&&i.length>0)t=i[0].getAttribute("jid"),n=s.Strophe.getBareJidFromJid(t)}if(!n)return _.log("Ignored presence removal for unidentified participant: "+m.Xml.xmlToString(e)),!0;var o=t;if(!(o in _._participants))return _.log("Ignored presence removal for unknown participant: "+t),!0;var c=_._participants[o].roomNickname;return _.log("Participant removed: "+n+" ("+c+") from "+_._logPrefixSession),_._cbOnParticipantRemoved&&"function"==typeof _._cbOnParticipantRemoved&&_._cbOnParticipantRemoved(_,_._participants[o]),delete _._participantsByRoomNick[c],delete _._participants[o],n==_._accountJid&&_._isEstablished&&_.removeSession(),!0},this.onGroupMessage=function(e){a.Logger.trace();var t=e.getAttribute("from"),n=s.Strophe.getResourceFromJid(t);if(!n)return _.log("Warning: room nickname is absent in "+m.Xml.xmlToString(e)),!0;var r=void 0,i=n&&n in _._participantsByRoomNick?_._participantsByRoomNick[n]:void 0;i?r=i.account.toString():_.log("Warning: participant not found for room nickname "+n);var o=e.getElementsByTagName("subject"),u=void 0;o&&o[0]&&o[0].childNodes.length>=1&&3==o[0].childNodes[0].nodeType&&(u=o[0].childNodes[0].nodeValue);var l=e.getElementsByTagName("body");l&&l[0]&&l[0].childNodes.length>=1&&3==l[0].childNodes[0].nodeType&&(u=l[0].childNodes[0].nodeValue);var d=void 0,h=e.getElementsByTagName("delay");if(h&&h[0]){var f=h[0].getAttribute("stamp");f&&(d=Date.parse(f));var g=h[0].getAttribute("from");g&&!r&&(r=s.Strophe.getBareJidFromJid(g))}var b=e.getAttribute("xml:lang");b||(b=void 0);var S=void 0,y=void 0,v=e.getElementsByTagName("application");v&&v[0]&&v[0].childNodes.length>=1&&3==v[0].childNodes[0].nodeType&&(S=v[0].getAttribute("xmlns"),y=v[0].childNodes[0].nodeValue);var E="Group message received in "+_._logPrefixSession+": from "+n+" ("+(r||"JID unknown")+"), body = "+(void 0===u?"<undefined>":"'"+u+"'");if(d&&(E+=", delayTimestamp = "+d),_.log(E),_._cbOnChannelTextMessage&&"function"==typeof _._cbOnChannelTextMessage){var C=r?new c.AccountId(r):null,T=new p.TextMessage(u,void 0,C,i,n,d,b,S,y);_._cbOnChannelTextMessage(_,T)}return!0},this.performMuteRequest=function(e,t,n){void 0===n&&(n=void 0),a.Logger.trace();var r=g.Tools.makeUuid(),i=(0,s.$iq)({id:r,to:_._mucJid,type:"set"}).c(t,{xmlns:b.Xmpp.NS.URN_VIVOX_MUC}).c("sub",{jid:e.account.toString()});n&&i.c("password",{}).t(n);var o=i.tree();_.log("Performing "+t+" operation for "+e.account.toString());var c=Date.now();return _._stropheConnection.sendIQ(o,(function(n){return _.onMuteResponse(n,t,e,c)}),(function(n){return _.onMuteVxError(n,t,e)}),b.Xmpp.DEFAULT_TRANSACTION_TIMEOUT),_._cbOnParticipantUpdated&&"function"==typeof _._cbOnParticipantUpdated&&_._cbOnParticipantUpdated(_,e),!0},this.onMuteVxError=function(e,t,n){a.Logger.trace();var r="local_mute"==t||"local_unmute"==t;if(e){var i=t+" operation failed for "+n.account.toString();a.Logger.logXmppError(_._logSubsystemId,e,i)}else _.log(t+" operation timed out for "+n.account.toString());r&&_.updateLocalMuteStateForParticipant(n,t,!1)},this._localMuteStateTransitions={local_mute:{true:(n={},n[i.OFF]=i.ON,n[i.ON]=i.ON,n[i.ENABLING]=i.ON,n[i.DISABLING]=i.ON,n),false:(r={},r[i.OFF]=i.OFF,r[i.ON]=i.ON,r[i.ENABLING]=i.OFF,r[i.DISABLING]=i.ON,r)},local_unmute:{true:(o={},o[i.OFF]=i.OFF,o[i.ON]=i.OFF,o[i.ENABLING]=i.OFF,o[i.DISABLING]=i.OFF,o),false:(f={},f[i.OFF]=i.OFF,f[i.ON]=i.ON,f[i.ENABLING]=i.OFF,f[i.DISABLING]=i.ON,f)}},this.updateLocalMuteStateForParticipant=function(e,t,n){a.Logger.trace();var r=e.localMute;e.localMute=_._localMuteStateTransitions[t][n][r],_._cbOnParticipantUpdated&&"function"==typeof _._cbOnParticipantUpdated&&_._cbOnParticipantUpdated(_,e)},this.onWSPPConnected=function(){a.Logger.trace(),_.log("WebSocket connection with PatchPanel established successfully"),_._isWSPPConnected=!0,_.afterInviteSucceeded()},this.onWSPPDisconnected=function(e){a.Logger.trace(),_._isWSPPConnected?(_.log("WebSocket connection with PatchPanel closed unexpectedly, code="+e.code),_.removeSession()):(_.log("Failed to establish WebSocket connection with PatchPanel, code="+e.code),_.removeSession(!0))},this.onWSPPVxError=function(e){a.Logger.trace(),_.log("WebSocket connection error")},this.onWSPPMessage=function(e){if(a.Logger.trace(),_._isWSPPConnected){_.log("Msg from PatchPanel: "+e.data);var t=_.parsePPMessage(e.data);t&&t.addrtcpc&&_.initPeerConnection(t.addrtcpc)}},this.initPeerConnection=function(e){if(a.Logger.trace(),Array.isArray(e))for(var t in e)_.initPeerConnection(e[t]);else{var n=e._attrs.id;_.log("Initializing RTCPeerConnection["+n+"]");var r=new RTCPeerConnection({iceServers:[],sdpSemantics:"unified-plan"});_._arrRTCPC[n]=r;r.ontrack=function(e){if(a.Logger.trace(),_.log("Adding media stream for RTCPeerConnection["+n+"], sid="+e.streams[0].id),_._cbOnRemoteStream&&"function"==typeof _._cbOnRemoteStream)_._cbOnRemoteStream(_,e.streams[0],n);else{_.log("fatal error: SDK user did not set the callback for onRemoteStream")}};var i=_.streamLocal.getAudioTracks();_.streamLocal&&"0"!=e.self&&i.length>0&&_.streamLocal.getTracks().forEach((function(e){return r.addTrack(e,_.streamLocal)}));var o=_.reconstructServerSdpOffer(e);_.processSDPOffer(n,o)}},this.onSDPAnswerCreated=function(e,t){a.Logger.trace(),_.log("SDP answer created for RTCPC["+e+"]:\n"+t.sdp);var n=_._arrRTCPC[e];n.setLocalDescription(t).then((function(){console.log("Local SDP answer after setLocalDescription:\n",n.localDescription.sdp)})).catch((function(t){_.sdpVxErrorHandler(e,t,"SDP setLocalDescription")}))},a.Logger.trace(),this._logSubsystemId="CS-"+t.internalId+"-"+this._internalId,!(e instanceof u.ChannelId))throw new l.VxError(l.VxError.CODE.EPARAMTYPE,"channel","ChannelId",this._className,this._logSubsystemId);if(e.isEmpty())throw new l.VxError(l.VxError.CODE.EPARAMVALUE,"channel",this._className,this._logSubsystemId);if(!(t instanceof d.LoginSession))throw new l.VxError(l.VxError.CODE.EPARAMTYPE,"loginSession","LoginSession",this._className,this._logSubsystemId);if(e.domain!=t.loginSessionId.domain||e.issuer!=t.loginSessionId.issuer)throw new l.VxError(l.VxError.CODE.EPARAMVALUE,"channel",this._className,this._logSubsystemId,"domain and issuer in channel must match with domain and issuer of the LoginSession");this.channel=e,this.loginSession=t,this._channelJid=e.toString(),this._accountJid=t.loginSessionId.toString(),this._userIdStripped=t.loginSessionId.accountName.replace(/\./g,""),this._mucJid=e.channelName+"@muc."+e.domain,this._mucJidRes=this._mucJid+"/"+this._userIdStripped,this._stropheConnection=t.stropheConnection,this._logPrefixSession="ChannelSession with "+e.channelName,this._logPrefixSessionStarting="Starting "+this._logPrefixSession,this._logPrefixSessionRemoving="Removing "+this._logPrefixSession}return Object.defineProperty(e.prototype,"audioState",{get:function(){return this._audioState},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"textState",{get:function(){return this._textState},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"participants",{get:function(){return this._participants},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isEstablished",{get:function(){return this._isEstablished},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onSessionEstablished",{get:function(){return this._cbOnSessionEstablished},set:function(e){this.validateCB(e,"onSessionEstablished"),this._cbOnSessionEstablished=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onSessionTerminated",{get:function(){return this._cbOnSessionTerminated},set:function(e){this.validateCB(e,"onSessionTerminated"),this._cbOnSessionTerminated=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onParticipantAdded",{get:function(){return this._cbOnParticipantAdded},set:function(e){this.validateCB(e,"onParticipantAdded"),this._cbOnParticipantAdded=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onParticipantUpdated",{get:function(){return this._cbOnParticipantUpdated},set:function(e){this.validateCB(e,"onParticipantUpdated"),this._cbOnParticipantUpdated=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onParticipantRemoved",{get:function(){return this._cbOnParticipantRemoved},set:function(e){this.validateCB(e,"onParticipantRemoved"),this._cbOnParticipantRemoved=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onChannelTextMessage",{get:function(){return this._cbOnChannelTextMessage},set:function(e){this.validateCB(e,"onChannelTextMessage"),this._cbOnChannelTextMessage=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onAudioStateUpdated",{get:function(){return this._cbOnAudioStateUpdated},set:function(e){this.validateCB(e,"onAudioStateUpdated"),this._cbOnAudioStateUpdated=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onTextStateUpdated",{get:function(){return this._cbOnTextStateUpdated},set:function(e){this.validateCB(e,"onTextStateUpdated"),this._cbOnTextStateUpdated=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onRemoteStream",{get:function(){return this._cbOnRemoteStream},set:function(e){this.validateCB(e,"onRemoteStream"),this._cbOnRemoteStream=e},enumerable:!1,configurable:!0}),e.prototype.validateCB=function(e,t){if("function"!=typeof e&&void 0!==e)throw new l.VxError(l.VxError.CODE.EPROPTYPE,t,"function",this._className,this._logSubsystemId)},e.prototype.connect=function(e,t,n){var r="ChannelSession.connect()";if(a.Logger.trace(),this._isStarted)throw new l.VxError(l.VxError.CODE.ESTATE,"already started",r,this._logSubsystemId);if(3!=arguments.length)throw new l.VxError(l.VxError.CODE.ENUMPARAMS,r,this._logSubsystemId);if("boolean"!=typeof e)throw new l.VxError(l.VxError.CODE.EPARAMTYPE,"enableAudio","boolean",r,this._logSubsystemId);if("boolean"!=typeof t)throw new l.VxError(l.VxError.CODE.EPARAMTYPE,"enableText","boolean",r,this._logSubsystemId);if(!e&&!t)throw new l.VxError(l.VxError.CODE.EINCONSISTPARAMS,"enableAudio",r,this._logSubsystemId,"at least one of enableAudio and enableText must be true");if("string"!=typeof n)throw new l.VxError(l.VxError.CODE.EPARAMTYPE,"connectToken","string",r,this._logSubsystemId);if(!n)throw new l.VxError(l.VxError.CODE.EPARAMVALUE,"connectToken",r,this._logSubsystemId);if(e){if(void 0===this.streamLocal)throw new l.VxError(l.VxError.CODE.EMISSINGPROP,"streamLocal",r,this._logSubsystemId);if(!(this.streamLocal instanceof MediaStream))throw new l.VxError(l.VxError.CODE.EPROPTYPE,"streamLocal","MediaStream",r,this._logSubsystemId);if(!this.streamLocal)throw new l.VxError(l.VxError.CODE.EPROPVALUE,"streamLocal",r,this._logSubsystemId)}if(void 0===this._cbOnRemoteStream)throw new l.VxError(l.VxError.CODE.EMISSINGPROP,"onRemoteStream",r,this._logSubsystemId);if("function"!=typeof this._cbOnRemoteStream)throw new l.VxError(l.VxError.CODE.EPROPTYPE,"onRemoteStream","function",r,this._logSubsystemId);if(!this.onRemoteStream)throw new l.VxError(l.VxError.CODE.EPROPVALUE,"onRemoteStream",r,this._logSubsystemId);return this.startSession(e,t,n),!0},e.prototype.disconnect=function(){var e="ChannelSession.disconnect()";if(a.Logger.trace(),!this._isEstablished)throw new l.VxError(l.VxError.CODE.ESTATE,"not established",e,this._logSubsystemId);if(0!=arguments.length)throw new l.VxError(l.VxError.CODE.ENUMPARAMS,e,this._logSubsystemId);return this.removeSession(),!0},e.prototype.sendText=function(e,t,n,r,i){void 0===t&&(t=void 0),void 0===n&&(n=void 0),void 0===r&&(r=void 0),void 0===i&&(i=void 0);var o="Vivox5.ChannelSession.sendText()";if(a.Logger.trace(),!this.isEstablished)throw new l.VxError(l.VxError.CODE.ESTATE,"not established",o,this._logSubsystemId);if(arguments.length<1||arguments.length>5)throw new l.VxError(l.VxError.CODE.ENUMPARAMS,o,this._logSubsystemId);if("string"!=typeof e&&void 0!==e)throw new l.VxError(l.VxError.CODE.EPARAMTYPE,"text","string or undefined",o,this._logSubsystemId);if("string"!=typeof t&&void 0!==t)throw new l.VxError(l.VxError.CODE.EPARAMTYPE,"subject","string or undefined",o,this._logSubsystemId);if("string"!=typeof n&&void 0!==n)throw new l.VxError(l.VxError.CODE.EPARAMTYPE,"language","string or undefined",o,this._logSubsystemId);if("string"!=typeof r&&void 0!==r)throw new l.VxError(l.VxError.CODE.EPARAMTYPE,"applicationStanzaNamespace","string or undefined",o,this._logSubsystemId);if("string"!=typeof i&&void 0!==i)throw new l.VxError(l.VxError.CODE.EPARAMTYPE,"applicationStanzaBody","string or undefined",o,this._logSubsystemId);return this.sendTextMessage(e,t,n,r,i),!0},e.prototype.muteLocalCapture=function(e){a.Logger.trace(),this.streamLocal&&this.streamLocal.getAudioTracks().forEach((function(t){return t.enabled=e}))},e.prototype.muteForMe=function(e,t){var n="ChannelSession.muteForMe()";if(a.Logger.trace(),!this._isEstablished)throw new l.VxError(l.VxError.CODE.ESTATE,"not established",n,this._logSubsystemId);if(2!=arguments.length)throw new l.VxError(l.VxError.CODE.ENUMPARAMS,n,this._logSubsystemId);if("boolean"!=typeof e)throw new l.VxError(l.VxError.CODE.EPARAMTYPE,"doMute","boolean",n,this._logSubsystemId);if(!(t instanceof h.Participant))throw new l.VxError(l.VxError.CODE.EPARAMTYPE,"participant","Participant",n,this._logSubsystemId);if(!(t.participantId in this._participants))throw new l.VxError(l.VxError.CODE.EPARAMVALUE,"participant",n,this._logSubsystemId,"participant "+t.toString()+" does not exist in ChannelSession");if(t.localMute==i.NOTSUPPORTED)return!1;if(e)switch(t.localMute){case i.ON:case i.ENABLING:return!0;case i.DISABLING:throw new l.VxError(l.VxError.CODE.ESTATE,"reverse operation is in progress",n,this._logSubsystemId);case i.OFF:t.localMute=i.ENABLING}else switch(t.localMute){case i.OFF:case i.DISABLING:return!0;case i.ENABLING:throw new l.VxError(l.VxError.CODE.ESTATE,"reverse operation is in progress",n,this._logSubsystemId);case i.ON:t.localMute=i.DISABLING}var r=e?"local_mute":"local_unmute";return this.performMuteRequest(t,r)},e.prototype.muteUser=function(e,t,n){var r="ChannelSession.muteUser()";if(a.Logger.trace(),!this._isEstablished)throw new l.VxError(l.VxError.CODE.ESTATE,"not established",r,this._logSubsystemId);if(3!=arguments.length)throw new l.VxError(l.VxError.CODE.ENUMPARAMS,r,this._logSubsystemId);if("boolean"!=typeof e)throw new l.VxError(l.VxError.CODE.EPARAMTYPE,"doMute","boolean",r,this._logSubsystemId);if(!(t instanceof h.Participant))throw new l.VxError(l.VxError.CODE.EPARAMTYPE,"participant","Participant",r,this._logSubsystemId);if(!(t.participantId in this._participants))throw new l.VxError(l.VxError.CODE.EPARAMVALUE,"participant",r,this._logSubsystemId,"participant "+t.toString()+" does not exist in ChannelSession");if("string"!=typeof n)throw new l.VxError(l.VxError.CODE.EPARAMTYPE,"operationToken","string",r,this._logSubsystemId);if(!n)throw new l.VxError(l.VxError.CODE.EPARAMVALUE,"operationToken",r,this._logSubsystemId);var i=e?"mute":"unmute";return this.performMuteRequest(t,i,n)},e.prototype.kickUser=function(e,t){var n="ChannelSession.kickUser()";if(a.Logger.trace(),!this._isEstablished)throw new l.VxError(l.VxError.CODE.ESTATE,"not established",n,this._logSubsystemId);if(2!=arguments.length)throw new l.VxError(l.VxError.CODE.ENUMPARAMS,n,this._logSubsystemId);if(!(e instanceof h.Participant))throw new l.VxError(l.VxError.CODE.EPARAMTYPE,"participant","Participant",n,this._logSubsystemId);if(!(e.participantId in this._participants))throw new l.VxError(l.VxError.CODE.EPARAMVALUE,"participant",n,this._logSubsystemId,"participant "+e.toString()+" does not exist in ChannelSession");if("string"!=typeof t)throw new l.VxError(l.VxError.CODE.EPARAMTYPE,"operationToken","string",n,this._logSubsystemId);if(!t)throw new l.VxError(l.VxError.CODE.EPARAMVALUE,"operationToken",n,this._logSubsystemId);return this.performMuteRequest(e,"kick",t)},e.prototype.setAudioConnected=function(e){var t="ChannelSession.setAudioConnected()";if(a.Logger.trace(),!this._isEstablished)throw new l.VxError(l.VxError.CODE.ESTATE,"not established",t,this._logSubsystemId);if(1!=arguments.length)throw new l.VxError(l.VxError.CODE.ENUMPARAMS,t,this._logSubsystemId);if("boolean"!=typeof e)throw new l.VxError(l.VxError.CODE.EPARAMTYPE,"enable","boolean",t,this._logSubsystemId);return this.setIsAudioConnected(e)},e.prototype.setTextConnected=function(e){var t="ChannelSession.setTextConnected()";if(a.Logger.trace(),!this._isEstablished)throw new l.VxError(l.VxError.CODE.ESTATE,"not established",t,this._logSubsystemId);if(1!=arguments.length)throw new l.VxError(l.VxError.CODE.ENUMPARAMS,t,this._logSubsystemId);if("boolean"!=typeof e)throw new l.VxError(l.VxError.CODE.EPARAMTYPE,"enable","boolean",t,this._logSubsystemId);return this.setIsTextConnected(e)},e.prototype.getConnectToken=function(e,t){var n="ChannelSession.getConnectToken()";if(a.Logger.trace(),2!=arguments.length)throw new l.VxError(l.VxError.CODE.ENUMPARAMS,n,this._logSubsystemId);if("string"!=typeof e)throw new l.VxError(l.VxError.CODE.EPARAMTYPE,"tokenSigningKey","string",n,this._logSubsystemId);if("number"!=typeof t)throw new l.VxError(l.VxError.CODE.EPARAMTYPE,"tokenExpirationDuration","number",n,this._logSubsystemId);var r=f.Token.debugGenerateAccessToken(this.channel.issuer,t,"join","",this._accountJid,this._channelJid,e);return r},e.prototype.getOperationToken=function(e,t,n,r){var i="ChannelSession.getOperationToken()";if(a.Logger.trace(),4!=arguments.length)throw new l.VxError(l.VxError.CODE.ENUMPARAMS,i,this._logSubsystemId);if("string"!=typeof e)throw new l.VxError(l.VxError.CODE.EPARAMTYPE,"operation","string",i,this._logSubsystemId);if("mute"!=e&&"kick"!=e)throw new l.VxError(l.VxError.CODE.EPARAMVALUE,"operation",i,this._logSubsystemId);if(!(t instanceof c.AccountId))throw new l.VxError(l.VxError.CODE.EPARAMTYPE,"subject","AccountId",i,this._logSubsystemId);if("string"!=typeof n)throw new l.VxError(l.VxError.CODE.EPARAMTYPE,"tokenSigningKey","string",i,this._logSubsystemId);if("number"!=typeof r)throw new l.VxError(l.VxError.CODE.EPARAMTYPE,"tokenExpirationDuration","number",i,this._logSubsystemId);var o=f.Token.debugGenerateAccessToken(this.channel.issuer,r,e,t.toString(),this._accountJid,this._channelJid,n);return o},e.prototype.onConnectionLost=function(){a.Logger.trace(),this.onChannelSessionTerminatedInternal()},e.prototype.close=function(){a.Logger.trace(),this._self&&(this.releaseChannelSessionResourcesAll(),this._self=void 0)},e.prototype.toString=function(){return"[object ChannelSession("+this._channelJid+")]"},e.prototype.log=function(e){a.Logger.log(this._logSubsystemId,e)},e.prototype.startSession=function(e,t,n){var r=this;a.Logger.trace(),this.log(this._logPrefixSessionStarting+", sending presence with token"),this._isStarted=!0,this.addChannelSessionHandlers();var i=(0,s.$pres)({to:this._mucJidRes,id:g.Tools.makeUuid()}).c("m",{xmlns:b.Xmpp.NS.URN_VIVOX_PRESENCE}).up().c("x",{xmlns:s.Strophe.NS.MUC}).c("password",{}).t(n).tree(),o=Date.now();this._stropheConnection.sendPresence(i,(function(n){return r.onStartSessionResponse(n,e,t,o)}),this.onStartSessionVxError,b.Xmpp.DEFAULT_TRANSACTION_TIMEOUT)},e.prototype.removeSession=function(e){void 0===e&&(e=!1),a.Logger.trace(),e||(this.setIsTextConnected(!1),this.setIsAudioConnected(!1)),this._isEstablished=!1,(e||this._audioState==i.OFF&&this._textState==i.OFF)&&this.removeSessionSetUnavailable()},e.prototype.removeSessionSetUnavailable=function(){var e=this;a.Logger.trace(),this.releaseChannelSessionResourcesMedia(),this._isEstablished=!1,this.log(this._logPrefixSessionRemoving+": sending presence with unavailable indicator");var t=(0,s.$pres)({type:"unavailable",to:this._mucJidRes,id:g.Tools.makeUuid()}).tree(),n=Date.now(),r=function(t){return e.onRemoveSessionSetUnavailableResponse(t,n)};this._stropheConnection.sendPresence(t,r,r,b.Xmpp.DEFAULT_TRANSACTION_TIMEOUT)},e.prototype.checkOperStateAndAction=function(e,t,n){if(a.Logger.trace(),e==i.NOTSUPPORTED)return o.NOTSUPPORTED;var r=void 0;if(t)switch(e){case i.ON:case i.ENABLING:return o.NOTHINGTODO;case i.DISABLING:r="VxError: reverse operation is still in progress when "+n+"("+t+") called";break;case i.OFF:return o.CANSTART}else switch(e){case i.OFF:case i.DISABLING:return!0;case i.ENABLING:r="VxError: reverse operation is still in progress when "+n+"("+t+") called";break;case i.ON:return o.CANSTART}return r?(this.log(r),o.NOTPOSSIBLE):void 0},e.prototype.createTextAudioIndicatorsStanza=function(){a.Logger.trace();var e=this._audioState==i.ON||this._audioState==i.ENABLING,t=this._textState==i.ON||this._textState==i.ENABLING,n=(0,s.$pres)({to:this._mucJidRes,id:g.Tools.makeUuid()}).c("m",{xmlns:b.Xmpp.NS.URN_VIVOX_PRESENCE});return e&&n.c("audio",{}).up(),t&&n.c("text",{}).up(),n.tree()},e.prototype.sendTextAudioIndicatorsStanza=function(e){a.Logger.trace();var t=this.createTextAudioIndicatorsStanza();this._stropheConnection.sendPresence(t,e,this.onSetTextOrAudioConnectedVxError,b.Xmpp.DEFAULT_TRANSACTION_TIMEOUT)},e.prototype.performSetAudioOrTextConnectedScheduledActions=function(){a.Logger.trace(),this._audioConnectScheduled&&(this._audioConnectScheduled=!1,this._audioDisconnectScheduled=!1,this.setIsAudioConnected(!0)),this._audioDisconnectScheduled&&(this._audioConnectScheduled=!1,this._audioDisconnectScheduled=!1,this.setIsAudioConnected(!1)),this._textConnectScheduled&&(this._textConnectScheduled=!1,this._textDisconnectScheduled=!1,this.setIsTextConnected(!0)),this._audioDisconnectScheduled&&(this._textConnectScheduled=!1,this._textDisconnectScheduled=!1,this.setIsTextConnected(!1)),this._audioState==i.OFF&&this._textState==i.OFF&&this.removeSessionSetUnavailable()},e.prototype.performInviteHandshake=function(){if(a.Logger.trace(),!this._inviteCompleted){this.log(this._logPrefixSessionStarting+", sending IQ with INVITE and fake SDP");var e=g.Tools.makeUuid(),t=g.Tools.getRandomInt(1e8,999999999),n=window.navigator.userAgent.indexOf("Edge/")>-1;"dumb"===this.overrideRTCPCMode?n=!0:"multi"===this.overrideRTCPCMode&&(n=!1);var r=n?"webrtc-dumb":"webrtc",i=(0,s.$iq)({id:e,to:this._mucJid,type:"set"}).c("invite",{callid:t,xmlns:b.Xmpp.NS.URN_VIVOX_MUC}).t(r).tree();this._stropheConnection.sendIQ(i,this.onInviteResponse,this.onInviteVxError,b.Xmpp.DEFAULT_TRANSACTION_TIMEOUT)}},e.prototype.afterInviteSucceeded=function(){var e=this;a.Logger.trace(),this._inviteInProgress=!1,this._inviteCompleted=!0,this.sendTextAudioIndicatorsStanza((function(t){return e.onSetAudioConnectedResponse(t,!0)}))},e.prototype.addChannelSessionHandlers=function(){a.Logger.trace(),this._handOnParticipantUpdated=this._stropheConnection.addHandler(this.onParticipantUpdatedInternal,s.Strophe.NS.MUC,"presence",null,null,this._mucJid,{matchBareFromJid:!0,ignoreNamespaceFragment:!0}),this._handOnParticipantRemoved=this._stropheConnection.addHandler(this.onParticipantRemovedInternal,s.Strophe.NS.MUC,"presence","unavailable",null,this._mucJid,{matchBareFromJid:!0,ignoreNamespaceFragment:!0}),this._handOnGroupMessage=this._stropheConnection.addHandler(this.onGroupMessage,s.Strophe.NS.CLIENT,"message","groupchat",null,this._mucJid,{matchBareFromJid:!0,ignoreNamespaceFragment:!0})},e.prototype.removeChannelSessionHandlers=function(){a.Logger.trace(),this._handOnParticipantUpdated&&(this._stropheConnection.deleteHandler(this._handOnParticipantUpdated),this._handOnParticipantUpdated=void 0),this._handOnParticipantRemoved&&(this._stropheConnection.deleteHandler(this._handOnParticipantRemoved),this._handOnParticipantRemoved=void 0),this._handOnGroupMessage&&(this._stropheConnection.deleteHandler(this._handOnGroupMessage),this._handOnGroupMessage=void 0)},e.prototype.onMuteResponse=function(e,t,n,r){a.Logger.trace();var i="local_mute"==t||"local_unmute"==t,o=!1,s=e.getElementsByTagName(t);s&&s.length>0?(o=!0,this.log(t+" operation succeeded for "+n.account.toString())):(o=!1,this.log(t+" operation failed for "+n.account.toString()+": no <"+t+"> element in response")),i&&this.updateLocalMuteStateForParticipant(n,t,o)},e.prototype.initiateWsConnectionWithPatchPanel=function(e){return a.Logger.trace(),this._wsConnectionPatchPanel?(this.log("Already have a connection with PatchPanel ["+this._wsUriPatchPanel+"], will not initiate new connection to "+e),!1):(this.log("Initiating WebSocket connection with PatchPanel to "+e),this._wsUriPatchPanel=e,this._wsConnectionPatchPanel=new WebSocket(this._wsUriPatchPanel),this._wsConnectionPatchPanel.onopen=this.onWSPPConnected,this._wsConnectionPatchPanel.onclose=this.onWSPPDisconnected,this._wsConnectionPatchPanel.onerror=this.onWSPPVxError,this._wsConnectionPatchPanel.onmessage=this.onWSPPMessage,!0)},e.prototype.releaseChannelSessionResourcesMedia=function(){a.Logger.trace(),this.destroyWsConnectionWithPatchPanel(),this.destroyRTCPC(),this.removeChannelSessionHandlers()},e.prototype.releaseChannelSessionResourcesAll=function(){for(var e in a.Logger.trace(),this.destroyWsConnectionWithPatchPanel(),this.destroyRTCPC(),this.removeChannelSessionHandlers(),this.releaseCallbacks(),this._stropheConnection=void 0,this._participants)delete this._participants[e];for(var t in this._participants=void 0,this._participantsByRoomNick)delete this._participantsByRoomNick[t];this._participantsByRoomNick=void 0},e.prototype.releaseCallbacks=function(){a.Logger.trace(),this._cbOnSessionEstablished=void 0,this._cbOnSessionTerminated=void 0,this._cbOnParticipantAdded=void 0,this._cbOnParticipantUpdated=void 0,this._cbOnParticipantRemoved=void 0,this._cbOnChannelTextMessage=void 0,this._cbOnAudioStateUpdated=void 0,this._cbOnTextStateUpdated=void 0,this._cbOnRemoteStream=void 0},e.prototype.destroyWsConnectionWithPatchPanel=function(){this._wsConnectionPatchPanel&&(a.Logger.trace(),this.log("Destroying WebSocket connection with PatchPanel"),this._isWSPPConnected=!1,this._wsUriPatchPanel=void 0,this._wsConnectionPatchPanel.onopen=void 0,this._wsConnectionPatchPanel.onclose=void 0,this._wsConnectionPatchPanel.onerror=void 0,this._wsConnectionPatchPanel.onmessage=void 0,this._wsConnectionPatchPanel.close(),this._wsConnectionPatchPanel=void 0)},e.prototype.destroyRTCPC=function(){for(var e in a.Logger.trace(),this._arrRTCPC)this._arrRTCPC[e].onaddstream=void 0,this._arrRTCPC[e].ontrack=void 0,this._arrRTCPC[e].close(),delete this._arrRTCPC[e];this.streamLocal=void 0},e.prototype.parsePPMessage=function(e,t){if(void 0===t&&(t=!1),a.Logger.trace(),t)try{e=atob(e),console.log("Base64-decoded PP msg:",e)}catch(e){return this.log("Failed to decode the message from PP as base64, ignored"),null}var n=m.Xml.parseXml(e);if(!n)return this.log("Failed to parse the message from PP as XML, ignored"),null;var r=m.Xml.xmlToObj(n);return r?("wrtc"in r&&(r=r.wrtc),console.log("Parsed XML from PP msg (obj):",r),console.log("Parsed XML from PP msg (JSON): "+JSON.stringify(r)),r.addrtcpc?this.validateMsgAddrtcpc(r.addrtcpc)?r:null:(this.log("unknown message (not <addrtcpc>), ignored"),null)):(this.log("Failed to parse XML message from PP as object, ignored"),null)},e.prototype.validateMsgAddrtcpc=function(e){if(a.Logger.trace(),Array.isArray(e)){this.log(e.length+" <addrtcpc> messages received in one command");var t=e.length>0;for(var n in e)if(!(t=t&&this.validateMsgAddrtcpc(e[n])))break;return t}if(this.log("Validating <addrtcpc> message"),e._attrs||(e._attrs={}),!e._attrs.id){var r=0;do{r=g.Tools.getRandomInt(1,4294967295)}while(r in this._arrRTCPC);e._attrs.id=r}"self"in e||(e.self=0==g.Tools.propCount(this._arrRTCPC)?"1":"0",console.log("addrtcpc.self defaults to "+e.self+" (arrRTCPC has "+g.Tools.propCount(this._arrRTCPC)+" objects)"));var i=!0,o=["addr","port","pt","iceufrag","icepwd","fingerprint","self"];for(n=0;n<o.length;++n)o[n]in e?0==e[o[n]].length&&(this.log("Mandatory parameter "+o[n]+" is empty in the <addrtcpc> message "+JSON.stringify(e)),i=!1):(this.log("Mandatory parameter "+o[n]+" not found in the <addrtcpc> message "+JSON.stringify(e)),i=!1);if(!i)return!1;function s(t,n){this.log("Parameter "+t+" has invalid value "+n+" in the <addrtcpc> message "+JSON.stringify(e))}if(!g.Tools.isValidIpAddress(e.addr))return s("addr",e.addr),!1;if(!g.Tools.isIntegerInRange(e.port,1,65535))return s("port",e.port),!1;if(!g.Tools.isIntegerInRange(e.pt,0,127))return s("pt",e.pt),!1;var c="stream"in e?Array.isArray(e.stream)?e.stream.length:1:0;if(c>0)for(n=0;n<c;++n){var u=1==c?e.stream._attrs:e.stream[n]._attrs;if(!("ssrc"in u))return this.log("Mandatory attribute ssrc not found in the <stream> element of the <addrtcpc> message "+JSON.stringify(e)),!1;if(!g.Tools.isIntegerInRange(u.ssrc,0,4294967295))return s("ssrc",u.ssrc),!1;"sid"in u||(u.sid="sid"+u.ssrc),"tid"in u||(u.tid="tid"+u.ssrc),"cname"in u||(u.cname="rtcpcname"+u.ssrc)}return!0},e.prototype.reconstructServerSdpOffer=function(e){a.Logger.trace();var t,n="",r=g.Tools.getRandomInt(1e9,9999999999),i=g.Tools.getRandomInt(1e9,9999999999),o="stream"in e?Array.isArray(e.stream)?e.stream.length:1:0,s=o<=1;this.log("Reconstructing SDP Offer from the server [streamsCount="+o+", isSimpleSdp="+s+"]");var c="";if(s)c="Simple, one stream",n="v=0\r\no=- "+r+" 0 IN IP4 "+e.addr+"\r\ns=Vivox\r\nc=IN IP4 "+e.addr+"\r\nt=0 0\r\na=ice-lite\r\nm=audio "+e.port+" UDP/TLS/RTP/SAVPF "+e.pt+"\r\nc=IN IP4 "+e.addr+"\r\na=rtpmap:"+e.pt+" opus/48000/2\r\na=fmtp:"+e.pt+" maxplaybackrate=48000\r\na=setup:actpass\r\na="+("0"==e.self?"sendonly":"sendrecv")+"\r\na=ice-ufrag:"+e.iceufrag+"\r\na=ice-pwd:"+e.icepwd+"\r\na=fingerprint:"+e.fingerprint+"\r\na=candidate:"+i+" 1 udp 2122260223 "+e.addr+" "+e.port+" typ host generation 0\r\na=end-of-candidates\r\na=rtcp-mux\r\n","stream"in e&&(n+="a=ssrc:"+(t=e.stream._attrs).ssrc+" cname:"+t.cname+"\r\na=ssrc:"+t.ssrc+" msid:"+t.sid+" "+t.tid+"\r\na=ssrc:"+t.ssrc+" mslabel:"+t.sid+"\r\na=ssrc:"+t.ssrc+" label:"+t.tid+"\r\na=msid:"+t.sid+" "+t.tid+"\r\n");else{c="Plan Unified";for(var u="",l=0;l<o;++l)u+=" sdparta_"+l;n="v=0\r\no=- "+r+" 0 IN IP4 "+e.addr+"\r\ns=Vivox\r\nc=IN IP4 "+e.addr+"\r\nt=0 0\r\na=ice-lite\r\na=ice-ufrag:"+e.iceufrag+"\r\na=ice-pwd:"+e.icepwd+"\r\na=fingerprint:"+e.fingerprint+"\r\na=msid-semantic:WMS *\r\na=group:BUNDLE"+u+"\r\n";for(var d=0;d<o;++d)t=e.stream[d]._attrs,n+="m=audio "+(0==d?e.port:9)+" UDP/TLS/RTP/SAVPF "+e.pt+"\r\nc=IN IP4 "+(0==d?e.addr:"0.0.0.0")+"\r\n"+(0==d?"":"a=bundle-only\r\n")+"a=rtpmap:"+e.pt+" opus/48000/2\r\na=fmtp:"+e.pt+" maxplaybackrate=48000\r\na=setup:actpass\r\na="+("0"==e.self?"sendonly":"sendrecv")+"\r\na=rtcp-mux\r\na=mid:sdparta_"+d+"\r\na=msid:"+t.sid+" "+t.tid+"\r\na=ssrc:"+t.ssrc+" cname:"+t.cname+"\r\n",0==d&&(n+="a=candidate:"+i+" 1 udp 2122260223 "+e.addr+" "+e.port+" typ host generation 0\r\na=end-of-candidates\r\n")}return this.log("Reconstructed SDP Offer ("+c+"):\n"+n),n},e.prototype.processSDPOffer=function(e,t){var n=this;a.Logger.trace(),this.log("Processing remote SDP Offer");var r=this._arrRTCPC[e],i=new RTCSessionDescription({type:"offer",sdp:t});r.setRemoteDescription(i).then((function(){console.log("TRACE: after setRemoteDescription, before createAnswer"),r.createAnswer().then((function(t){n.onSDPAnswerCreated(e,t)})).catch((function(t){n.sdpVxErrorHandler(e,t,"SDP createAnswer")}))})).catch((function(t){n.sdpVxErrorHandler(e,t,"SDP setRemoteDescription")}))},e.prototype.sdpVxErrorHandler=function(e,t,n){a.Logger.trace();var r="SDP error for RTCPC["+e+"]"+(void 0===n?":":" ("+n+"):");this.log(r+" "+t.toString()),console.log(r,t)},e.prototype.sendTextMessage=function(e,t,n,r,i){void 0===e&&(e=void 0),void 0===t&&(t=void 0),void 0===n&&(n=void 0),void 0===r&&(r=void 0),void 0===i&&(i=void 0),a.Logger.trace();var o={to:this._mucJid,type:"groupchat",id:g.Tools.makeUuid()};n&&(o["xml:lang"]=n);var c=(0,s.$msg)(o);e&&c.c("body").t(e).up(),t&&c.c("subject").t(t).up(),r&&i&&c.c("application",{xmlns:r}).t(i).up();var u=c.tree();this._stropheConnection.send(u)},e.prototype.setIsAudioConnected=function(e){var t=this;if(this._textState==i.ENABLING||this._textState==i.DISABLING)return e?(this._audioConnectScheduled=!0,this._audioDisconnectScheduled=!1):(this._audioConnectScheduled=!1,this._audioDisconnectScheduled=!0),!0;switch(this.checkOperStateAndAction(this._audioState,e,"setAudioConnected")){case o.CANSTART:break;case o.NOTHINGTODO:return!0;case o.NOTPOSSIBLE:case o.NOTSUPPORTED:default:return!1}if(e){if(this._audioState=i.ENABLING,!this._inviteCompleted)return this.performInviteHandshake(),!0}else this._audioState=i.DISABLING;return this.sendTextAudioIndicatorsStanza((function(n){return t.onSetAudioConnectedResponse(n,e)})),!0},e.prototype.setIsTextConnected=function(e){var t=this;if(this._audioState==i.ENABLING||this._audioState==i.DISABLING)return e?(this._textConnectScheduled=!0,this._textDisconnectScheduled=!1):(this._textConnectScheduled=!1,this._textDisconnectScheduled=!0),!0;switch(this.checkOperStateAndAction(this._textState,e,"setTextConnected")){case o.CANSTART:break;case o.NOTHINGTODO:return!0;case o.NOTPOSSIBLE:case o.NOTSUPPORTED:default:return!1}return this._textState=e?i.ENABLING:i.DISABLING,this.sendTextAudioIndicatorsStanza((function(n){return t.onSetTextConnectedResponse(n,e)})),!0},e.CHANTYPE=r,e.OPERSTATE=i,e}();Object.defineProperty(_,"CHANTYPE",{writable:!1,configurable:!1,enumerable:!0}),Object.defineProperty(_,"OPERSTATE",{writable:!1,configurable:!1,enumerable:!0})},function(e,t,n){"use strict";function r(e,t){return void 0===t&&(t=Object),t&&"function"==typeof t.freeze?t.freeze(e):e}var i=r({HTML:"text/html",isHTML:function(e){return e===i.HTML},XML_APPLICATION:"application/xml",XML_TEXT:"text/xml",XML_XHTML_APPLICATION:"application/xhtml+xml",XML_SVG_IMAGE:"image/svg+xml"}),o=r({HTML:"http://www.w3.org/1999/xhtml",isHTML:function(e){return e===o.HTML},SVG:"http://www.w3.org/2000/svg",XML:"http://www.w3.org/XML/1998/namespace",XMLNS:"http://www.w3.org/2000/xmlns/"});t.assign=function(e,t){if(null===e||"object"!=typeof e)throw new TypeError("target is not an object");for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e},t.find=function(e,t,n){if(void 0===n&&(n=Array.prototype),e&&"function"==typeof n.find)return n.find.call(e,t);for(var r=0;r<e.length;r++)if(Object.prototype.hasOwnProperty.call(e,r)){var i=e[r];if(t.call(void 0,i,r,e))return i}},t.freeze=r,t.MIME_TYPE=i,t.NAMESPACE=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ChannelId=void 0;var r=n(1),i=n(0),o=n(2),s=n(7),a=function(){function e(t,n,a,c,u){if(r.Logger.trace(),void 0!==n&&void 0!==a)o.Tools.validateIssuerName(t,"ChannelId()","CORE"),o.Tools.validateChannelName(n,"ChannelId()","CORE"),this.domain=o.Tools.validateAndFormatDomainName(a,"ChannelId()","CORE"),c&&o.Tools.validateChannelType(c,"ChannelId()","CORE"),this.issuer=t.toString(),this.name=n,this.type=c||s.ChannelSession.CHANTYPE.CONF,this.environmentId="",u&&(this.environmentId=u,o.Tools.validateEnvironmentId(u,"ChannelId()","CORE"));else if(1==arguments.length)if("string"==typeof t||t instanceof String){var l=/^confctl-(g|e)-([a-zA-Z0-9-_]+)\.([a-zA-Z0-9]+)\.?([a-zA-Z0-9-]+)?@(([a-z0-9]+\.)+([a-z]+))$/,d=t.match(l);if(!(d&&d.length>=5))throw new i.VxError(i.VxError.CODE.EPARAMVALUE,"jid","ChannelId()","CORE");this.type="g"==d[1]?s.ChannelSession.CHANTYPE.CONF:s.ChannelSession.CHANTYPE.ECHO,this.issuer=d[2],this.name=d[3],this.environmentId=d[4]||"",this.domain=d[5]}else{if(!(t instanceof e))throw new i.VxError(i.VxError.CODE.EPARAMTYPE,"channelId","string or ChannelId","ChannelId()","CORE");this.issuer=t.issuer,this.name=t.name,this.environmentId=t.environmentId,this.domain=t.domain,this.type=t.type}Object.defineProperties(this,{issuer:{writable:!1,configurable:!1,enumerable:!0},name:{writable:!1,configurable:!1,enumerable:!0},domain:{writable:!1,configurable:!1,enumerable:!0},type:{writable:!1,configurable:!1,enumerable:!0},environmentId:{writable:!1,configurable:!1,enumerable:!0}})}return Object.defineProperty(e.prototype,"channelName",{get:function(){return this.type&&this.issuer&&"string"==typeof this.issuer&&this.name&&"string"==typeof this.name?this.environmentId&&"string"==typeof this.environmentId?"confctl-".concat(this.type,"-").concat(this.issuer,".").concat(this.name,".").concat(this.environmentId):"confctl-".concat(this.type,"-").concat(this.issuer,".").concat(this.name):""},enumerable:!1,configurable:!0}),e.prototype.isEmpty=function(){return!this.issuer&&!this.name&&!this.domain},e.prototype.toString=function(){return"confctl-"+this.type+"-"+this.issuer+"."+this.name+(""!==this.environmentId?"."+this.environmentId:"")+"@"+this.domain},e.prototype.valueOf=function(){return this.toString()},e.prototype.equals=function(t){return t instanceof e&&this.issuer===t.issuer&&this.name===t.name&&this.domain===t.domain&&this.environmentId===t.environmentId&&this.type===t.type},e}();t.ChannelId=a},function(e,t,n){"use strict";var r=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.LoginSession=void 0;var o,s,a=n(13),c=i(n(48)),u=i(n(50)),l=n(1),d=n(4),h=n(9),p=n(7),f=n(23),g=n(0),m=n(11),b=n(24),_=n(14),S=n(16),y=n(2),v=n(26),E=n(27);!function(e){e[e.LOGGED_OUT=0]="LOGGED_OUT",e[e.PRELOGIN=1]="PRELOGIN",e[e.LOGGING_IN=2]="LOGGING_IN",e[e.LOGGED_IN=3]="LOGGED_IN",e[e.LOGGING_OUT=4]="LOGGING_OUT",e[e.FINISHED=5]="FINISHED"}(o||(o={})),function(e){e[e.ACCEPT=0]="ACCEPT",e[e.BLOCK=1]="BLOCK",e[e.DEFER=2]="DEFER"}(s||(s={}));var C=t.LoginSession=function(){function e(e,t,n){void 0===t&&(t=!0),void 0===n&&(n=void 0);var r=this;if(this.stropheConnection=null,this._xhrPrelogin=null,this._subscrMode=s.DEFER,this._loginAccessToken="",this._presence=new m.Presence,this.state=o.LOGGED_OUT,this.channelSessions={},this.allowedSubscriptions=new Set,this.blockedSubscriptions=new Set,this.incomingSubscriptionRequests=new Set,this.presenceSubscriptions=new Map,this.presenceSubscriptionsScheduled=new Set,this._cbOnConnected=void 0,this._cbOnDisconnected=void 0,this._cbOnChannelSessionAdded=void 0,this._cbOnChannelSessionRemoved=void 0,this._cbOnDirectedTextMessage=void 0,this._cbOnIncomingSubscriptionRequest=void 0,this._cbOnBuddyAdded=void 0,this._cbOnBuddyRemoved=void 0,this._cbOnBuddyPresence=void 0,this.internalId=y.Tools.generateInternalId(),this._logSubsystemId="LS-"+this.internalId,this._className="LoginSession",this._self=this,this._handOnDirectedMessage=void 0,this._handOnDirectedMessageVxError=void 0,this._handOnIncomingSubscription=void 0,this._handOnPingFromServer=void 0,this._handOnRosterPush=void 0,this._loginStartTime=void 0,this._clientToServerPingInterval=void 0,this.onStropheRawInput=function(e){l.Logger.logTraffic("RECV "+e)},this.onStropheRawOutput=function(e){l.Logger.logTraffic("SENT "+e)},this.onStropheXmlOutput=function(e){"open"===e.tagName&&r.addUserAgent(e)},this.onStropheConnectionEvent=function(e,t){switch(l.Logger.trace(),e){case a.Strophe.Status.CONNECTING:r.log("XMPP Client is connecting");break;case a.Strophe.Status.DISCONNECTING:r.log("XMPP Client is disconnecting");break;case a.Strophe.Status.AUTHENTICATING:r.log("XMPP Client is authenticating");break;case a.Strophe.Status.CONNFAIL:r.log("XMPP Client connection failure");break;case a.Strophe.Status.DISCONNECTED:r.log("XMPP Client is disconnected"),r.onDisconnectedInternal();break;case a.Strophe.Status.AUTHFAIL:r.log("XMPP Client authentication failure"),r.state=o.FINISHED,r.stropheConnection.disconnect();break;case a.Strophe.Status.ERROR:r.log("XMPP Client error: "+t),r.state=o.FINISHED,r.stropheConnection.disconnect();break;case a.Strophe.Status.CONNECTED:r.log("XMPP Client is connected"),r.onStropheConnected();break;default:var n="onStropheConnectionEvent unknown status = "+e+", error = "+t;r.log(n)}},this.onPreloginResponse=function(){if(l.Logger.trace(),200==r._xhrPrelogin.status)if("text/xml"==r._xhrPrelogin.getResponseHeader("Content-Type").substr(0,8)){var e=v.Xml.xmlToObj(r._xhrPrelogin.responseXML);if(e)if(e.VCConfiguration&&e.VCConfiguration.WSXMPPServer){clearInterval(r._clientToServerPingInterval);var t=1e3*(e.VCConfiguration.XmppPingIntervalSeconds?e.VCConfiguration.XmppPingIntervalSeconds:60);r._clientToServerPingInterval=setInterval(r.sendPingToServer,t),e.VCConfiguration.WSXMPPServer&&(r._uriWsXmpp=e.VCConfiguration.WSXMPPServer,r.log("Prelogin succeeded, server URI is "+r._uriWsXmpp)),r.releaseXhrPrelogin(),r.performStropheConnection()}else r.log("Prelogin failed: VCConfiguration/WSXMPPServer parameter not found");else r.log("Failed to parse prelogin XML response's object")}else r.log("Failed to parse prelogin response, not XML: "+r._xhrPrelogin.getResponseHeader("Content-Type"));else r.log("Prelogin failed: "+r._xhrPrelogin.status+" "+r._xhrPrelogin.statusText)},this.onPreloginTimeout=function(){l.Logger.trace(),r.log("Timeout occurred during prelogin download"),r.releaseXhrPrelogin(),r.onDisconnectedInternal()},this.onPreloginVxError=function(){l.Logger.trace(),r.log("An error occurred during prelogin download"),r.releaseXhrPrelogin(),r.onDisconnectedInternal()},this.onDisconnectedInternal=function(){for(var e in l.Logger.trace(),r.state=o.FINISHED,r.channelSessions)r.channelSessions[e].onConnectionLost();r._cbOnDisconnected&&"function"==typeof r._cbOnDisconnected&&r._cbOnDisconnected(r),clearInterval(r._clientToServerPingInterval),f.Client.onLoginSessionDisconnectedInternal(r)},this.onStropheConnected=function(){l.Logger.trace(),r.state=o.LOGGED_IN,r.addLoginSessionHandlers(),r.requestInitialRoster(),r._cbOnConnected&&"function"==typeof r._cbOnConnected&&r._cbOnConnected(r)},this.onConnectedFinal=function(){l.Logger.trace(),y.Tools.propCount(r.presenceSubscriptionsScheduled)>0&&(r.addPresenceSubscription(r.presenceSubscriptionsScheduled),y.Tools.clearObject(r.presenceSubscriptionsScheduled))},this.onRequestInitialRosterResponse=function(e){l.Logger.trace();var t=e.getElementsByTagName("query");if(t&&t[0]&&t[0].getAttribute("xmlns")==a.Strophe.NS.ROSTER){var n=t[0].getElementsByTagName("item");r.log("Roster received with "+n.length+" items");for(var i=0;i<n.length;++i)r.updatePresenceSubscriptionByRosterItem(n[i],!0);r.onConnectedFinal()}else r.log("Failed to parse roster response: element <query type='"+a.Strophe.NS.ROSTER+"' not found")},this.onRequestInitialRosterVxError=function(e){return l.Logger.trace(),r.onConnectedFinal(),!1},this.onRosterPush=function(e){if(l.Logger.trace(),e.hasAttribute("from")&&a.Strophe.getBareJidFromJid(e.getAttribute("from"))!=r._accountJid)return!0;var t=e.getElementsByTagName("query");if(t&&t[0]&&t[0].getAttribute("xmlns")==a.Strophe.NS.ROSTER){for(var n=t[0].getElementsByTagName("item"),i=0;i<n.length;++i)r.updatePresenceSubscriptionByRosterItem(n[i],!1);return!0}r.log("Failed to parse roster push: element <query type='"+a.Strophe.NS.ROSTER+"' not found")},this.sendPingToServer=function(){if(l.Logger.trace(),r.state==o.LOGGED_IN){var e=r._accountJid,t=y.Tools.makeUuid(),n=(0,a.$iq)({id:y.Tools.makeUuid(),from:e,type:"get"}).c("ping",{xmlns:a.Strophe.NS.PING}).tree();r.log("pinging server with from:"+e+" and id: "+t),r.stropheConnection.sendIQ(n)}},this.onPingFromServer=function(e){if(l.Logger.trace(),e&&e.attributes&&e.attributes.length>=1){var t=e.getAttribute("from"),n=e.getAttribute("to"),i=e.getAttribute("id");r.log("ping inbound is from :"+t+" and To: "+n);var o=(0,a.$iq)({type:"result",to:t,id:i});r.log("pong outbound is to:"+t+" and from: "+n),r.stropheConnection.sendIQ(o)}},this.onDirectedMessage=function(e){l.Logger.trace();var t=e.getAttribute("from");if(!t)return r.log("Ignored unidentified directed message: "+v.Xml.xmlToString(e)),!0;var n=a.Strophe.getBareJidFromJid(t),i=e.getElementsByTagName("subject"),o=void 0;i&&i[0]&&i[0].childNodes.length>=1&&3==i[0].childNodes[0].nodeType&&(o=i[0].childNodes[0].nodeValue);var s=e.getElementsByTagName("body");s&&s[0]&&s[0].childNodes.length>=1&&3==s[0].childNodes[0].nodeType&&(o=s[0].childNodes[0].nodeValue);var c=e.getAttribute("xml:lang");c||(c=void 0);var u=void 0,h=void 0,p=e.getElementsByTagName("application");p&&p[0]&&p[0].childNodes.length>=1&&3==p[0].childNodes[0].nodeType&&(u=p[0].getAttribute("xmlns"),h=p[0].childNodes[0].nodeValue);var f="Directed message received: from "+n+", subject = <undefined>, body = "+(void 0===o?"<undefined>":"'"+o+"'");r.log(f);var g=new d.AccountId(n);if(r._cbOnDirectedTextMessage&&"function"==typeof r._cbOnDirectedTextMessage){var m=new _.TextMessage(o,void 0,g,void 0,void 0,void 0,c,u,h);r._cbOnDirectedTextMessage(r,m)}return!0},this.onDirectedMessageVxError=function(e){l.Logger.trace();var t=void 0,n=e.getElementsByTagName("body");return n&&n[0]&&n[0].childNodes.length>=1&&3==n[0].childNodes[0].nodeType&&(t=n[0].childNodes[0].nodeValue),l.Logger.logXmppError(r._logSubsystemId,e,"VxError delivering message '"+t+"'"),!0},this.onIncomingSubscription=function(e){l.Logger.trace();var t=e.getAttribute("from");if(!t)return r.log("Ignored unidentified incoming subscription request: "+v.Xml.xmlToString(e)),!0;var n=a.Strophe.getBareJidFromJid(t),i=r._subscrMode==s.ACCEPT&&!r.blockedSubscriptions.has(n)||r.allowedSubscriptions.has(n),o=r._subscrMode==s.BLOCK&&!r.allowedSubscriptions.has(n)||r.blockedSubscriptions.has(n);if(i&&o&&(i=!1),r.log("Incoming subscription request from "+n+(i?" automatically accepted":o?" automatically blocked":" deferred")),i?r.acceptIncomingSubscription(n):o?r.denyIncomingSubscription(n):r.incomingSubscriptionRequests.add(n),!o&&r._cbOnIncomingSubscriptionRequest&&"function"==typeof r._cbOnIncomingSubscriptionRequest){var c=new d.AccountId(n);r._cbOnIncomingSubscriptionRequest(r,c,i)}return!0},this.onPresSubSubscribed=function(e){l.Logger.trace()},this.onPresSubUnsubscribed=function(e){l.Logger.trace();var t=e.subscribedAccount,n=t.toString();r.presenceSubscriptions.has(n)&&r.presenceSubscriptions.delete(n),r._cbOnBuddyRemoved&&"function"==typeof r._cbOnBuddyRemoved&&r._cbOnBuddyRemoved(r,t)},this.onPresSubBuddyPresence=function(e){l.Logger.trace(),r._cbOnBuddyPresence&&"function"==typeof r._cbOnBuddyPresence&&r._cbOnBuddyPresence(r,e.subscribedAccount,e.locations)},l.Logger.trace(),a.Strophe.addNamespace("PING","urn:xmpp:ping"),this.loginSessionId=e,this.loginSessionId.isEmpty())throw new g.VxError(g.VxError.CODE.EPARAMVALUE,"loginSessionId",this._className,this._logSubsystemId);if(void 0!==n&&"string"!=typeof n)throw new g.VxError(g.VxError.CODE.EPARAMTYPE,"uriWsXmpp","undefined",this._className,this._logSubsystemId);if(void 0!==n&&!y.Tools.isValidWsUri(n))throw new g.VxError(g.VxError.CODE.EPARAMVALUE,"uriWsXmpp",this._className,this._logSubsystemId);this._accountJid=e.toString(),this._forceSecurePreloginURI=t,this._uriWsXmpp=n}return Object.defineProperty(e.prototype,"channelSessionsCount",{get:function(){return y.Tools.propCount(this.channelSessions)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"presence",{get:function(){return this._presence},set:function(e){this._presence=e,this.sendOwnPresence()},enumerable:!1,configurable:!0}),e.prototype.onChannelSessionTerminatedInternal=function(e){if(l.Logger.trace(),!(e.channel.toString()in this.channelSessions))return!1;if(delete this.channelSessions[e.channel.toString()],this._cbOnChannelSessionRemoved&&"function"==typeof this._cbOnChannelSessionRemoved&&this._cbOnChannelSessionRemoved(this,e),e.close(),this.state===o.LOGGING_OUT){var t=!1;for(var n in this.channelSessions){t=!0;break}t||(this.removeLoginSessionHandlers(),this.stropheConnection.disconnect())}return!0},e.prototype.validateCB=function(e,t){if("function"!=typeof e&&void 0!==e)throw new g.VxError(g.VxError.CODE.EPROPTYPE,t,"function",this._className,this._logSubsystemId)},Object.defineProperty(e.prototype,"isConnected",{get:function(){return this.state===o.LOGGED_IN},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onConnected",{get:function(){return this._cbOnConnected},set:function(e){this.validateCB(e,"onConnected"),this._cbOnConnected=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onDisconnected",{get:function(){return this._cbOnDisconnected},set:function(e){this.validateCB(e,"onDisconnected"),this._cbOnDisconnected=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onChannelSessionAdded",{get:function(){return this._cbOnChannelSessionAdded},set:function(e){this.validateCB(e,"onChannelSessionAdded"),this._cbOnChannelSessionAdded=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onChannelSessionRemoved",{get:function(){return this._cbOnChannelSessionRemoved},set:function(e){this.validateCB(e,"onChannelSessionRemoved"),this._cbOnChannelSessionRemoved=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onIncomingSubscriptionRequest",{get:function(){return this._cbOnIncomingSubscriptionRequest},set:function(e){this.validateCB(e,"onIncomingSubscriptionRequest"),this._cbOnIncomingSubscriptionRequest=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onDirectedTextMessage",{get:function(){return this._cbOnDirectedTextMessage},set:function(e){this.validateCB(e,"onDirectedTextMessage"),this._cbOnDirectedTextMessage=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onBuddyAdded",{get:function(){return this._cbOnBuddyAdded},set:function(e){this.validateCB(e,"onBuddyAdded"),this._cbOnBuddyAdded=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onBuddyRemoved",{get:function(){return this._cbOnBuddyRemoved},set:function(e){this.validateCB(e,"onBuddyRemoved"),this._cbOnBuddyRemoved=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onBuddyPresence",{get:function(){return this._cbOnBuddyPresence},set:function(e){this.validateCB(e,"onBuddyPresence"),this._cbOnBuddyPresence=e},enumerable:!1,configurable:!0}),e.prototype.login=function(e,t,n,r,i){void 0===t&&(t=s.DEFER),void 0===n&&(n=void 0),void 0===r&&(r=void 0),void 0===i&&(i=void 0);var a="LoginSession.login()";if(l.Logger.trace(),this.state!=o.LOGGED_OUT)throw new g.VxError(g.VxError.CODE.ESTATE,y.Tools.findKeyByValue(o,this.state),a,this._logSubsystemId);if(arguments.length<1||arguments.length>5)throw new g.VxError(g.VxError.CODE.ENUMPARAMS,a,this._logSubsystemId);if("string"!=typeof e)throw new g.VxError(g.VxError.CODE.EPARAMTYPE,"accessToken","string",a,this._logSubsystemId);if(typeof t!=typeof s.DEFER)throw new g.VxError(g.VxError.CODE.EPARAMTYPE,"subscriptionMode",typeof s.DEFER,a,this._logSubsystemId);if(t!==s.ACCEPT&&t!==s.BLOCK&&t!==s.DEFER)throw new g.VxError(g.VxError.CODE.EPARAMVALUE,"subscriptionMode",a,this._logSubsystemId);if(null===n)throw new g.VxError(g.VxError.CODE.EPARAMTYPE,"presenceSubscriptions","Array or Set or Map of AccountId, or plain AccountId, or undefined",a,this._logSubsystemId);if(null===r)throw new g.VxError(g.VxError.CODE.EPARAMTYPE,"blockedSubscriptions","Array or Set or Map of AccountId, or plain AccountId, or undefined",a,this._logSubsystemId);if(null===i)throw new g.VxError(g.VxError.CODE.EPARAMTYPE,"allowedSubscriptions","Array or Set or Map of AccountId, or plain AccountId, or undefined",a,this._logSubsystemId);return this._subscrMode=t,this._loginAccessToken=e,void 0!==i&&this.addAllowedSubscription(i),void 0!==r&&this.addBlockedSubscription(r),void 0!==n&&this.addPresenceSubscription(n),this._loginStartTime=Date.now(),this._uriWsXmpp?this.performStropheConnection():this.performPrelogin()},e.prototype.getChannelSession=function(e){var t="LoginSession.getChannelSession()";if(l.Logger.trace(),this.state!=o.LOGGED_IN)throw new g.VxError(g.VxError.CODE.ESTATE,y.Tools.findKeyByValue(o,this.state),t,this._logSubsystemId);if(1!=arguments.length)throw new g.VxError(g.VxError.CODE.ENUMPARAMS,t,this._logSubsystemId);if(!(e instanceof h.ChannelId))throw new g.VxError(g.VxError.CODE.EPARAMTYPE,"channel","ChannelId",t,this._logSubsystemId);if(e.isEmpty())throw new g.VxError(g.VxError.CODE.EPARAMVALUE,"channel",t,this._logSubsystemId);if(e.domain!=this.loginSessionId.domain||e.issuer!=this.loginSessionId.issuer)throw new g.VxError(g.VxError.CODE.EPARAMVALUE,"channel",t,this._logSubsystemId,"domain and issuer in channel must match with domain and issuer of the LoginSession");var n=e.toString();if(n in this.channelSessions)return this.channelSessions[n];if(y.Tools.propCount(this.channelSessions)>0)throw new g.VxError(g.VxError.CODE.ECONSTRAINS,t,this._logSubsystemId,"multiple simultaneous ChannelSessions are not supported");var r=new p.ChannelSession(e,this);return this.channelSessions[n]=r,this._cbOnChannelSessionAdded&&"function"==typeof this._cbOnChannelSessionAdded&&this._cbOnChannelSessionAdded(this,r),r},e.prototype.deleteChannelSession=function(e){var t="LoginSession.deleteChannelSession()";if(l.Logger.trace(),1!=arguments.length)throw new g.VxError(g.VxError.CODE.ENUMPARAMS,t,this._logSubsystemId);if(!(e instanceof p.ChannelSession||e instanceof h.ChannelId))throw new g.VxError(g.VxError.CODE.EPARAMTYPE,"channelSessionOrId","ChannelSession or ChannelId",t,this._logSubsystemId);var n=null;if(!((n=e instanceof h.ChannelId?e:"channel"in(e=e)?e.channel.toString():"")in this.channelSessions))return!1;var r=this.channelSessions[n];return r.isEstablished?r.disconnect():(r.close(),delete this.channelSessions[n]),!0},e.prototype.logout=function(){var e="LoginSession.logout()";if(l.Logger.trace(),this.state==o.LOGGING_OUT||this.state==o.FINISHED)return!0;if(this.state!=o.PRELOGIN&&this.state!=o.LOGGING_IN&&this.state!=o.LOGGED_IN)throw new g.VxError(g.VxError.CODE.ESTATE,y.Tools.findKeyByValue(o,this.state),e,this._logSubsystemId);if(0!=arguments.length)throw new g.VxError(g.VxError.CODE.ENUMPARAMS,e,this._logSubsystemId);this.state=o.LOGGING_OUT,this.releaseXhrPrelogin();var t=!1;for(var n in this.channelSessions)this.channelSessions[n].isEstablished?(t=!0,this.channelSessions[n].disconnect()):(this.channelSessions[n].close(),delete this.channelSessions[n]);return t||(this.removeLoginSessionHandlers(),this.stropheConnection.disconnect()),!0},e.prototype.addAllowedSubscription=function(e){var t=this;l.Logger.trace();return l.Logger.trace(),y.Tools.callFunctionForSetOrObject(e,d.AccountId,(function(e){var n=e.toString();return t.allowedSubscriptions.has(n)||(t.allowedSubscriptions.add(n),t.log("Added to allowed subscriptions list: "+n),t.incomingSubscriptionRequests.has(n)&&t.state==o.LOGGED_IN&&t.acceptIncomingSubscription(n)),!0}),"accountId","Array or Set or Map of AccountId, or plain AccountId","LoginSession.addAllowedSubscription()",this._logSubsystemId)},e.prototype.removeAllowedSubscription=function(e){var t=this;l.Logger.trace();return y.Tools.callFunctionForSetOrObject(e,d.AccountId,(function(e){var n=e.toString();return!t.allowedSubscriptions.has(n)||(t.allowedSubscriptions.delete(n),t.log("Removed from allowed subscriptions list: "+n),t.incomingSubscriptionRequests.has(n)&&t.state==o.LOGGED_IN&&t.denyIncomingSubscription(n),!0)}),"accountId","Array or Set or Map of AccountId, or plain AccountId","LoginSession.removeAllowedSubscription",this._logSubsystemId)},e.prototype.addBlockedSubscription=function(e){var t=this;l.Logger.trace();return y.Tools.callFunctionForSetOrObject(e,d.AccountId,(function(e){var n=e.toString();return t.blockedSubscriptions.has(n)||(t.blockedSubscriptions.add(n),t.log("Added to blocked subscriptions list: "+n),t.incomingSubscriptionRequests.has(n)&&t.state==o.LOGGED_IN&&t.denyIncomingSubscription(n)),!0}),"accountId","Array or Set or Map of AccountId, or plain AccountId","LoginSession.addBlockedSubscription",this._logSubsystemId)},e.prototype.removeBlockedSubscription=function(e){var t=this;l.Logger.trace();return y.Tools.callFunctionForSetOrObject(e,d.AccountId,(function(e){var n=e.toString();return!t.blockedSubscriptions.has(n)||(t.blockedSubscriptions.delete(n),t.log("Removed from blocked subscriptions list: "+n),!0)}),"accountId","Array or Set or Map of AccountId, or plain AccountId","LoginSession.removeBlockedSubscription",this._logSubsystemId)},e.prototype.addPresenceSubscription=function(e){var t=this;l.Logger.trace();return y.Tools.callFunctionForSetOrObject(e,d.AccountId,(function(e){var n=e.toString();if(t.state!=o.LOGGED_IN)return t.presenceSubscriptionsScheduled.add(n),!0;var r=void 0;return t.presenceSubscriptions.has(n)?r=t.presenceSubscriptions.get(n):(r=new b.PresenceSubscription(t,e,b.PresenceSubscription.SUBSTATE.NONE),t.presenceSubscriptions.set(n,r),r.onSubscribed=t.onPresSubSubscribed,r.onUnsubscribed=t.onPresSubUnsubscribed,r.onBuddyPresence=t.onPresSubBuddyPresence,r.subscribe(),t._cbOnBuddyAdded&&"function"==typeof t._cbOnBuddyAdded&&t._cbOnBuddyAdded(t,e)),!0}),"accountId","Array or Set or Map of AccountId, or plain AccountId","LoginSession.addPresenceSubscription",this._logSubsystemId)},e.prototype.removePresenceSubscription=function(e){var t=this;l.Logger.trace();return y.Tools.callFunctionForSetOrObject(e,d.AccountId,(function(e){var n=e.toString();if(t.state!=o.LOGGED_IN)return!!t.presenceSubscriptionsScheduled.has(n)&&(t.presenceSubscriptionsScheduled.delete(n),!0);if(!t.presenceSubscriptions.has(n))return!1;var r=t.presenceSubscriptions.get(n);return t.presenceSubscriptions.delete(n),r.unsubscribe(),r.onSubscribed=void 0,r.onUnsubscribed=void 0,r.onBuddyPresence=void 0,r=void 0,!0}),"accountId","Array or Set or Map of AccountId, or plain AccountId","LoginSession.removePresenceSubscription",this._logSubsystemId)},e.prototype.sendDirectedMessage=function(e,t,n,r,i,s){void 0===n&&(n=void 0),void 0===r&&(r=void 0),void 0===i&&(i=void 0),void 0===s&&(s=void 0);var c="LoginSession.sendDirectedMessage()";if(l.Logger.trace(),this.state!=o.LOGGED_IN)throw new g.VxError(g.VxError.CODE.ESTATE,y.Tools.findKeyByValue(o,this.state),c,this._logSubsystemId);if(arguments.length<2||arguments.length>6)throw new g.VxError(g.VxError.CODE.ENUMPARAMS,c,this._logSubsystemId);if(!(e instanceof d.AccountId))throw new g.VxError(g.VxError.CODE.EPARAMTYPE,"to","AccountId",c,this._logSubsystemId);if(e.isEmpty())throw new g.VxError(g.VxError.CODE.EPARAMVALUE,"to",c,this._logSubsystemId);if("string"!=typeof t)throw new g.VxError(g.VxError.CODE.EPARAMTYPE,"text","string",c,this._logSubsystemId);if("string"!=typeof n&&void 0!==n)throw new g.VxError(g.VxError.CODE.EPARAMTYPE,"text","subject or undefined",c,this._logSubsystemId);if("string"!=typeof r&&void 0!==r)throw new g.VxError(g.VxError.CODE.EPARAMTYPE,"text","language or undefined",c,this._logSubsystemId);if("string"!=typeof i&&void 0!==i)throw new g.VxError(g.VxError.CODE.EPARAMTYPE,"applicationStanzaNamespace","string or undefined",c,this._logSubsystemId);if("string"!=typeof s&&void 0!==s)throw new g.VxError(g.VxError.CODE.EPARAMTYPE,"applicationStanzaBody","string or undefined",c,this._logSubsystemId);t||(t="");var u={to:e.toString(),from:this._accountJid,type:"normal",id:y.Tools.makeUuid()},h=(0,a.$msg)(u).c("body").t(t).up();n&&h.c("subject").t(n).up(),i&&s&&h.c("application",{xmlns:i}).t(s).up();var p=h.tree();return this.stropheConnection.send(p),!0},e.prototype.getLoginToken=function(e,t){var n="LoginSession.getLoginToken()";if(l.Logger.trace(),2!=arguments.length)throw new g.VxError(g.VxError.CODE.ENUMPARAMS,n,this._logSubsystemId);if("string"!=typeof e)throw new g.VxError(g.VxError.CODE.EPARAMTYPE,"tokenSigningKey","string",n,this._logSubsystemId);if("number"!=typeof t)throw new g.VxError(g.VxError.CODE.EPARAMTYPE,"tokenExpirationDuration","number",n,this._logSubsystemId);var r=S.Token.debugGenerateAccessToken(this.loginSessionId.issuer,t,"login","",this._accountJid,"",e);return r},e.prototype.close=function(){l.Logger.trace(),this._self&&(this.releaseLoginSessionResources(),this._self=void 0)},e.prototype.toString=function(){return"[object LoginSession("+this._accountJid+")]"},e.prototype.log=function(e){l.Logger.log(this._logSubsystemId,e)},e.prototype.performStropheConnection=function(){return l.Logger.trace(),!!this._uriWsXmpp&&(this.log("Connecting and logging in as "+this._accountJid+" to XMPP server at "+this._uriWsXmpp),this.stropheConnection=new a.Strophe.Connection(this._uriWsXmpp),this.stropheConnection.rawInput=this.onStropheRawInput,this.stropheConnection.rawOutput=this.onStropheRawOutput,this.stropheConnection.xmlOutput=this.onStropheXmlOutput,this.stropheConnection.connect(this._accountJid,this._loginAccessToken,this.onStropheConnectionEvent),!0)},e.prototype.performPrelogin=function(){l.Logger.trace(),this.log("Performing prelogin procedure");var e=(this._forceSecurePreloginURI?"https://":"http://")+this.loginSessionId.domain.replace(/vivox.com/,"www.vivox.com")+"/api2/viv_get_prelogin.php";return this.log("uriPrelogin: "+e),this._xhrPrelogin=new XMLHttpRequest,this._xhrPrelogin.onload=this.onPreloginResponse,this._xhrPrelogin.onerror=this.onPreloginVxError,this._xhrPrelogin.ontimeout=this.onPreloginTimeout,this._xhrPrelogin.open("POST",e,!0),this._xhrPrelogin.send(),!0},e.prototype.addLoginSessionHandlers=function(){l.Logger.trace(),this.stropheConnection&&(this._handOnDirectedMessage=this.stropheConnection.addHandler(this.onDirectedMessage,a.Strophe.NS.CLIENT,"message","normal",null,null,null),this._handOnDirectedMessageVxError=this.stropheConnection.addHandler(this.onDirectedMessageVxError,a.Strophe.NS.CLIENT,"message","error",null,null,null),this._handOnIncomingSubscription=this.stropheConnection.addHandler(this.onIncomingSubscription,null,"presence","subscribe",null,null,null),this._handOnRosterPush=this.stropheConnection.addHandler(this.onRosterPush,a.Strophe.NS.ROSTER,"iq","set",null,null,null),this._handOnPingFromServer=this.stropheConnection.addHandler(this.onPingFromServer,a.Strophe.NS.PING,"iq","get"))},e.prototype.removeLoginSessionHandlers=function(){l.Logger.trace(),this.stropheConnection&&(this._handOnDirectedMessage&&(this.stropheConnection.deleteHandler(this._handOnDirectedMessage),this._handOnDirectedMessage=void 0),this._handOnDirectedMessageVxError&&(this.stropheConnection.deleteHandler(this._handOnDirectedMessageVxError),this._handOnDirectedMessageVxError=void 0),this._handOnIncomingSubscription&&(this.stropheConnection.deleteHandler(this._handOnIncomingSubscription),this._handOnIncomingSubscription=void 0),this._handOnRosterPush&&(this.stropheConnection.deleteHandler(this._handOnRosterPush),this._handOnRosterPush=void 0),this._handOnPingFromServer&&(this.stropheConnection.deleteHandler(this._handOnPingFromServer),this._handOnPingFromServer=void 0))},e.prototype.requestInitialRoster=function(){l.Logger.trace(),this.log("Retrieving the Roster");var e=(0,a.$iq)({id:y.Tools.makeUuid(),type:"get"}).c("query",{xmlns:a.Strophe.NS.ROSTER}).tree();this.stropheConnection.sendIQ(e,this.onRequestInitialRosterResponse,this.onRequestInitialRosterVxError,E.Xmpp.DEFAULT_TRANSACTION_TIMEOUT)},e.prototype.sendOwnPresence=function(){if(l.Logger.trace(),this.state==o.LOGGED_IN){this.log("Sending own presence update: "+this.presence);var e=void 0;switch(this.presence.status){case m.Presence.STATUS.CHAT:e="chat";break;case m.Presence.STATUS.DONOTDISTURB:e="dnd";break;case m.Presence.STATUS.AWAY:e="away";break;case m.Presence.STATUS.EXTENDEDAWAY:e="xa";break;default:e=void 0}var t={priority:"1"};this.presence.status==m.Presence.STATUS.UNAVAILABLE&&(t.type="unavailable");var n=(0,a.$pres)(t);e&&n.c("show").t(e).up(),this.presence.message&&this.presence.status!=m.Presence.STATUS.UNAVAILABLE&&n.c("status").t(this.presence.message),this.stropheConnection.send(n.tree())}},e.prototype.acceptIncomingSubscription=function(e){l.Logger.trace(),this.incomingSubscriptionRequests.has(e)&&this.incomingSubscriptionRequests.delete(e);var t=(0,a.$pres)({to:e,type:"subscribed",id:y.Tools.makeUuid()});this.stropheConnection.send(t.tree()),this.log(e+" subscribed to our presence")},e.prototype.denyIncomingSubscription=function(e){l.Logger.trace(),this.incomingSubscriptionRequests.has(e)&&this.incomingSubscriptionRequests.delete(e);var t=(0,a.$pres)({to:e,type:"unsubscribed",id:y.Tools.makeUuid()});this.stropheConnection.send(t.tree()),this.log(e+" NOT subscribed to our presence")},e.prototype.updatePresenceSubscriptionByRosterItem=function(e,t){if(void 0===t&&(t=!1),l.Logger.trace(),!e.hasAttribute("jid")||!e.hasAttribute("subscription"))return!1;var n=e.getAttribute("jid"),r=e.getAttribute("subscription"),i="to"==r||"both"==r,o=!i&&e.hasAttribute("ask")&&"subscribe"==e.getAttribute("ask");if(!("remove"==r)){if(i||o){if(i||o){if(this.presenceSubscriptions.has(n));else{var s=o?b.PresenceSubscription.SUBSTATE.SUBSCRIBING:b.PresenceSubscription.SUBSTATE.SUBSCRIBED;this.log("Creating presenceSubscription to "+n+" by roster item (isPendingOut = "+o+", initialState = "+s+")");var a=new d.AccountId(n);c=new b.PresenceSubscription(this,a,s);this.presenceSubscriptions.set(n,c),c.onSubscribed=this.onPresSubSubscribed,c.onUnsubscribed=this.onPresSubUnsubscribed,c.onBuddyPresence=this.onPresSubBuddyPresence,c.subscribe(t),this._cbOnBuddyAdded&&"function"==typeof this._cbOnBuddyAdded&&this._cbOnBuddyAdded(this,a)}return!0}return!1}return!1}if(this.presenceSubscriptions.has(n)){this.log("Removing presenceSubscription to "+n+" by roster push");var c=this.presenceSubscriptions.get(n);return this.presenceSubscriptions.delete(n),c.remove(),c.close(),c=void 0,!0}},e.prototype.addUserAgent=function(e){var t=u.default.parse(navigator.userAgent),n=(c.default.stringify(t),"Vivox-SDK-".concat(f.Client.internalVersion,"B"));e.setAttribute("ua",n)},e.prototype.releaseLoginSessionResources=function(){l.Logger.trace(),this.releasePresence(),this.releasePresenceSubscriptions(),this.releaseChannelSessions(),this.releaseStropheConnection(),this.releaseXhrPrelogin(),this.releaseCallbacks()},e.prototype.releaseStropheConnection=function(){l.Logger.trace(),this.stropheConnection&&(this.removeLoginSessionHandlers(),this.state!=o.LOGGING_IN&&this.state!=o.LOGGED_IN||this.stropheConnection.disconnect(),this.state=o.FINISHED,this.stropheConnection.reset(),this.stropheConnection=null)},e.prototype.releaseXhrPrelogin=function(){l.Logger.trace(),this._xhrPrelogin&&(this._xhrPrelogin.onload=void 0,this._xhrPrelogin.onerror=void 0,this._xhrPrelogin.ontimeout=void 0,this._xhrPrelogin.abort(),this._xhrPrelogin=null)},e.prototype.releasePresence=function(){l.Logger.trace(),this.presence=null},e.prototype.releasePresenceSubscriptions=function(){var e,t;l.Logger.trace();try{for(var n=r(this.presenceSubscriptions.keys()),i=n.next();!i.done;i=n.next()){var o=i.value;this.presenceSubscriptions.get(o).close(),this.presenceSubscriptions.delete(o)}}catch(t){e={error:t}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}},e.prototype.releaseChannelSessions=function(){for(var e in l.Logger.trace(),this.channelSessions)this.channelSessions[e].close(),delete this.channelSessions[e]},e.prototype.releaseCallbacks=function(){l.Logger.trace(),this._cbOnConnected=void 0,this._cbOnDisconnected=void 0,this._cbOnChannelSessionAdded=void 0,this._cbOnChannelSessionRemoved=void 0,this._cbOnDirectedTextMessage=void 0,this._cbOnIncomingSubscriptionRequest=void 0,this._cbOnBuddyPresence=void 0,this._cbOnBuddyAdded=void 0,this._cbOnBuddyRemoved=void 0},e.LOGINSTATE=o,e.SUBSCRIPTIONMODE=s,e}();Object.defineProperties(C,{login:{writable:!1,configurable:!1,enumerable:!0},getChannelSession:{writable:!1,configurable:!1,enumerable:!0},deleteChannelSession:{writable:!1,configurable:!1,enumerable:!0},logout:{writable:!1,configurable:!1,enumerable:!0},addAllowedSubscription:{writable:!1,configurable:!1,enumerable:!0},removeAllowedSubscription:{writable:!1,configurable:!1,enumerable:!0},addBlockedSubscription:{writable:!1,configurable:!1,enumerable:!0},removeBlockedSubscription:{writable:!1,configurable:!1,enumerable:!0},addPresenceSubscription:{writable:!1,configurable:!1,enumerable:!0},removePresenceSubscription:{writable:!1,configurable:!1,enumerable:!0},sendDirectedMessage:{writable:!1,configurable:!1,enumerable:!0},getLoginToken:{writable:!1,configurable:!1,enumerable:!0},close:{writable:!1,configurable:!1,enumerable:!1},toString:{writable:!1,configurable:!1,enumerable:!0}}),Object.defineProperty(C,"LOGINSTATE",{writable:!1,configurable:!1,enumerable:!0}),Object.defineProperty(C,"SUBSCRIPTIONMODE",{writable:!1,configurable:!1,enumerable:!0})},function(e,t,n){"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),t.Presence=t.PresenceStatus=void 0,function(e){e[e.Unavailable=0]="Unavailable",e[e.Available=1]="Available",e[e.Chat=2]="Chat",e[e["Do not disturb"]=3]="Do not disturb",e[e.Away=4]="Away",e[e["Extended away"]=5]="Extended away"}(r||(r={}));var i=t.PresenceStatus=function(){function e(e,t){this.key=e,this.value=t}return e.get=function(e){},e.prototype.toString=function(){return this.key},e._MIN=new e("_MIN",1),e.UNAVAILABLE=new e("UNAVAILABLE",1),e.AVAILABLE=new e("AVAILABLE",2),e.CHAT=new e("CHAT",3),e.DONOTDISTURB=new e("DONOTDISTURB",4),e.AWAY=new e("AWAY",5),e.EXTENDEDAWAY=new e("EXTENDEDAWAY",6),e._MAX=new e("_MAX",6),e.DISPLAYNAME=r,e.RANK={1:10,2:50,3:60,4:40,5:30,6:20},e}(),o=t.Presence=function(){function e(e,t){void 0===e&&(e=i.UNAVAILABLE),t&&""!=t||(t=void 0),this.status=e,this.message=t,Object.defineProperties(this,{status:{writable:!1,configurable:!1,enumerable:!0},message:{writable:!1,configurable:!1,enumerable:!0}})}return e.prototype.toString=function(){return this.message?r[this.status.value]+" ("+this.message+")":r[this.status.value]},e.STATUS=i,e}();Object.defineProperties(o.STATUS,{_MIN:{writable:!1,configurable:!1,enumerable:!1},UNAVAILABLE:{writable:!1,configurable:!1,enumerable:!0},AVAILABLE:{writable:!1,configurable:!1,enumerable:!0},CHAT:{writable:!1,configurable:!1,enumerable:!0},DONOTDISTURB:{writable:!1,configurable:!1,enumerable:!0},AWAY:{writable:!1,configurable:!1,enumerable:!0},EXTENDEDAWAY:{writable:!1,configurable:!1,enumerable:!0},_MAX:{writable:!1,configurable:!1,enumerable:!1},DISPLAYNAME:{writable:!1,configurable:!1,enumerable:!1},RANK:{writable:!1,configurable:!1,enumerable:!1}}),Object.defineProperty(o,"STATUS",{writable:!1,configurable:!1,enumerable:!0})},function(e,t){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){(function(e){(function(t){"use strict";var r=void 0!==e?e:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{};const i=function(){let e=r.WebSocket;if(void 0===e)try{e=n(44)}catch(e){throw new Error('You must install the "ws" package to use Strophe in nodejs.')}return e}(),o=function(){let e=r.DOMParser;if(void 0===e)try{e=n(21).DOMParser}catch(e){throw new Error('You must install the "@xmldom/xmldom" package to use Strophe in nodejs.')}return e}();function s(){if("undefined"==typeof document)try{return(new(0,n(21).DOMImplementation)).createDocument("jabber:client","strophe",null)}catch(e){throw new Error('You must install the "@xmldom/xmldom" package to use Strophe in nodejs.')}if(void 0===document.implementation.createDocument||document.implementation.createDocument&&document.documentMode&&document.documentMode<10){const e=function(){const e=["Msxml2.DOMDocument.6.0","Msxml2.DOMDocument.5.0","Msxml2.DOMDocument.4.0","MSXML2.DOMDocument.3.0","MSXML2.DOMDocument","MSXML.DOMDocument","Microsoft.XMLDOM"];for(let t=0;t<e.length;t++)try{return new ActiveXObject(e[t])}catch(e){}}();return e.appendChild(e.createElement("strophe")),e}return document.implementation.createDocument("jabber:client","strophe",null)}var a=Object.freeze({__proto__:null,WebSocket:i,DOMParser:o,getDummyXMLDOMDocument:s});const c={HTTPBIND:"http://jabber.org/protocol/httpbind",BOSH:"urn:xmpp:xbosh",CLIENT:"jabber:client",AUTH:"jabber:iq:auth",ROSTER:"jabber:iq:roster",PROFILE:"jabber:iq:profile",DISCO_INFO:"http://jabber.org/protocol/disco#info",DISCO_ITEMS:"http://jabber.org/protocol/disco#items",MUC:"http://jabber.org/protocol/muc",SASL:"urn:ietf:params:xml:ns:xmpp-sasl",STREAM:"http://etherx.jabber.org/streams",FRAMING:"urn:ietf:params:xml:ns:xmpp-framing",BIND:"urn:ietf:params:xml:ns:xmpp-bind",SESSION:"urn:ietf:params:xml:ns:xmpp-session",VERSION:"jabber:iq:version",STANZAS:"urn:ietf:params:xml:ns:xmpp-stanzas",XHTML_IM:"http://jabber.org/protocol/xhtml-im",XHTML:"http://www.w3.org/1999/xhtml"},u={tags:["a","blockquote","br","cite","em","img","li","ol","p","span","strong","ul","body"],attributes:{a:["href"],blockquote:["style"],br:[],cite:["style"],em:[],img:["src","alt","style","height","width"],li:["style"],ol:["style"],p:["style"],span:["style"],strong:[],ul:["style"],body:[]},css:["background-color","color","font-family","font-size","font-style","font-weight","margin-left","margin-right","text-align","text-decoration"]},l={ERROR:0,CONNECTING:1,CONNFAIL:2,AUTHENTICATING:3,AUTHFAIL:4,CONNECTED:5,DISCONNECTED:6,DISCONNECTING:7,ATTACHED:8,REDIRECT:9,CONNTIMEOUT:10,BINDREQUIRED:11,ATTACHFAIL:12},d={NORMAL:1,TEXT:3,CDATA:4,FRAGMENT:11};function h(e){let t="";const n=e.length;for(let r=0;r<n;r++){const n=e.charCodeAt(r);n>=0&&n<=127?t+=e.charAt(r):n>2047?(t+=String.fromCharCode(224|n>>12&15),t+=String.fromCharCode(128|n>>6&63),t+=String.fromCharCode(128|n>>0&63)):(t+=String.fromCharCode(192|n>>6&31),t+=String.fromCharCode(128|n>>0&63))}return t}function p(e,t){const n=new Uint8Array(e),r=new Uint8Array(t),i=new Uint8Array(e.byteLength);for(let t=0;t<e.byteLength;t++)i[t]=n[t]^r[t];return i.buffer}function f(e){let t="";const n=new Uint8Array(e),r=n.byteLength;for(let e=0;e<r;e++)t+=String.fromCharCode(n[e]);return btoa(t)}function g(e){var t;return null===(t=Uint8Array.from(atob(e),e=>e.charCodeAt(0)))||void 0===t?void 0:t.buffer}function m(e){return new TextEncoder("utf-8").encode(e).buffer}function b(e){"undefined"==typeof document&&z.log(z.LogLevel.ERROR,"addCookies: not adding any cookies, since there's no document object"),e=e||{};for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t)){let n="",r="",i="";const o=e[t],s="object"==typeof o,a=escape(unescape(s?o.value:o));s&&(n=o.expires?";expires="+o.expires:"",r=o.domain?";domain="+o.domain:"",i=o.path?";path="+o.path:""),document.cookie=t+"="+a+n+r+i}}let _=null;function S(){return _||(_=s()),_}function y(e){return S().createTextNode(e)}function v(e){if(!e)return null;const t=S().createElement(e);for(let e=1;e<arguments.length;e++){const n=arguments[e];if(n)if("string"==typeof n||"number"==typeof n)t.appendChild(y(n));else if("object"==typeof n&&"function"==typeof n.sort)for(let e=0;e<n.length;e++){const r=n[e];"object"==typeof r&&"function"==typeof r.sort&&void 0!==r[1]&&null!==r[1]&&t.setAttribute(r[0],r[1])}else if("object"==typeof n)for(const e in n)Object.prototype.hasOwnProperty.call(n,e)&&void 0!==n[e]&&null!==n[e]&&t.setAttribute(e,n[e])}return t}function E(e){for(let t=0;t<u.tags.length;t++)if(e===u.tags[t])return!0;return!1}function C(e,t){if(void 0!==u.attributes[e]&&u.attributes[e].length>0)for(let n=0;n<u.attributes[e].length;n++)if(t===u.attributes[e][n])return!0;return!1}function T(e){for(let t=0;t<u.css.length;t++)if(e===u.css[t])return!0;return!1}function w(e){let t;if(e.nodeType===d.NORMAL){const n=e.nodeName.toLowerCase();if(E(n))try{t=v(n);for(let r=0;r<u.attributes[n].length;r++){const i=u.attributes[n][r];let o=e.getAttribute(i);if(null!=o&&""!==o&&!1!==o&&0!==o)if("style"===i&&"object"==typeof o&&void 0!==o.cssText&&(o=o.cssText),"style"===i){const e=[],n=o.split(";");for(let t=0;t<n.length;t++){const r=n[t].split(":"),i=r[0].replace(/^\s*/,"").replace(/\s*$/,"").toLowerCase();if(T(i)){const t=r[1].replace(/^\s*/,"").replace(/\s*$/,"");e.push(i+": "+t)}}e.length>0&&(o=e.join("; "),t.setAttribute(i,o))}else t.setAttribute(i,o)}for(let n=0;n<e.childNodes.length;n++)t.appendChild(w(e.childNodes[n]))}catch(e){t=y("")}else{t=S().createDocumentFragment();for(let n=0;n<e.childNodes.length;n++)t.appendChild(w(e.childNodes[n]))}}else if(e.nodeType===d.FRAGMENT){t=S().createDocumentFragment();for(let n=0;n<e.childNodes.length;n++)t.appendChild(w(e.childNodes[n]))}else e.nodeType===d.TEXT&&(t=y(e.nodeValue));return t}function A(e){let t;if(e.nodeType===d.NORMAL){t=v(e.tagName);for(let n=0;n<e.attributes.length;n++)t.setAttribute(e.attributes[n].nodeName,e.attributes[n].value);for(let n=0;n<e.childNodes.length;n++)t.appendChild(A(e.childNodes[n]))}else e.nodeType===d.TEXT&&(t=S().createTextNode(e.nodeValue));return t}function P(e){return e=(e=(e=(e=(e=e.replace(/\&/g,"&amp;")).replace(/</g,"&lt;")).replace(/>/g,"&gt;")).replace(/'/g,"&apos;")).replace(/"/g,"&quot;")}function O(e){if(!e)return null;"function"==typeof e.tree&&(e=e.tree());const t=[...Array(e.attributes.length).keys()].map(t=>e.attributes[t].nodeName);t.sort();let n=t.reduce((t,n)=>`${t} ${n}="${P(e.attributes.getNamedItem(n).value)}"`,"<"+e.nodeName);if(e.childNodes.length>0){n+=">";for(let t=0;t<e.childNodes.length;t++){const r=e.childNodes[t];switch(r.nodeType){case d.NORMAL:n+=O(r);break;case d.TEXT:n+=P(r.nodeValue);break;case d.CDATA:n+="<![CDATA["+r.nodeValue+"]]>"}}n+="</"+e.nodeName+">"}else n+="/>";return n}function x(e,t,n){for(let r=0;r<e.childNodes.length;r++){const i=e.childNodes[r];i.nodeType!==d.NORMAL||t&&!this.isTagEqual(i,t)||n(i)}}function R(e){var t;if(!e)return null;let n="";null!==(t=e.childNodes)&&void 0!==t&&t.length||e.nodeType!==d.TEXT||(n+=e.nodeValue);for(let t=0;null!==(r=t<(null===(i=e.childNodes)||void 0===i?void 0:i.length))&&void 0!==r&&r;t++){var r,i;e.childNodes[t].nodeType===d.TEXT&&(n+=e.childNodes[t].nodeValue)}return P(n)}function I(e){return e?e.split("/")[0]:null}const N={utf16to8:h,xorArrayBuffers:p,arrayBufToBase64:f,base64ToArrayBuf:g,stringToArrayBuf:m,addCookies:b};var M=Object.freeze({__proto__:null,utf16to8:h,xorArrayBuffers:p,arrayBufToBase64:f,base64ToArrayBuf:g,stringToArrayBuf:m,addCookies:b,xmlGenerator:S,xmlTextNode:y,xmlHtmlNode:function(e){let t;return o?t=(new o).parseFromString(e,"text/xml"):(t=new ActiveXObject("Microsoft.XMLDOM"),t.async="false",t.loadXML(e)),t},xmlElement:v,validTag:E,validAttribute:C,validCSS:T,createHtml:w,copyElement:A,xmlescape:P,xmlunescape:function(e){return e=(e=(e=(e=(e=e.replace(/\&amp;/g,"&")).replace(/&lt;/g,"<")).replace(/&gt;/g,">")).replace(/&apos;/g,"'")).replace(/&quot;/g,'"')},serialize:O,forEachChild:x,isTagEqual:function(e,t){return e.tagName===t},getText:R,escapeNode:function(e){return"string"!=typeof e?e:e.replace(/^\s+|\s+$/g,"").replace(/\\/g,"\\5c").replace(/ /g,"\\20").replace(/\"/g,"\\22").replace(/\&/g,"\\26").replace(/\'/g,"\\27").replace(/\//g,"\\2f").replace(/:/g,"\\3a").replace(/</g,"\\3c").replace(/>/g,"\\3e").replace(/@/g,"\\40")},unescapeNode:function(e){return"string"!=typeof e?e:e.replace(/\\20/g," ").replace(/\\22/g,'"').replace(/\\26/g,"&").replace(/\\27/g,"'").replace(/\\2f/g,"/").replace(/\\3a/g,":").replace(/\\3c/g,"<").replace(/\\3e/g,">").replace(/\\40/g,"@").replace(/\\5c/g,"\\")},getNodeFromJid:function(e){return e.indexOf("@")<0?null:e.split("@")[0]},getDomainFromJid:function(e){const t=I(e);if(t.indexOf("@")<0)return t;{const e=t.split("@");return e.splice(0,1),e.join("@")}},getResourceFromJid:function(e){if(!e)return null;const t=e.split("/");return t.length<2?null:(t.splice(0,1),t.join("/"))},getBareJidFromJid:I,default:N});function D(e,t){return new V(e,t)}function L(e){return new V("message",e)}function k(e){return new V("iq",e)}function U(e){return new V("presence",e)}class V{constructor(e,t){"presence"!==e&&"message"!==e&&"iq"!==e||(t&&!t.xmlns?t.xmlns=c.CLIENT:t||(t={xmlns:c.CLIENT})),this.nodeTree=v(e,t),this.node=this.nodeTree}tree(){return this.nodeTree}toString(){return O(this.nodeTree)}up(){return this.node=this.node.parentNode,this}root(){return this.node=this.nodeTree,this}attrs(e){for(const t in e)Object.prototype.hasOwnProperty.call(e,t)&&(void 0===e[t]?this.node.removeAttribute(t):this.node.setAttribute(t,e[t]));return this}c(e,t,n){const r=v(e,t,n);return this.node.appendChild(r),"string"!=typeof n&&"number"!=typeof n&&(this.node=r),this}cnode(e){let t;const n=S();try{t=void 0!==n.importNode}catch(e){t=!1}const r=t?n.importNode(e,!0):A(e);return this.node.appendChild(r),this.node=r,this}t(e){const t=y(e);return this.node.appendChild(t),this}h(e){const t=S().createElement("body");t.innerHTML=e;const n=w(t);for(;n.childNodes.length>0;)this.node.appendChild(n.childNodes[0]);return this}}class B{constructor(e,t,n,r,i,o,s){this.handler=e,this.ns=t,this.name=n,this.type=r,this.id=i,this.options=s||{matchBareFromJid:!1,ignoreNamespaceFragment:!1},this.options.matchBare&&(z.warn('The "matchBare" option is deprecated, use "matchBareFromJid" instead.'),this.options.matchBareFromJid=this.options.matchBare,delete this.options.matchBare),this.options.matchBareFromJid?this.from=o?I(o):null:this.from=o,this.user=!0}getNamespace(e){let t=e.getAttribute("xmlns");return t&&this.options.ignoreNamespaceFragment&&(t=t.split("#")[0]),t}namespaceMatch(e){let t=!1;return!this.ns||(x(e,null,e=>{this.getNamespace(e)===this.ns&&(t=!0)}),t||this.getNamespace(e)===this.ns)}isMatch(e){let t=e.getAttribute("from");this.options.matchBareFromJid&&(t=I(t));const n=e.getAttribute("type");return!(!this.namespaceMatch(e)||this.name&&!z.isTagEqual(e,this.name)||this.type&&(Array.isArray(this.type)?-1===this.type.indexOf(n):n!==this.type)||this.id&&e.getAttribute("id")!==this.id||this.from&&t!==this.from)}run(e){let t=null;try{t=this.handler(e)}catch(e){throw z._handleError(e),e}return t}toString(){return"{Handler: "+this.handler+"("+this.name+","+this.id+","+this.ns+")}"}}class j{constructor(e,t){this.period=e,this.handler=t,this.lastCalled=(new Date).getTime(),this.user=!0}run(){return this.lastCalled=(new Date).getTime(),this.handler()}reset(){this.lastCalled=(new Date).getTime()}toString(){return"{TimedHandler: "+this.handler+"("+this.period+")}"}}function F(e){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(e);return t<0?void 0:t}function H(e){if(e>=0&&e<64)return"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[e]}var G={atob:function(e){if(0===arguments.length)throw new TypeError("1 argument required, but only 0 present.");if((e=(e=""+e).replace(/[ \t\n\f\r]/g,"")).length%4==0&&(e=e.replace(/==?$/,"")),e.length%4==1||/[^+/0-9A-Za-z]/.test(e))return null;let t="",n=0,r=0;for(let i=0;i<e.length;i++)n<<=6,n|=F(e[i]),r+=6,24===r&&(t+=String.fromCharCode((16711680&n)>>16),t+=String.fromCharCode((65280&n)>>8),t+=String.fromCharCode(255&n),n=r=0);return 12===r?(n>>=4,t+=String.fromCharCode(n)):18===r&&(n>>=2,t+=String.fromCharCode((65280&n)>>8),t+=String.fromCharCode(255&n)),t},btoa:function(e){if(0===arguments.length)throw new TypeError("1 argument required, but only 0 present.");let t;for(e=""+e,t=0;t<e.length;t++)if(e.charCodeAt(t)>255)return null;let n="";for(t=0;t<e.length;t+=3){const r=[void 0,void 0,void 0,void 0];r[0]=e.charCodeAt(t)>>2,r[1]=(3&e.charCodeAt(t))<<4,e.length>t+1&&(r[1]|=e.charCodeAt(t+1)>>4,r[2]=(15&e.charCodeAt(t+1))<<2),e.length>t+2&&(r[2]|=e.charCodeAt(t+2)>>6,r[3]=63&e.charCodeAt(t+2));for(let e=0;e<r.length;e++)void 0===r[e]?n+="=":n+=H(r[e])}return n}};class q{constructor(e,t,n){this.mechname=e,this.isClientFirst=t,this.priority=n}test(){return!0}onStart(e){this._connection=e}onChallenge(e,t){throw new Error("You should implement challenge handling!")}clientChallenge(e){if(!this.isClientFirst)throw new Error("clientChallenge should not be called if isClientFirst is false!");return this.onChallenge(e)}onFailure(){this._connection=null}onSuccess(){this._connection=null}}const X={async scramResponse(e,t,n,r){var i,o,s;const a=e._sasl_data.cnonce,c=function(e){let t,n,r;const i=/([a-z]+)=([^,]+)(,|$)/;for(;e.match(i);){const o=e.match(i);switch(e=e.replace(o[0],""),o[1]){case"r":t=o[2];break;case"s":n=N.base64ToArrayBuf(o[2]);break;case"i":r=parseInt(o[2],10);break;default:return}}if(isNaN(r)||r<4096)z.warn("Failing SCRAM authentication because server supplied iteration count < 4096.");else{if(n)return{nonce:t,salt:n,iter:r};z.warn("Failing SCRAM authentication because server supplied incorrect salt.")}}(t);if(!c&&(null==c?void 0:c.nonce.slice(0,a.length))!==a)return z.warn("Failing SCRAM authentication because server supplied incorrect nonce."),e._sasl_data={},e._sasl_failure_cb();let u,l;if((null===(i=e.pass)||void 0===i?void 0:i.name)===n&&(null===(o=e.pass)||void 0===o?void 0:o.salt)===N.arrayBufToBase64(c.salt)&&(null===(s=e.pass)||void 0===s?void 0:s.iter)===c.iter)u=N.base64ToArrayBuf(e.pass.ck),l=N.base64ToArrayBuf(e.pass.sk);else{if(!("string"==typeof e.pass||e.pass instanceof String))return e._sasl_failure_cb();{const t=await async function(e,t,n,r,i){const o=await crypto.subtle.deriveBits({name:"PBKDF2",salt:t,iterations:n,hash:{name:r}},await crypto.subtle.importKey("raw",N.stringToArrayBuf(e),"PBKDF2",!1,["deriveBits"]),i),s=await crypto.subtle.importKey("raw",o,{name:"HMAC",hash:r},!1,["sign"]);return{ck:await crypto.subtle.sign("HMAC",s,N.stringToArrayBuf("Client Key")),sk:await crypto.subtle.sign("HMAC",s,N.stringToArrayBuf("Server Key"))}}(e.pass,c.salt,c.iter,n,r);u=t.ck,l=t.sk}}const d=e._sasl_data["client-first-message-bare"],h=t,p="c=biws,r="+c.nonce,f=`${d},${h},${p}`,g=await async function(e,t,n){const r=await crypto.subtle.importKey("raw",await crypto.subtle.digest(n,t),{name:"HMAC",hash:n},!1,["sign"]),i=await crypto.subtle.sign("HMAC",r,N.stringToArrayBuf(e));return N.xorArrayBuffers(t,i)}(f,u,n),m=await async function(e,t,n){const r=await crypto.subtle.importKey("raw",t,{name:"HMAC",hash:n},!1,["sign"]);return crypto.subtle.sign("HMAC",r,N.stringToArrayBuf(e))}(f,l,n);return e._sasl_data["server-signature"]=N.arrayBufToBase64(m),e._sasl_data.keys={name:n,iter:c.iter,salt:N.arrayBufToBase64(c.salt),ck:N.arrayBufToBase64(u),sk:N.arrayBufToBase64(l)},`${p},p=${N.arrayBufToBase64(g)}`},clientChallenge(e,t){const n=t||function(){const e=new Uint8Array(16);return N.arrayBufToBase64(crypto.getRandomValues(e).buffer)}(),r=`n=${e.authcid},r=${n}`;return e._sasl_data.cnonce=n,e._sasl_data["client-first-message-bare"]=r,"n,,"+r}},z={VERSION:"1.6.1",Builder:V,Connection:class{constructor(e,t){this.service=e,this.options=t||{},this.setProtocol(),this.jid="",this.domain=null,this.features=null,this._sasl_data={},this.do_bind=!1,this.do_session=!1,this.mechanisms={},this.timedHandlers=[],this.handlers=[],this.removeTimeds=[],this.removeHandlers=[],this.addTimeds=[],this.addHandlers=[],this.protocolErrorHandlers={HTTP:{},websocket:{}},this._idleTimeout=null,this._disconnectTimeout=null,this.authenticated=!1,this.connected=!1,this.disconnecting=!1,this.do_authentication=!0,this.paused=!1,this.restored=!1,this._data=[],this._uniqueId=0,this._sasl_success_handler=null,this._sasl_failure_handler=null,this._sasl_challenge_handler=null,this.maxRetries=5,this._idleTimeout=setTimeout(()=>this._onIdle(),100),b(this.options.cookies),this.registerSASLMechanisms(this.options.mechanisms),this.iqFallbackHandler=new B(e=>this.send(k({type:"error",id:e.getAttribute("id")}).c("error",{type:"cancel"}).c("service-unavailable",{xmlns:z.NS.STANZAS})),null,"iq",["get","set"]);for(const e in z._connectionPlugins)if(Object.prototype.hasOwnProperty.call(z._connectionPlugins,e)){const t=function(){};t.prototype=z._connectionPlugins[e],this[e]=new t,this[e].init(this)}}setProtocol(){const e=this.options.protocol||"";this.options.worker?this._proto=new z.WorkerWebsocket(this):0===this.service.indexOf("ws:")||0===this.service.indexOf("wss:")||0===e.indexOf("ws")?this._proto=new z.Websocket(this):this._proto=new z.Bosh(this)}reset(){this._proto._reset(),this.do_session=!1,this.do_bind=!1,this.timedHandlers=[],this.handlers=[],this.removeTimeds=[],this.removeHandlers=[],this.addTimeds=[],this.addHandlers=[],this.authenticated=!1,this.connected=!1,this.disconnecting=!1,this.restored=!1,this._data=[],this._requests=[],this._uniqueId=0}pause(){this.paused=!0}resume(){this.paused=!1}getUniqueId(e){const t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){const t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}));return"string"==typeof e||"number"==typeof e?t+":"+e:t+""}addProtocolErrorHandler(e,t,n){this.protocolErrorHandlers[e][t]=n}connect(e,t,n,r,i,o,s){let a=arguments.length>7&&void 0!==arguments[7]?arguments[7]:3e3;this.jid=e,this.authzid=z.getBareJidFromJid(this.jid),this.authcid=s||z.getNodeFromJid(this.jid),this.pass=t,this.scram_keys=null,this.connect_callback=n,this.disconnecting=!1,this.connected=!1,this.authenticated=!1,this.restored=!1,this.disconnection_timeout=a,this.domain=z.getDomainFromJid(this.jid),this._changeConnectStatus(l.CONNECTING,null),this._proto._connect(r,i,o)}attach(e,t,n,r,i,o,s){if(this._proto._attach)return this._proto._attach(e,t,n,r,i,o,s);{const e=new Error('The "attach" method is not available for your connection protocol');throw e.name="StropheSessionError",e}}restore(e,t,n,r,i){if(!this._sessionCachingSupported()){const e=new Error('The "restore" method can only be used with a BOSH connection.');throw e.name="StropheSessionError",e}this._proto._restore(e,t,n,r,i)}_sessionCachingSupported(){if(this._proto instanceof z.Bosh){if(!JSON)return!1;try{sessionStorage.setItem("_strophe_","_strophe_"),sessionStorage.removeItem("_strophe_")}catch(e){return!1}return!0}return!1}xmlInput(e){}xmlOutput(e){}rawInput(e){}rawOutput(e){}nextValidRid(e){}send(e){if(null!==e){if("function"==typeof e.sort)for(let t=0;t<e.length;t++)this._queueData(e[t]);else"function"==typeof e.tree?this._queueData(e.tree()):this._queueData(e);this._proto._send()}}flush(){clearTimeout(this._idleTimeout),this._onIdle()}sendPresence(e,t,n,r){let i=null;"function"==typeof e.tree&&(e=e.tree());let o=e.getAttribute("id");if(o||(o=this.getUniqueId("sendPresence"),e.setAttribute("id",o)),"function"==typeof t||"function"==typeof n){const e=this.addHandler(e=>{i&&this.deleteTimedHandler(i),"error"===e.getAttribute("type")?n&&n(e):t&&t(e)},null,"presence",null,o);r&&(i=this.addTimedHandler(r,()=>(this.deleteHandler(e),n&&n(null),!1)))}return this.send(e),o}sendIQ(e,t,n,r){let i=null;"function"==typeof e.tree&&(e=e.tree());let o=e.getAttribute("id");if(o||(o=this.getUniqueId("sendIQ"),e.setAttribute("id",o)),"function"==typeof t||"function"==typeof n){const e=this.addHandler(e=>{i&&this.deleteTimedHandler(i);const r=e.getAttribute("type");if("result"===r)t&&t(e);else{if("error"!==r){const e=new Error("Got bad IQ type of "+r);throw e.name="StropheError",e}n&&n(e)}},null,"iq",["error","result"],o);r&&(i=this.addTimedHandler(r,()=>(this.deleteHandler(e),n&&n(null),!1)))}return this.send(e),o}_queueData(e){if(null===e||!e.tagName||!e.childNodes){const e=new Error("Cannot queue non-DOMElement.");throw e.name="StropheError",e}this._data.push(e)}_sendRestart(){this._data.push("restart"),this._proto._sendRestart(),this._idleTimeout=setTimeout(()=>this._onIdle(),100)}addTimedHandler(e,t){const n=new z.TimedHandler(e,t);return this.addTimeds.push(n),n}deleteTimedHandler(e){this.removeTimeds.push(e)}addHandler(e,t,n,r,i,o,s){const a=new B(e,t,n,r,i,o,s);return this.addHandlers.push(a),a}deleteHandler(e){this.removeHandlers.push(e);const t=this.addHandlers.indexOf(e);t>=0&&this.addHandlers.splice(t,1)}registerSASLMechanisms(e){this.mechanisms={},(e=e||[z.SASLAnonymous,z.SASLExternal,z.SASLOAuthBearer,z.SASLXOAuth2,z.SASLPlain,z.SASLSHA1,z.SASLSHA256,z.SASLSHA384,z.SASLSHA512]).forEach(e=>this.registerSASLMechanism(e))}registerSASLMechanism(e){const t=new e;this.mechanisms[t.mechname]=t}disconnect(e){if(this._changeConnectStatus(l.DISCONNECTING,e),e?z.warn("Disconnect was called because: "+e):z.info("Disconnect was called"),this.connected){let e=!1;this.disconnecting=!0,this.authenticated&&(e=U({xmlns:z.NS.CLIENT,type:"unavailable"})),this._disconnectTimeout=this._addSysTimedHandler(this.disconnection_timeout,this._onDisconnectTimeout.bind(this)),this._proto._disconnect(e)}else z.warn("Disconnect was called before Strophe connected to the server"),this._proto._abortAllRequests(),this._doDisconnect()}_changeConnectStatus(e,t,n){for(const n in z._connectionPlugins)if(Object.prototype.hasOwnProperty.call(z._connectionPlugins,n)){const r=this[n];if(r.statusChanged)try{r.statusChanged(e,t)}catch(e){z.error(`${n} plugin caused an exception changing status: ${e}`)}}if(this.connect_callback)try{this.connect_callback(e,t,n)}catch(e){z._handleError(e),z.error("User connection callback caused an exception: "+e)}}_doDisconnect(e){"number"==typeof this._idleTimeout&&clearTimeout(this._idleTimeout),null!==this._disconnectTimeout&&(this.deleteTimedHandler(this._disconnectTimeout),this._disconnectTimeout=null),z.debug("_doDisconnect was called"),this._proto._doDisconnect(),this.authenticated=!1,this.disconnecting=!1,this.restored=!1,this.handlers=[],this.timedHandlers=[],this.removeTimeds=[],this.removeHandlers=[],this.addTimeds=[],this.addHandlers=[],this._changeConnectStatus(l.DISCONNECTED,e),this.connected=!1}_dataRecv(e,t){const n=this._proto._reqToData(e);if(null===n)return;for(this.xmlInput!==z.Connection.prototype.xmlInput&&(n.nodeName===this._proto.strip&&n.childNodes.length?this.xmlInput(n.childNodes[0]):this.xmlInput(n)),this.rawInput!==z.Connection.prototype.rawInput&&(t?this.rawInput(t):this.rawInput(z.serialize(n)));this.removeHandlers.length>0;){const e=this.removeHandlers.pop(),t=this.handlers.indexOf(e);t>=0&&this.handlers.splice(t,1)}for(;this.addHandlers.length>0;)this.handlers.push(this.addHandlers.pop());if(this.disconnecting&&this._proto._emptyQueue())return void this._doDisconnect();const r=n.getAttribute("type");if(null!==r&&"terminate"===r){if(this.disconnecting)return;let e=n.getAttribute("condition");const t=n.getElementsByTagName("conflict");return null!==e?("remote-stream-error"===e&&t.length>0&&(e="conflict"),this._changeConnectStatus(l.CONNFAIL,e)):this._changeConnectStatus(l.CONNFAIL,z.ErrorCondition.UNKOWN_REASON),void this._doDisconnect(e)}z.forEachChild(n,null,e=>{const t=[];this.handlers=this.handlers.reduce((n,r)=>{try{!r.isMatch(e)||!this.authenticated&&r.user?n.push(r):(r.run(e)&&n.push(r),t.push(r))}catch(e){z.warn("Removing Strophe handlers due to uncaught exception: "+e.message)}return n},[]),!t.length&&this.iqFallbackHandler.isMatch(e)&&this.iqFallbackHandler.run(e)})}_connect_cb(e,t,n){let r,i;z.debug("_connect_cb was called"),this.connected=!0;try{r=this._proto._reqToData(e)}catch(e){if(e.name!==z.ErrorCondition.BAD_FORMAT)throw e;this._changeConnectStatus(l.CONNFAIL,z.ErrorCondition.BAD_FORMAT),this._doDisconnect(z.ErrorCondition.BAD_FORMAT)}if(!r)return;if(this.xmlInput!==z.Connection.prototype.xmlInput&&(r.nodeName===this._proto.strip&&r.childNodes.length?this.xmlInput(r.childNodes[0]):this.xmlInput(r)),this.rawInput!==z.Connection.prototype.rawInput&&(n?this.rawInput(n):this.rawInput(z.serialize(r))),this._proto._connect_cb(r)===l.CONNFAIL)return;if(i=r.getElementsByTagNameNS?r.getElementsByTagNameNS(z.NS.STREAM,"features").length>0:r.getElementsByTagName("stream:features").length>0||r.getElementsByTagName("features").length>0,!i)return void this._proto._no_auth_received(t);const o=Array.from(r.getElementsByTagName("mechanism")).map(e=>this.mechanisms[e.textContent]).filter(e=>e);0!==o.length||0!==r.getElementsByTagName("auth").length?!1!==this.do_authentication&&this.authenticate(o):this._proto._no_auth_received(t)}sortMechanismsByPriority(e){for(let t=0;t<e.length-1;++t){let n=t;for(let r=t+1;r<e.length;++r)e[r].priority>e[n].priority&&(n=r);if(n!==t){const r=e[t];e[t]=e[n],e[n]=r}}return e}authenticate(e){this._attemptSASLAuth(e)||this._attemptLegacyAuth()}_attemptSASLAuth(e){e=this.sortMechanismsByPriority(e||[]);let t=!1;for(let n=0;n<e.length;++n){if(!e[n].test(this))continue;this._sasl_success_handler=this._addSysHandler(this._sasl_success_cb.bind(this),null,"success",null,null),this._sasl_failure_handler=this._addSysHandler(this._sasl_failure_cb.bind(this),null,"failure",null,null),this._sasl_challenge_handler=this._addSysHandler(this._sasl_challenge_cb.bind(this),null,"challenge",null,null),this._sasl_mechanism=e[n],this._sasl_mechanism.onStart(this);const r=D("auth",{xmlns:z.NS.SASL,mechanism:this._sasl_mechanism.mechname});if(this._sasl_mechanism.isClientFirst){const e=this._sasl_mechanism.clientChallenge(this);r.t(G.btoa(e))}this.send(r.tree()),t=!0;break}return t}async _sasl_challenge_cb(e){const t=G.atob(R(e)),n=await this._sasl_mechanism.onChallenge(this,t),r=D("response",{xmlns:z.NS.SASL});return""!==n&&r.t(G.btoa(n)),this.send(r.tree()),!0}_attemptLegacyAuth(){null===z.getNodeFromJid(this.jid)?(this._changeConnectStatus(l.CONNFAIL,z.ErrorCondition.MISSING_JID_NODE),this.disconnect(z.ErrorCondition.MISSING_JID_NODE)):(this._changeConnectStatus(l.AUTHENTICATING,null),this._addSysHandler(this._onLegacyAuthIQResult.bind(this),null,null,null,"_auth_1"),this.send(k({type:"get",to:this.domain,id:"_auth_1"}).c("query",{xmlns:z.NS.AUTH}).c("username",{}).t(z.getNodeFromJid(this.jid)).tree()))}_onLegacyAuthIQResult(e){const t=k({type:"set",id:"_auth_2"}).c("query",{xmlns:z.NS.AUTH}).c("username",{}).t(z.getNodeFromJid(this.jid)).up().c("password").t(this.pass);return z.getResourceFromJid(this.jid)||(this.jid=z.getBareJidFromJid(this.jid)+"/strophe"),t.up().c("resource",{}).t(z.getResourceFromJid(this.jid)),this._addSysHandler(this._auth2_cb.bind(this),null,null,null,"_auth_2"),this.send(t.tree()),!1}_sasl_success_cb(e){if(this._sasl_data["server-signature"]){let t;const n=/([a-z]+)=([^,]+)(,|$)/,r=G.atob(R(e)).match(n);if("v"===r[1]&&(t=r[2]),t!==this._sasl_data["server-signature"])return this.deleteHandler(this._sasl_failure_handler),this._sasl_failure_handler=null,this._sasl_challenge_handler&&(this.deleteHandler(this._sasl_challenge_handler),this._sasl_challenge_handler=null),this._sasl_data={},this._sasl_failure_cb(null)}z.info("SASL authentication succeeded."),this._sasl_data.keys&&(this.scram_keys=this._sasl_data.keys),this._sasl_mechanism&&this._sasl_mechanism.onSuccess(),this.deleteHandler(this._sasl_failure_handler),this._sasl_failure_handler=null,this._sasl_challenge_handler&&(this.deleteHandler(this._sasl_challenge_handler),this._sasl_challenge_handler=null);const t=[],n=(e,t)=>{for(;e.length;)this.deleteHandler(e.pop());return this._onStreamFeaturesAfterSASL(t),!1};return t.push(this._addSysHandler(e=>n(t,e),null,"stream:features",null,null)),t.push(this._addSysHandler(e=>n(t,e),z.NS.STREAM,"features",null,null)),this._sendRestart(),!1}_onStreamFeaturesAfterSASL(e){this.features=e;for(let t=0;t<e.childNodes.length;t++){const n=e.childNodes[t];"bind"===n.nodeName&&(this.do_bind=!0),"session"===n.nodeName&&(this.do_session=!0)}return this.do_bind?(this.options.explicitResourceBinding?this._changeConnectStatus(l.BINDREQUIRED,null):this.bind(),!1):(this._changeConnectStatus(l.AUTHFAIL,null),!1)}bind(){if(!this.do_bind)return void z.log(z.LogLevel.INFO,'Strophe.Connection.prototype.bind called but "do_bind" is false');this._addSysHandler(this._onResourceBindResultIQ.bind(this),null,null,null,"_bind_auth_2");const e=z.getResourceFromJid(this.jid);e?this.send(k({type:"set",id:"_bind_auth_2"}).c("bind",{xmlns:z.NS.BIND}).c("resource",{}).t(e).tree()):this.send(k({type:"set",id:"_bind_auth_2"}).c("bind",{xmlns:z.NS.BIND}).tree())}_onResourceBindResultIQ(e){if("error"===e.getAttribute("type")){let t;return z.warn("Resource binding failed."),e.getElementsByTagName("conflict").length>0&&(t=z.ErrorCondition.CONFLICT),this._changeConnectStatus(l.AUTHFAIL,t,e),!1}const t=e.getElementsByTagName("bind");if(!(t.length>0))return z.warn("Resource binding failed."),this._changeConnectStatus(l.AUTHFAIL,null,e),!1;{const e=t[0].getElementsByTagName("jid");e.length>0&&(this.authenticated=!0,this.jid=R(e[0]),this.do_session?this._establishSession():this._changeConnectStatus(l.CONNECTED,null))}}_establishSession(){if(!this.do_session)throw new Error(`Strophe.Connection.prototype._establishSession called but apparently ${z.NS.SESSION} wasn't advertised by the server`);this._addSysHandler(this._onSessionResultIQ.bind(this),null,null,null,"_session_auth_2"),this.send(k({type:"set",id:"_session_auth_2"}).c("session",{xmlns:z.NS.SESSION}).tree())}_onSessionResultIQ(e){if("result"===e.getAttribute("type"))this.authenticated=!0,this._changeConnectStatus(l.CONNECTED,null);else if("error"===e.getAttribute("type"))return this.authenticated=!1,z.warn("Session creation failed."),this._changeConnectStatus(l.AUTHFAIL,null,e),!1;return!1}_sasl_failure_cb(e){return this._sasl_success_handler&&(this.deleteHandler(this._sasl_success_handler),this._sasl_success_handler=null),this._sasl_challenge_handler&&(this.deleteHandler(this._sasl_challenge_handler),this._sasl_challenge_handler=null),this._sasl_mechanism&&this._sasl_mechanism.onFailure(),this._changeConnectStatus(l.AUTHFAIL,null,e),!1}_auth2_cb(e){return"result"===e.getAttribute("type")?(this.authenticated=!0,this._changeConnectStatus(l.CONNECTED,null)):"error"===e.getAttribute("type")&&(this._changeConnectStatus(l.AUTHFAIL,null,e),this.disconnect("authentication failed")),!1}_addSysTimedHandler(e,t){const n=new j(e,t);return n.user=!1,this.addTimeds.push(n),n}_addSysHandler(e,t,n,r,i){const o=new B(e,t,n,r,i);return o.user=!1,this.addHandlers.push(o),o}_onDisconnectTimeout(){return z.debug("_onDisconnectTimeout was called"),this._changeConnectStatus(l.CONNTIMEOUT,null),this._proto._onDisconnectTimeout(),this._doDisconnect(),!1}_onIdle(){for(;this.addTimeds.length>0;)this.timedHandlers.push(this.addTimeds.pop());for(;this.removeTimeds.length>0;){const e=this.removeTimeds.pop(),t=this.timedHandlers.indexOf(e);t>=0&&this.timedHandlers.splice(t,1)}const e=(new Date).getTime(),t=[];for(let n=0;n<this.timedHandlers.length;n++){const r=this.timedHandlers[n];!this.authenticated&&r.user||(r.lastCalled+r.period-e<=0?r.run()&&t.push(r):t.push(r))}this.timedHandlers=t,clearTimeout(this._idleTimeout),this._proto._onIdle(),this.connected&&(this._idleTimeout=setTimeout(()=>this._onIdle(),100))}},ElementType:d,ErrorCondition:{BAD_FORMAT:"bad-format",CONFLICT:"conflict",MISSING_JID_NODE:"x-strophe-bad-non-anon-jid",NO_AUTH_MECH:"no-auth-mech",UNKNOWN_REASON:"unknown"},Handler:B,LogLevel:{DEBUG:0,INFO:1,WARN:2,ERROR:3,FATAL:4},NS:c,SASLMechanism:q,Status:l,TimedHandler:j,...M,XHTML:{...u,validTag:E,validCSS:T,validAttribute:C},addNamespace(e,t){z.NS[e]=t},_handleError(e){void 0!==e.stack&&z.fatal(e.stack),e.sourceURL?z.fatal("error: "+this.handler+" "+e.sourceURL+":"+e.line+" - "+e.name+": "+e.message):e.fileName?z.fatal("error: "+this.handler+" "+e.fileName+":"+e.lineNumber+" - "+e.name+": "+e.message):z.fatal("error: "+e.message)},log(e,t){var n;e===this.LogLevel.FATAL&&(null===(n=console)||void 0===n||n.error(t))},debug(e){this.log(this.LogLevel.DEBUG,e)},info(e){this.log(this.LogLevel.INFO,e)},warn(e){this.log(this.LogLevel.WARN,e)},error(e){this.log(this.LogLevel.ERROR,e)},fatal(e){this.log(this.LogLevel.FATAL,e)},_requestId:0,_connectionPlugins:{},addConnectionPlugin(e,t){z._connectionPlugins[e]=t}};z.SASLAnonymous=class extends q{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"ANONYMOUS",arguments.length>1&&void 0!==arguments[1]&&arguments[1],arguments.length>2&&void 0!==arguments[2]?arguments[2]:20)}test(e){return null===e.authcid}},z.SASLPlain=class extends q{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"PLAIN",!(arguments.length>1&&void 0!==arguments[1])||arguments[1],arguments.length>2&&void 0!==arguments[2]?arguments[2]:50)}test(e){return null!==e.authcid}onChallenge(e){const{authcid:t,authzid:n,domain:r,pass:i}=e;if(!r)throw new Error("SASLPlain onChallenge: domain is not defined!");let o=n!==`${t}@${r}`?n:"";return o+="\0",o+=t,o+="\0",o+=i,N.utf16to8(o)}},z.SASLSHA1=class extends q{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"SCRAM-SHA-1",!(arguments.length>1&&void 0!==arguments[1])||arguments[1],arguments.length>2&&void 0!==arguments[2]?arguments[2]:60)}test(e){return null!==e.authcid}async onChallenge(e,t){return await X.scramResponse(e,t,"SHA-1",160)}clientChallenge(e,t){return X.clientChallenge(e,t)}},z.SASLSHA256=class extends q{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"SCRAM-SHA-256",!(arguments.length>1&&void 0!==arguments[1])||arguments[1],arguments.length>2&&void 0!==arguments[2]?arguments[2]:70)}test(e){return null!==e.authcid}async onChallenge(e,t){return await X.scramResponse(e,t,"SHA-256",256)}clientChallenge(e,t){return X.clientChallenge(e,t)}},z.SASLSHA384=class extends q{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"SCRAM-SHA-384",!(arguments.length>1&&void 0!==arguments[1])||arguments[1],arguments.length>2&&void 0!==arguments[2]?arguments[2]:71)}test(e){return null!==e.authcid}async onChallenge(e,t){return await X.scramResponse(e,t,"SHA-384",384)}clientChallenge(e,t){return X.clientChallenge(e,t)}},z.SASLSHA512=class extends q{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"SCRAM-SHA-512",!(arguments.length>1&&void 0!==arguments[1])||arguments[1],arguments.length>2&&void 0!==arguments[2]?arguments[2]:72)}test(e){return null!==e.authcid}async onChallenge(e,t){return await X.scramResponse(e,t,"SHA-512",512)}clientChallenge(e,t){return X.clientChallenge(e,t)}},z.SASLOAuthBearer=class extends q{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"OAUTHBEARER",!(arguments.length>1&&void 0!==arguments[1])||arguments[1],arguments.length>2&&void 0!==arguments[2]?arguments[2]:40)}test(e){return null!==e.pass}onChallenge(e){let t="n,";return null!==e.authcid&&(t=t+"a="+e.authzid),t+=",",t+="",t+="auth=Bearer ",t+=e.pass,t+="",t+="",N.utf16to8(t)}},z.SASLExternal=class extends q{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"EXTERNAL",!(arguments.length>1&&void 0!==arguments[1])||arguments[1],arguments.length>2&&void 0!==arguments[2]?arguments[2]:10)}onChallenge(e){return e.authcid===e.authzid?"":e.authzid}},z.SASLXOAuth2=class extends q{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"X-OAUTH2",!(arguments.length>1&&void 0!==arguments[1])||arguments[1],arguments.length>2&&void 0!==arguments[2]?arguments[2]:30)}test(e){return null!==e.pass}onChallenge(e){let t="\0";return null!==e.authcid&&(t+=e.authzid),t+="\0",t+=e.pass,N.utf16to8(t)}};var Y={Strophe:z,$build:D,$iq:k,$msg:L,$pres:U};z.Request=class{constructor(e,t,n,r){this.id=++z._requestId,this.xmlData=e,this.data=z.serialize(e),this.origFunc=t,this.func=t,this.rid=n,this.date=NaN,this.sends=r||0,this.abort=!1,this.dead=null,this.age=function(){return this.date?(new Date-this.date)/1e3:0},this.timeDead=function(){return this.dead?(new Date-this.dead)/1e3:0},this.xhr=this._newXHR()}getResponse(){let e=null;if(this.xhr.responseXML&&this.xhr.responseXML.documentElement){if(e=this.xhr.responseXML.documentElement,"parsererror"===e.tagName)throw z.error("invalid response received"),z.error("responseText: "+this.xhr.responseText),z.error("responseXML: "+z.serialize(this.xhr.responseXML)),new Error("parsererror")}else if(this.xhr.responseText){var t;z.debug("Got responseText but no responseXML; attempting to parse it with DOMParser..."),e=(new o).parseFromString(this.xhr.responseText,"application/xml").documentElement;const n=null===(t=e)||void 0===t?void 0:t.querySelector("parsererror");if(!e||n){n&&(z.error("invalid response received: "+n.textContent),z.error("responseText: "+this.xhr.responseText));const e=new Error;throw e.name=z.ErrorCondition.BAD_FORMAT,e}}return e}_newXHR(){let e=null;return globalThis.XMLHttpRequest?(e=new XMLHttpRequest,e.overrideMimeType&&e.overrideMimeType("text/xml; charset=utf-8")):globalThis.ActiveXObject&&(e=new ActiveXObject("Microsoft.XMLHTTP")),e.onreadystatechange=this.func.bind(null,this),e}},z.Bosh=class e{constructor(e){this._conn=e,this.rid=Math.floor(4294967295*Math.random()),this.sid=null,this.hold=1,this.wait=60,this.window=5,this.errors=0,this.inactivity=null,this.lastResponseHeaders=null,this._requests=[]}_buildBody(){const e=D("body",{rid:this.rid++,xmlns:z.NS.HTTPBIND});return null!==this.sid&&e.attrs({sid:this.sid}),this._conn.options.keepalive&&this._conn._sessionCachingSupported()&&this._cacheSession(),e}_reset(){this.rid=Math.floor(4294967295*Math.random()),this.sid=null,this.errors=0,this._conn._sessionCachingSupported()&&sessionStorage.removeItem("strophe-bosh-session"),this._conn.nextValidRid(this.rid)}_connect(e,t,n){this.wait=e||this.wait,this.hold=t||this.hold,this.errors=0;const r=this._buildBody().attrs({to:this._conn.domain,"xml:lang":"en",wait:this.wait,hold:this.hold,content:"text/xml; charset=utf-8",ver:"1.6","xmpp:version":"1.0","xmlns:xmpp":z.NS.BOSH});n&&r.attrs({route:n});const i=this._conn._connect_cb;this._requests.push(new z.Request(r.tree(),this._onRequestStateChange.bind(this,i.bind(this._conn)),r.tree().getAttribute("rid"))),this._throttledRequestHandler()}_attach(e,t,n,r,i,o,s){this._conn.jid=e,this.sid=t,this.rid=n,this._conn.connect_callback=r,this._conn.domain=z.getDomainFromJid(this._conn.jid),this._conn.authenticated=!0,this._conn.connected=!0,this.wait=i||this.wait,this.hold=o||this.hold,this.window=s||this.window,this._conn._changeConnectStatus(z.Status.ATTACHED,null)}_restore(e,t,n,r,i){const o=JSON.parse(sessionStorage.getItem("strophe-bosh-session"));if(!(null!=o&&o.rid&&o.sid&&o.jid&&(null==e||z.getBareJidFromJid(o.jid)===z.getBareJidFromJid(e)||null===z.getNodeFromJid(e)&&z.getDomainFromJid(o.jid)===e))){const e=new Error("_restore: no restoreable session.");throw e.name="StropheSessionError",e}this._conn.restored=!0,this._attach(o.jid,o.sid,o.rid,t,n,r,i)}_cacheSession(){this._conn.authenticated?this._conn.jid&&this.rid&&this.sid&&sessionStorage.setItem("strophe-bosh-session",JSON.stringify({jid:this._conn.jid,rid:this.rid,sid:this.sid})):sessionStorage.removeItem("strophe-bosh-session")}_connect_cb(e){const t=e.getAttribute("type");if(null!==t&&"terminate"===t){let t=e.getAttribute("condition");z.error("BOSH-Connection failed: "+t);const n=e.getElementsByTagName("conflict");return null!==t?("remote-stream-error"===t&&n.length>0&&(t="conflict"),this._conn._changeConnectStatus(z.Status.CONNFAIL,t)):this._conn._changeConnectStatus(z.Status.CONNFAIL,"unknown"),this._conn._doDisconnect(t),z.Status.CONNFAIL}this.sid||(this.sid=e.getAttribute("sid"));const n=e.getAttribute("requests");n&&(this.window=parseInt(n,10));const r=e.getAttribute("hold");r&&(this.hold=parseInt(r,10));const i=e.getAttribute("wait");i&&(this.wait=parseInt(i,10));const o=e.getAttribute("inactivity");o&&(this.inactivity=parseInt(o,10))}_disconnect(e){this._sendTerminate(e)}_doDisconnect(){this.sid=null,this.rid=Math.floor(4294967295*Math.random()),this._conn._sessionCachingSupported()&&sessionStorage.removeItem("strophe-bosh-session"),this._conn.nextValidRid(this.rid)}_emptyQueue(){return 0===this._requests.length}_callProtocolErrorHandlers(t){const n=e._getRequestStatus(t),r=this._conn.protocolErrorHandlers.HTTP[n];r&&r.call(this,n)}_hitError(e){this.errors++,z.warn("request errored, status: "+e+", number of errors: "+this.errors),this.errors>4&&this._conn._onDisconnectTimeout()}_no_auth_received(e){z.warn("Server did not yet offer a supported authentication mechanism. Sending a blank poll request."),e=e?e.bind(this._conn):this._conn._connect_cb.bind(this._conn);const t=this._buildBody();this._requests.push(new z.Request(t.tree(),this._onRequestStateChange.bind(this,e),t.tree().getAttribute("rid"))),this._throttledRequestHandler()}_onDisconnectTimeout(){this._abortAllRequests()}_abortAllRequests(){for(;this._requests.length>0;){const e=this._requests.pop();e.abort=!0,e.xhr.abort(),e.xhr.onreadystatechange=function(){}}}_onIdle(){const e=this._conn._data;if(this._conn.authenticated&&0===this._requests.length&&0===e.length&&!this._conn.disconnecting&&(z.debug("no requests during idle cycle, sending blank request"),e.push(null)),!this._conn.paused){if(this._requests.length<2&&e.length>0){const t=this._buildBody();for(let n=0;n<e.length;n++)null!==e[n]&&("restart"===e[n]?t.attrs({to:this._conn.domain,"xml:lang":"en","xmpp:restart":"true","xmlns:xmpp":z.NS.BOSH}):t.cnode(e[n]).up());delete this._conn._data,this._conn._data=[],this._requests.push(new z.Request(t.tree(),this._onRequestStateChange.bind(this,this._conn._dataRecv.bind(this._conn)),t.tree().getAttribute("rid"))),this._throttledRequestHandler()}if(this._requests.length>0){const e=this._requests[0].age();null!==this._requests[0].dead&&this._requests[0].timeDead()>Math.floor(z.SECONDARY_TIMEOUT*this.wait)&&this._throttledRequestHandler(),e>Math.floor(z.TIMEOUT*this.wait)&&(z.warn("Request "+this._requests[0].id+" timed out, over "+Math.floor(z.TIMEOUT*this.wait)+" seconds since last activity"),this._throttledRequestHandler())}}}static _getRequestStatus(e,t){let n;if(4===e.xhr.readyState)try{n=e.xhr.status}catch(e){z.error("Caught an error while retrieving a request's status, reqStatus: "+n)}return void 0===n&&(n="number"==typeof t?t:0),n}_onRequestStateChange(t,n){if(z.debug("request id "+n.id+"."+n.sends+" state changed to "+n.xhr.readyState),n.abort)return void(n.abort=!1);if(4!==n.xhr.readyState)return;const r=e._getRequestStatus(n);if(this.lastResponseHeaders=n.xhr.getAllResponseHeaders(),this._conn.disconnecting&&r>=400)return this._hitError(r),void this._callProtocolErrorHandlers(n);const i=this._requests[0]===n,o=this._requests[1]===n,s=r>0&&r<500,a=n.sends>this._conn.maxRetries;(s||a)&&(this._removeRequest(n),z.debug("request id "+n.id+" should now be removed")),200===r?((o||i&&this._requests.length>0&&this._requests[0].age()>Math.floor(z.SECONDARY_TIMEOUT*this.wait))&&this._restartRequest(0),this._conn.nextValidRid(Number(n.rid)+1),z.debug("request id "+n.id+"."+n.sends+" got 200"),t(n),this.errors=0):0===r||r>=400&&r<600||r>=12e3?(z.error("request id "+n.id+"."+n.sends+" error "+r+" happened"),this._hitError(r),this._callProtocolErrorHandlers(n),r>=400&&r<500&&(this._conn._changeConnectStatus(z.Status.DISCONNECTING,null),this._conn._doDisconnect())):z.error("request id "+n.id+"."+n.sends+" error "+r+" happened"),s||a?a&&!this._conn.connected&&this._conn._changeConnectStatus(z.Status.CONNFAIL,"giving-up"):this._throttledRequestHandler()}_processRequest(t){let n=this._requests[t];const r=e._getRequestStatus(n,-1);if(n.sends>this._conn.maxRetries)return void this._conn._onDisconnectTimeout();const i=n.age(),o=!isNaN(i)&&i>Math.floor(z.TIMEOUT*this.wait),s=null!==n.dead&&n.timeDead()>Math.floor(z.SECONDARY_TIMEOUT*this.wait),a=4===n.xhr.readyState&&(r<1||r>=500);if((o||s||a)&&(s&&z.error(`Request ${this._requests[t].id} timed out (secondary), restarting`),n.abort=!0,n.xhr.abort(),n.xhr.onreadystatechange=function(){},this._requests[t]=new z.Request(n.xmlData,n.origFunc,n.rid,n.sends),n=this._requests[t]),0===n.xhr.readyState){z.debug("request id "+n.id+"."+n.sends+" posting");try{const e=this._conn.options.contentType||"text/xml; charset=utf-8";n.xhr.open("POST",this._conn.service,!this._conn.options.sync),void 0!==n.xhr.setRequestHeader&&n.xhr.setRequestHeader("Content-Type",e),this._conn.options.withCredentials&&(n.xhr.withCredentials=!0)}catch(e){return z.error("XHR open failed: "+e.toString()),this._conn.connected||this._conn._changeConnectStatus(z.Status.CONNFAIL,"bad-service"),void this._conn.disconnect()}const e=()=>{if(n.date=new Date,this._conn.options.customHeaders){const e=this._conn.options.customHeaders;for(const t in e)Object.prototype.hasOwnProperty.call(e,t)&&n.xhr.setRequestHeader(t,e[t])}n.xhr.send(n.data)};if(n.sends>1){const t=1e3*Math.min(Math.floor(z.TIMEOUT*this.wait),Math.pow(n.sends,3));setTimeout((function(){e()}),t)}else e();n.sends++,this._conn.xmlOutput!==z.Connection.prototype.xmlOutput&&(n.xmlData.nodeName===this.strip&&n.xmlData.childNodes.length?this._conn.xmlOutput(n.xmlData.childNodes[0]):this._conn.xmlOutput(n.xmlData)),this._conn.rawOutput!==z.Connection.prototype.rawOutput&&this._conn.rawOutput(n.data)}else z.debug("_processRequest: "+(0===t?"first":"second")+" request has readyState of "+n.xhr.readyState)}_removeRequest(e){z.debug("removing request");for(let t=this._requests.length-1;t>=0;t--)e===this._requests[t]&&this._requests.splice(t,1);e.xhr.onreadystatechange=function(){},this._throttledRequestHandler()}_restartRequest(e){const t=this._requests[e];null===t.dead&&(t.dead=new Date),this._processRequest(e)}_reqToData(e){try{return e.getResponse()}catch(e){if("parsererror"!==e.message)throw e;this._conn.disconnect("strophe-parsererror")}}_sendTerminate(e){z.debug("_sendTerminate was called");const t=this._buildBody().attrs({type:"terminate"});e&&t.cnode(e.tree());const n=new z.Request(t.tree(),this._onRequestStateChange.bind(this,this._conn._dataRecv.bind(this._conn)),t.tree().getAttribute("rid"));this._requests.push(n),this._throttledRequestHandler()}_send(){clearTimeout(this._conn._idleTimeout),this._throttledRequestHandler(),this._conn._idleTimeout=setTimeout(()=>this._conn._onIdle(),100)}_sendRestart(){this._throttledRequestHandler(),clearTimeout(this._conn._idleTimeout)}_throttledRequestHandler(){this._requests?z.debug("_throttledRequestHandler called with "+this._requests.length+" requests"):z.debug("_throttledRequestHandler called with undefined requests"),this._requests&&0!==this._requests.length&&(this._requests.length>0&&this._processRequest(0),this._requests.length>1&&Math.abs(this._requests[0].rid-this._requests[1].rid)<this.window&&this._processRequest(1))}},z.Bosh.prototype.strip=null,z.Websocket=class{constructor(e){this._conn=e,this.strip="wrapper";const t=e.service;if(0!==t.indexOf("ws:")&&0!==t.indexOf("wss:")){let n="";"ws"===e.options.protocol&&"https:"!==location.protocol?n+="ws":n+="wss",n+="://"+location.host,0!==t.indexOf("/")?n+=location.pathname+t:n+=t,e.service=n}}_buildStream(){return D("open",{xmlns:z.NS.FRAMING,to:this._conn.domain,version:"1.0"})}_checkStreamError(e,t){let n;if(n=e.getElementsByTagNameNS?e.getElementsByTagNameNS(z.NS.STREAM,"error"):e.getElementsByTagName("stream:error"),0===n.length)return!1;const r=n[0];let i="",o="";for(let e=0;e<r.childNodes.length;e++){const t=r.childNodes[e];if("urn:ietf:params:xml:ns:xmpp-streams"!==t.getAttribute("xmlns"))break;"text"===t.nodeName?o=t.textContent:i=t.nodeName}let s="WebSocket stream error: ";return s+=i||"unknown",o&&(s+=" - "+o),z.error(s),this._conn._changeConnectStatus(t,i),this._conn._doDisconnect(),!0}_reset(){}_connect(){this._closeSocket(),this.socket=new i(this._conn.service,"xmpp"),this.socket.onopen=()=>this._onOpen(),this.socket.onerror=e=>this._onError(e),this.socket.onclose=e=>this._onClose(e),this.socket.onmessage=e=>this._onInitialMessage(e)}_connect_cb(e){if(this._checkStreamError(e,z.Status.CONNFAIL))return z.Status.CONNFAIL}_handleStreamStart(e){let t=!1;const n=e.getAttribute("xmlns");"string"!=typeof n?t="Missing xmlns in <open />":n!==z.NS.FRAMING&&(t="Wrong xmlns in <open />: "+n);const r=e.getAttribute("version");return"string"!=typeof r?t="Missing version in <open />":"1.0"!==r&&(t="Wrong version in <open />: "+r),!t||(this._conn._changeConnectStatus(z.Status.CONNFAIL,t),this._conn._doDisconnect(),!1)}_onInitialMessage(e){if(0===e.data.indexOf("<open ")||0===e.data.indexOf("<?xml")){const t=e.data.replace(/^(<\?.*?\?>\s*)*/,"");if(""===t)return;const n=(new o).parseFromString(t,"text/xml").documentElement;this._conn.xmlInput(n),this._conn.rawInput(e.data),this._handleStreamStart(n)&&this._connect_cb(n)}else if(0===e.data.indexOf("<close ")){const t=(new o).parseFromString(e.data,"text/xml").documentElement;this._conn.xmlInput(t),this._conn.rawInput(e.data);const n=t.getAttribute("see-other-uri");if(n){const e=this._conn.service;(e.indexOf("wss:")>=0&&n.indexOf("wss:")>=0||e.indexOf("ws:")>=0)&&(this._conn._changeConnectStatus(z.Status.REDIRECT,"Received see-other-uri, resetting connection"),this._conn.reset(),this._conn.service=n,this._connect())}else this._conn._changeConnectStatus(z.Status.CONNFAIL,"Received closing stream"),this._conn._doDisconnect()}else{this._replaceMessageHandler();const t=this._streamWrap(e.data),n=(new o).parseFromString(t,"text/xml").documentElement;this._conn._connect_cb(n,null,e.data)}}_replaceMessageHandler(){this.socket.onmessage=e=>this._onMessage(e)}_disconnect(e){if(this.socket&&this.socket.readyState!==i.CLOSED){e&&this._conn.send(e);const t=D("close",{xmlns:z.NS.FRAMING});this._conn.xmlOutput(t.tree());const n=z.serialize(t);this._conn.rawOutput(n);try{this.socket.send(n)}catch(e){z.warn("Couldn't send <close /> tag.")}}setTimeout(()=>this._conn._doDisconnect(),0)}_doDisconnect(){z.debug("WebSockets _doDisconnect was called"),this._closeSocket()}_streamWrap(e){return"<wrapper>"+e+"</wrapper>"}_closeSocket(){if(this.socket)try{this.socket.onclose=null,this.socket.onerror=null,this.socket.onmessage=null,this.socket.close()}catch(e){z.debug(e.message)}this.socket=null}_emptyQueue(){return!0}_onClose(e){this._conn.connected&&!this._conn.disconnecting?(z.error("Websocket closed unexpectedly"),this._conn._doDisconnect()):e&&1006===e.code&&!this._conn.connected&&this.socket?(z.error("Websocket closed unexcectedly"),this._conn._changeConnectStatus(z.Status.CONNFAIL,"The WebSocket connection could not be established or was disconnected."),this._conn._doDisconnect()):z.debug("Websocket closed")}_no_auth_received(e){z.error("Server did not offer a supported authentication mechanism"),this._conn._changeConnectStatus(z.Status.CONNFAIL,z.ErrorCondition.NO_AUTH_MECH),e&&e.call(this._conn),this._conn._doDisconnect()}_onDisconnectTimeout(){}_abortAllRequests(){}_onError(e){z.error("Websocket error "+JSON.stringify(e)),this._conn._changeConnectStatus(z.Status.CONNFAIL,"The WebSocket connection could not be established or was disconnected."),this._disconnect()}_onIdle(){const e=this._conn._data;if(e.length>0&&!this._conn.paused){for(let t=0;t<e.length;t++)if(null!==e[t]){let n;n="restart"===e[t]?this._buildStream().tree():e[t];const r=z.serialize(n);this._conn.xmlOutput(n),this._conn.rawOutput(r),this.socket.send(r)}this._conn._data=[]}}_onMessage(e){let t;const n='<close xmlns="urn:ietf:params:xml:ns:xmpp-framing" />';if(e.data===n)return this._conn.rawInput(n),this._conn.xmlInput(e),void(this._conn.disconnecting||this._conn._doDisconnect());if(0===e.data.search("<open ")){if(t=(new o).parseFromString(e.data,"text/xml").documentElement,!this._handleStreamStart(t))return}else{const n=this._streamWrap(e.data);t=(new o).parseFromString(n,"text/xml").documentElement}return this._checkStreamError(t,z.Status.ERROR)?void 0:this._conn.disconnecting&&"presence"===t.firstChild.nodeName&&"unavailable"===t.firstChild.getAttribute("type")?(this._conn.xmlInput(t),void this._conn.rawInput(z.serialize(t))):void this._conn._dataRecv(t,e.data)}_onOpen(){z.debug("Websocket open");const e=this._buildStream();this._conn.xmlOutput(e.tree());const t=z.serialize(e);this._conn.rawOutput(t),this.socket.send(t)}_reqToData(e){return e}_send(){this._conn.flush()}_sendRestart(){clearTimeout(this._conn._idleTimeout),this._conn._onIdle.bind(this._conn)()}};const W={};W.debug=z.LogLevel.DEBUG,W.info=z.LogLevel.INFO,W.warn=z.LogLevel.WARN,W.error=z.LogLevel.ERROR,W.fatal=z.LogLevel.FATAL,z.WorkerWebsocket=class extends z.Websocket{constructor(e){super(e),this._conn=e,this.worker=new SharedWorker(this._conn.options.worker,"Strophe XMPP Connection"),this.worker.onerror=e=>{var t;null===(t=console)||void 0===t||t.error(e),z.log(z.LogLevel.ERROR,"Shared Worker Error: "+e)}}get socket(){return{send:e=>this.worker.port.postMessage(["send",e])}}_connect(){this._messageHandler=e=>this._onInitialMessage(e),this.worker.port.start(),this.worker.port.onmessage=e=>this._onWorkerMessage(e),this.worker.port.postMessage(["_connect",this._conn.service,this._conn.jid])}_attach(e){this._messageHandler=e=>this._onMessage(e),this._conn.connect_callback=e,this.worker.port.start(),this.worker.port.onmessage=e=>this._onWorkerMessage(e),this.worker.port.postMessage(["_attach",this._conn.service])}_attachCallback(e,t){e===z.Status.ATTACHED?(this._conn.jid=t,this._conn.authenticated=!0,this._conn.connected=!0,this._conn.restored=!0,this._conn._changeConnectStatus(z.Status.ATTACHED)):e===z.Status.ATTACHFAIL&&(this._conn.authenticated=!1,this._conn.connected=!1,this._conn.restored=!1,this._conn._changeConnectStatus(z.Status.ATTACHFAIL))}_disconnect(e,t){t&&this._conn.send(t);const n=D("close",{xmlns:z.NS.FRAMING});this._conn.xmlOutput(n.tree());const r=z.serialize(n);this._conn.rawOutput(r),this.worker.port.postMessage(["send",r]),this._conn._doDisconnect()}_onClose(e){this._conn.connected&&!this._conn.disconnecting?(z.error("Websocket closed unexpectedly"),this._conn._doDisconnect()):e&&1006===e.code&&!this._conn.connected?(z.error("Websocket closed unexcectedly"),this._conn._changeConnectStatus(z.Status.CONNFAIL,"The WebSocket connection could not be established or was disconnected."),this._conn._doDisconnect()):z.debug("Websocket closed")}_closeSocket(){this.worker.port.postMessage(["_closeSocket"])}_replaceMessageHandler(){this._messageHandler=e=>this._onMessage(e)}_onWorkerMessage(e){const{data:t}=e,n=t[0];if("_onMessage"===n)this._messageHandler(t[1]);else if(n in this)try{this[n].apply(this,e.data.slice(1))}catch(e){z.log(z.LogLevel.ERROR,e)}else if("log"===n){const e=t[1],n=t[2];z.log(W[e],n)}else z.log(z.LogLevel.ERROR,"Found unhandled service worker message: "+t)}},r.$build=Y.$build,r.$iq=Y.$iq,r.$msg=Y.$msg,r.$pres=Y.$pres,r.Strophe=Y.Strophe,r.Strophe.shims=a,t.$build=D,t.$iq=k,t.$msg=L,t.$pres=U,t.Strophe=z,Object.defineProperty(t,"__esModule",{value:!0})})(t)}).call(this,n(12))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TextMessage=void 0;var r=n(4),i=n(0),o=n(15);t.TextMessage=function(e,t,n,s,a,c,u,l,d){void 0===s&&(s=void 0),void 0===a&&(a=void 0),void 0===c&&(c=void 0),void 0===u&&(u=void 0),void 0===l&&(l=void 0),void 0===d&&(d=void 0);var h="TextMessage";if(arguments.length<3||arguments.length>9)throw new i.VxError(i.VxError.CODE.ENUMPARAMS,h,"CORE");if("string"!=typeof e)throw new i.VxError(i.VxError.CODE.EPARAMTYPE,"message","string",h,"CORE");if("string"!=typeof t&&void 0!==t)throw new i.VxError(i.VxError.CODE.EPARAMTYPE,"subject","string or undefined",h,"CORE");if(!(n instanceof r.AccountId))throw new i.VxError(i.VxError.CODE.EPARAMTYPE,"sender","AccountId",h,"CORE");if(!(s instanceof o.Participant)&&void 0!==s)throw new i.VxError(i.VxError.CODE.EPARAMTYPE,"senderParticipant","Participant or undefined",h,"CORE");if("string"!=typeof a&&void 0!==a)throw new i.VxError(i.VxError.CODE.EPARAMTYPE,"senderRoomNickname","string or undefined",h,"CORE");if("number"!=typeof c&&void 0!==c)throw new i.VxError(i.VxError.CODE.EPARAMTYPE,"receivedTime","number or undefined",h,"CORE");if("string"!=typeof u&&void 0!==u)throw new i.VxError(i.VxError.CODE.EPARAMTYPE,"language","string or undefined",h,"CORE");if("string"!=typeof l&&void 0!==l)throw new i.VxError(i.VxError.CODE.EPARAMTYPE,"applicationStanzaNamespace","string or undefined",h,"CORE");if("string"!=typeof d&&void 0!==d)throw new i.VxError(i.VxError.CODE.EPARAMTYPE,"applicationStanzaBody","string or undefined",h,"CORE");this.message=e,this.subject=t,this.sender=n,this.senderParticipant=s,this.senderRoomNickname=a,this.receivedTime=c,this.language=u,this.applicationStanzaNamespace=l,this.applicationStanzaBody=d,Object.defineProperties(this,{message:{writable:!1,configurable:!1,enumerable:!0},subject:{writable:!1,configurable:!1,enumerable:!0},sender:{writable:!1,configurable:!1,enumerable:!0},senderParticipant:{writable:!1,configurable:!1,enumerable:!0},senderRoomNickname:{writable:!1,configurable:!1,enumerable:!0},receivedTime:{writable:!1,configurable:!1,enumerable:!0},language:{writable:!1,configurable:!1,enumerable:!0},applicationStanzaNamespace:{writable:!1,configurable:!1,enumerable:!0},applicationStanzaBody:{writable:!1,configurable:!1,enumerable:!0}})},t.TextMessage.prototype.toString=function(){var e="";return this.sender&&this.sender.toString&&"function"==typeof this.sender.toString&&(e+="sender: "+this.sender.toString()),this.message&&"string"==typeof this.message&&this.message.length>0&&(e&&(e+="; "),e+="message: "+this.message),e?"[object TextMessage("+e+")]":"[object TextMessage]"}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Participant=void 0;var r=n(1),i=n(4),o=n(0),s=n(7),a=function(){function e(e,t,n,a){if(r.Logger.trace(),4!=arguments.length)throw new o.VxError(o.VxError.CODE.ENUMPARAMS,"Participant()","CORE");if(!(e instanceof s.ChannelSession))throw new o.VxError(o.VxError.CODE.EPARAMTYPE,"parentChannelSession","ChannelSession","Participant()","CORE");if("string"!=typeof t)throw new o.VxError(o.VxError.CODE.EPARAMTYPE,"participantId","string","Participant()","CORE");if(!(n instanceof i.AccountId))throw new o.VxError(o.VxError.CODE.EPARAMTYPE,"account","AccountId","Participant()","CORE");if("boolean"!=typeof a)throw new o.VxError(o.VxError.CODE.EPARAMTYPE,"isSelf","boolean","Participant()","CORE");this.parentChannelSession=e,this.participantId=t,this.account=n,this.isSelf=a,this.roomNickname=void 0,this.affiliation=void 0,this.role=void 0,this.inAudio=void 0,this.inText=void 0,this.localMute=void 0,Object.defineProperties(this,{parentChannelSession:{writable:!1,configurable:!1,enumerable:!0},participantId:{writable:!1,configurable:!1,enumerable:!0},account:{writable:!1,configurable:!1,enumerable:!0},isSelf:{writable:!1,configurable:!1,enumerable:!0}})}return e.prototype.toString=function(){return"account"in this&&this.account instanceof i.AccountId?this.account.toString():"[object Participant(unidentified)]"},e}();t.Participant=a},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Token=void 0;var i=r(n(52)),o=r(n(55)),s=n(2);t.Token={accessTokenSerial:1,debugGenerateAccessToken:function(e,n,r,a,c,u,l){c&&"sip:"!=c.substr(0,4)&&(c="sip:"+c),u&&"sip:"!=u.substr(0,4)&&(u="sip:"+u),a&&"sip:"!=a.substr(0,4)&&(a="sip:"+a);var d=Math.floor(Date.now()/1e3)+n,h=t.Token.accessTokenSerial++,p="";p=a||u?a?'{"iss":"'+e+'","exp":'+d+',"vxa":"'+r+'","vxi":'+h+',"rtpe":"0","sub":"'+a+'","f":"'+c+'","t":"'+u+'"}':'{"iss":"'+e+'","exp":'+d+',"vxa":"'+r+'","vxi":'+h+',"rtpe":"0","f":"'+c+'","t":"'+u+'"}':'{"iss":"'+e+'","exp":'+d+',"vxa":"'+r+'","vxi":'+h+',"rtpe":"0","f":"'+c+'"}';var f=s.Tools.base64UrlEncode("{}"),g=s.Tools.base64UrlEncode(p),m=f+"."+g,b=(0,i.default)(m,l);return f+"."+g+"."+s.Tools.base64UrlEncode(b.toString(o.default))}}},function(e,t){var n,r,i=e.exports={};function o(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}function a(e){if(n===setTimeout)return setTimeout(e,0);if((n===o||!n)&&setTimeout)return n=setTimeout,setTimeout(e,0);try{return n(e,0)}catch(t){try{return n.call(null,e,0)}catch(t){return n.call(this,e,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:o}catch(e){n=o}try{r="function"==typeof clearTimeout?clearTimeout:s}catch(e){r=s}}();var c,u=[],l=!1,d=-1;function h(){l&&c&&(l=!1,c.length?u=c.concat(u):d=-1,u.length&&p())}function p(){if(!l){var e=a(h);l=!0;for(var t=u.length;t;){for(c=u,u=[];++d<t;)c&&c[d].run();d=-1,t=u.length}c=null,l=!1,function(e){if(r===clearTimeout)return clearTimeout(e);if((r===s||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(e);try{r(e)}catch(t){try{return r.call(null,e)}catch(t){return r.call(this,e)}}}(e)}}function f(e,t){this.fun=e,this.array=t}function g(){}i.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];u.push(new f(e,t)),1!==u.length||l||a(p)},f.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=g,i.addListener=g,i.once=g,i.off=g,i.removeListener=g,i.removeAllListeners=g,i.emit=g,i.prependListener=g,i.prependOnceListener=g,i.listeners=function(e){return[]},i.binding=function(e){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(e){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},function(e,t,n){var r=n(19),i=n(6),o=n(20).ArraySet,s=n(33).MappingList;function a(e){e||(e={}),this._file=i.getArg(e,"file",null),this._sourceRoot=i.getArg(e,"sourceRoot",null),this._skipValidation=i.getArg(e,"skipValidation",!1),this._sources=new o,this._names=new o,this._mappings=new s,this._sourcesContents=null}a.prototype._version=3,a.fromSourceMap=function(e){var t=e.sourceRoot,n=new a({file:e.file,sourceRoot:t});return e.eachMapping((function(e){var r={generated:{line:e.generatedLine,column:e.generatedColumn}};null!=e.source&&(r.source=e.source,null!=t&&(r.source=i.relative(t,r.source)),r.original={line:e.originalLine,column:e.originalColumn},null!=e.name&&(r.name=e.name)),n.addMapping(r)})),e.sources.forEach((function(r){var o=r;null!==t&&(o=i.relative(t,r)),n._sources.has(o)||n._sources.add(o);var s=e.sourceContentFor(r);null!=s&&n.setSourceContent(r,s)})),n},a.prototype.addMapping=function(e){var t=i.getArg(e,"generated"),n=i.getArg(e,"original",null),r=i.getArg(e,"source",null),o=i.getArg(e,"name",null);this._skipValidation||this._validateMapping(t,n,r,o),null!=r&&(r=String(r),this._sources.has(r)||this._sources.add(r)),null!=o&&(o=String(o),this._names.has(o)||this._names.add(o)),this._mappings.add({generatedLine:t.line,generatedColumn:t.column,originalLine:null!=n&&n.line,originalColumn:null!=n&&n.column,source:r,name:o})},a.prototype.setSourceContent=function(e,t){var n=e;null!=this._sourceRoot&&(n=i.relative(this._sourceRoot,n)),null!=t?(this._sourcesContents||(this._sourcesContents=Object.create(null)),this._sourcesContents[i.toSetString(n)]=t):this._sourcesContents&&(delete this._sourcesContents[i.toSetString(n)],0===Object.keys(this._sourcesContents).length&&(this._sourcesContents=null))},a.prototype.applySourceMap=function(e,t,n){var r=t;if(null==t){if(null==e.file)throw new Error('SourceMapGenerator.prototype.applySourceMap requires either an explicit source file, or the source map\'s "file" property. Both were omitted.');r=e.file}var s=this._sourceRoot;null!=s&&(r=i.relative(s,r));var a=new o,c=new o;this._mappings.unsortedForEach((function(t){if(t.source===r&&null!=t.originalLine){var o=e.originalPositionFor({line:t.originalLine,column:t.originalColumn});null!=o.source&&(t.source=o.source,null!=n&&(t.source=i.join(n,t.source)),null!=s&&(t.source=i.relative(s,t.source)),t.originalLine=o.line,t.originalColumn=o.column,null!=o.name&&(t.name=o.name))}var u=t.source;null==u||a.has(u)||a.add(u);var l=t.name;null==l||c.has(l)||c.add(l)}),this),this._sources=a,this._names=c,e.sources.forEach((function(t){var r=e.sourceContentFor(t);null!=r&&(null!=n&&(t=i.join(n,t)),null!=s&&(t=i.relative(s,t)),this.setSourceContent(t,r))}),this)},a.prototype._validateMapping=function(e,t,n,r){if(t&&"number"!=typeof t.line&&"number"!=typeof t.column)throw new Error("original.line and original.column are not numbers -- you probably meant to omit the original mapping entirely and only map the generated position. If so, pass null for the original mapping instead of an object with empty or null values.");if((!(e&&"line"in e&&"column"in e&&e.line>0&&e.column>=0)||t||n||r)&&!(e&&"line"in e&&"column"in e&&t&&"line"in t&&"column"in t&&e.line>0&&e.column>=0&&t.line>0&&t.column>=0&&n))throw new Error("Invalid mapping: "+JSON.stringify({generated:e,source:n,original:t,name:r}))},a.prototype._serializeMappings=function(){for(var e,t,n,o,s=0,a=1,c=0,u=0,l=0,d=0,h="",p=this._mappings.toArray(),f=0,g=p.length;f<g;f++){if(e="",(t=p[f]).generatedLine!==a)for(s=0;t.generatedLine!==a;)e+=";",a++;else if(f>0){if(!i.compareByGeneratedPositionsInflated(t,p[f-1]))continue;e+=","}e+=r.encode(t.generatedColumn-s),s=t.generatedColumn,null!=t.source&&(o=this._sources.indexOf(t.source),e+=r.encode(o-d),d=o,e+=r.encode(t.originalLine-1-u),u=t.originalLine-1,e+=r.encode(t.originalColumn-c),c=t.originalColumn,null!=t.name&&(n=this._names.indexOf(t.name),e+=r.encode(n-l),l=n)),h+=e}return h},a.prototype._generateSourcesContent=function(e,t){return e.map((function(e){if(!this._sourcesContents)return null;null!=t&&(e=i.relative(t,e));var n=i.toSetString(e);return Object.prototype.hasOwnProperty.call(this._sourcesContents,n)?this._sourcesContents[n]:null}),this)},a.prototype.toJSON=function(){var e={version:this._version,sources:this._sources.toArray(),names:this._names.toArray(),mappings:this._serializeMappings()};return null!=this._file&&(e.file=this._file),null!=this._sourceRoot&&(e.sourceRoot=this._sourceRoot),this._sourcesContents&&(e.sourcesContent=this._generateSourcesContent(e.sources,e.sourceRoot)),e},a.prototype.toString=function(){return JSON.stringify(this.toJSON())},t.SourceMapGenerator=a},function(e,t,n){var r=n(32);t.encode=function(e){var t,n="",i=function(e){return e<0?1+(-e<<1):0+(e<<1)}(e);do{t=31&i,(i>>>=5)>0&&(t|=32),n+=r.encode(t)}while(i>0);return n},t.decode=function(e,t,n){var i,o,s,a,c=e.length,u=0,l=0;do{if(t>=c)throw new Error("Expected more digits in base 64 VLQ value.");if(-1===(o=r.decode(e.charCodeAt(t++))))throw new Error("Invalid base64 digit: "+e.charAt(t-1));i=!!(32&o),u+=(o&=31)<<l,l+=5}while(i);n.value=(a=(s=u)>>1,1==(1&s)?-a:a),n.rest=t}},function(e,t,n){var r=n(6),i=Object.prototype.hasOwnProperty,o="undefined"!=typeof Map;function s(){this._array=[],this._set=o?new Map:Object.create(null)}s.fromArray=function(e,t){for(var n=new s,r=0,i=e.length;r<i;r++)n.add(e[r],t);return n},s.prototype.size=function(){return o?this._set.size:Object.getOwnPropertyNames(this._set).length},s.prototype.add=function(e,t){var n=o?e:r.toSetString(e),s=o?this.has(e):i.call(this._set,n),a=this._array.length;s&&!t||this._array.push(e),s||(o?this._set.set(e,a):this._set[n]=a)},s.prototype.has=function(e){if(o)return this._set.has(e);var t=r.toSetString(e);return i.call(this._set,t)},s.prototype.indexOf=function(e){if(o){var t=this._set.get(e);if(t>=0)return t}else{var n=r.toSetString(e);if(i.call(this._set,n))return this._set[n]}throw new Error('"'+e+'" is not in the set.')},s.prototype.at=function(e){if(e>=0&&e<this._array.length)return this._array[e];throw new Error("No element indexed by "+e)},s.prototype.toArray=function(){return this._array.slice()},t.ArraySet=s},function(e,t,n){var r=n(22);t.DOMImplementation=r.DOMImplementation,t.XMLSerializer=r.XMLSerializer,t.DOMParser=n(45).DOMParser},function(e,t,n){var r=n(8),i=r.find,o=r.NAMESPACE;function s(e){return""!==e}function a(e,t){return e.hasOwnProperty(t)||(e[t]=!0),e}function c(e){if(!e)return[];var t=function(e){return e?e.split(/[\t\n\f\r ]+/).filter(s):[]}(e);return Object.keys(t.reduce(a,{}))}function u(e,t){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])}function l(e,t){var n=e.prototype;if(!(n instanceof t)){function r(){}r.prototype=t.prototype,u(n,r=new r),e.prototype=n=r}n.constructor!=e&&("function"!=typeof e&&console.error("unknown Class:"+e),n.constructor=e)}var d={},h=d.ELEMENT_NODE=1,p=d.ATTRIBUTE_NODE=2,f=d.TEXT_NODE=3,g=d.CDATA_SECTION_NODE=4,m=d.ENTITY_REFERENCE_NODE=5,b=d.ENTITY_NODE=6,_=d.PROCESSING_INSTRUCTION_NODE=7,S=d.COMMENT_NODE=8,y=d.DOCUMENT_NODE=9,v=d.DOCUMENT_TYPE_NODE=10,E=d.DOCUMENT_FRAGMENT_NODE=11,C=d.NOTATION_NODE=12,T={},w={},A=(T.INDEX_SIZE_ERR=(w[1]="Index size error",1),T.DOMSTRING_SIZE_ERR=(w[2]="DOMString size error",2),T.HIERARCHY_REQUEST_ERR=(w[3]="Hierarchy request error",3)),P=(T.WRONG_DOCUMENT_ERR=(w[4]="Wrong document",4),T.INVALID_CHARACTER_ERR=(w[5]="Invalid character",5),T.NO_DATA_ALLOWED_ERR=(w[6]="No data allowed",6),T.NO_MODIFICATION_ALLOWED_ERR=(w[7]="No modification allowed",7),T.NOT_FOUND_ERR=(w[8]="Not found",8)),O=(T.NOT_SUPPORTED_ERR=(w[9]="Not supported",9),T.INUSE_ATTRIBUTE_ERR=(w[10]="Attribute in use",10));T.INVALID_STATE_ERR=(w[11]="Invalid state",11),T.SYNTAX_ERR=(w[12]="Syntax error",12),T.INVALID_MODIFICATION_ERR=(w[13]="Invalid modification",13),T.NAMESPACE_ERR=(w[14]="Invalid namespace",14),T.INVALID_ACCESS_ERR=(w[15]="Invalid access",15);function x(e,t){if(t instanceof Error)var n=t;else n=this,Error.call(this,w[e]),this.message=w[e],Error.captureStackTrace&&Error.captureStackTrace(this,x);return n.code=e,t&&(this.message=this.message+": "+t),n}function R(){}function I(e,t){this._node=e,this._refresh=t,N(this)}function N(e){var t=e._node._inc||e._node.ownerDocument._inc;if(e._inc!=t){var n=e._refresh(e._node);be(e,"length",n.length),u(n,e),e._inc=t}}function M(){}function D(e,t){for(var n=e.length;n--;)if(e[n]===t)return n}function L(e,t,n,r){if(r?t[D(t,r)]=n:t[t.length++]=n,e){n.ownerElement=e;var i=e.ownerDocument;i&&(r&&H(i,e,r),function(e,t,n){e&&e._inc++,n.namespaceURI===o.XMLNS&&(t._nsMap[n.prefix?n.localName:""]=n.value)}(i,e,n))}}function k(e,t,n){var r=D(t,n);if(!(r>=0))throw new x(P,new Error(e.tagName+"@"+n));for(var i=t.length-1;r<i;)t[r]=t[++r];if(t.length=i,e){var o=e.ownerDocument;o&&(H(o,e,n),n.ownerElement=null)}}function U(){}function V(){}function B(e){return("<"==e?"&lt;":">"==e&&"&gt;")||"&"==e&&"&amp;"||'"'==e&&"&quot;"||"&#"+e.charCodeAt()+";"}function j(e,t){if(t(e))return!0;if(e=e.firstChild)do{if(j(e,t))return!0}while(e=e.nextSibling)}function F(){this.ownerDocument=this}function H(e,t,n,r){e&&e._inc++,n.namespaceURI===o.XMLNS&&delete t._nsMap[n.prefix?n.localName:""]}function G(e,t,n){if(e&&e._inc){e._inc++;var r=t.childNodes;if(n)r[r.length++]=n;else{for(var i=t.firstChild,o=0;i;)r[o++]=i,i=i.nextSibling;r.length=o,delete r[r.length]}}}function q(e,t){var n=t.previousSibling,r=t.nextSibling;return n?n.nextSibling=r:e.firstChild=r,r?r.previousSibling=n:e.lastChild=n,t.parentNode=null,t.previousSibling=null,t.nextSibling=null,G(e.ownerDocument,e),t}function X(e){return e&&e.nodeType===V.DOCUMENT_TYPE_NODE}function z(e){return e&&e.nodeType===V.ELEMENT_NODE}function Y(e){return e&&e.nodeType===V.TEXT_NODE}function W(e,t){var n=e.childNodes||[];if(i(n,z)||X(t))return!1;var r=i(n,X);return!(t&&r&&n.indexOf(r)>n.indexOf(t))}function J(e,t){var n=e.childNodes||[];if(i(n,(function(e){return z(e)&&e!==t})))return!1;var r=i(n,X);return!(t&&r&&n.indexOf(r)>n.indexOf(t))}function $(e,t,n){if(!function(e){return e&&(e.nodeType===V.DOCUMENT_NODE||e.nodeType===V.DOCUMENT_FRAGMENT_NODE||e.nodeType===V.ELEMENT_NODE)}(e))throw new x(A,"Unexpected parent node type "+e.nodeType);if(n&&n.parentNode!==e)throw new x(P,"child not in parent");if(!function(e){return e&&(z(e)||Y(e)||X(e)||e.nodeType===V.DOCUMENT_FRAGMENT_NODE||e.nodeType===V.COMMENT_NODE||e.nodeType===V.PROCESSING_INSTRUCTION_NODE)}(t)||X(t)&&e.nodeType!==V.DOCUMENT_NODE)throw new x(A,"Unexpected node type "+t.nodeType+" for parent node type "+e.nodeType)}function K(e,t,n){var r=e.childNodes||[],o=t.childNodes||[];if(t.nodeType===V.DOCUMENT_FRAGMENT_NODE){var s=o.filter(z);if(s.length>1||i(o,Y))throw new x(A,"More than one element or text in fragment");if(1===s.length&&!W(e,n))throw new x(A,"Element in fragment can not be inserted before doctype")}if(z(t)&&!W(e,n))throw new x(A,"Only one element can be added and only after doctype");if(X(t)){if(i(r,X))throw new x(A,"Only one doctype is allowed");var a=i(r,z);if(n&&r.indexOf(a)<r.indexOf(n))throw new x(A,"Doctype can only be inserted before an element");if(!n&&a)throw new x(A,"Doctype can not be appended since element is present")}}function Q(e,t,n){var r=e.childNodes||[],o=t.childNodes||[];if(t.nodeType===V.DOCUMENT_FRAGMENT_NODE){var s=o.filter(z);if(s.length>1||i(o,Y))throw new x(A,"More than one element or text in fragment");if(1===s.length&&!J(e,n))throw new x(A,"Element in fragment can not be inserted before doctype")}if(z(t)&&!J(e,n))throw new x(A,"Only one element can be added and only after doctype");if(X(t)){if(i(r,(function(e){return X(e)&&e!==n})))throw new x(A,"Only one doctype is allowed");var a=i(r,z);if(n&&r.indexOf(a)<r.indexOf(n))throw new x(A,"Doctype can only be inserted before an element")}}function Z(e,t,n,r){$(e,t,n),e.nodeType===V.DOCUMENT_NODE&&(r||K)(e,t,n);var i=t.parentNode;if(i&&i.removeChild(t),t.nodeType===E){var o=t.firstChild;if(null==o)return t;var s=t.lastChild}else o=s=t;var a=n?n.previousSibling:e.lastChild;o.previousSibling=a,s.nextSibling=n,a?a.nextSibling=o:e.firstChild=o,null==n?e.lastChild=s:n.previousSibling=s;do{o.parentNode=e}while(o!==s&&(o=o.nextSibling));return G(e.ownerDocument||e,e),t.nodeType==E&&(t.firstChild=t.lastChild=null),t}function ee(){this._nsMap={}}function te(){}function ne(){}function re(){}function ie(){}function oe(){}function se(){}function ae(){}function ce(){}function ue(){}function le(){}function de(){}function he(){}function pe(e,t){var n=[],r=9==this.nodeType&&this.documentElement||this,i=r.prefix,o=r.namespaceURI;if(o&&null==i&&null==(i=r.lookupPrefix(o)))var s=[{namespace:o,prefix:null}];return me(this,n,e,t,s),n.join("")}function fe(e,t,n){var r=e.prefix||"",i=e.namespaceURI;if(!i)return!1;if("xml"===r&&i===o.XML||i===o.XMLNS)return!1;for(var s=n.length;s--;){var a=n[s];if(a.prefix===r)return a.namespace!==i}return!0}function ge(e,t,n){e.push(" ",t,'="',n.replace(/[<>&"\t\n\r]/g,B),'"')}function me(e,t,n,r,i){if(i||(i=[]),r){if(!(e=r(e)))return;if("string"==typeof e)return void t.push(e)}switch(e.nodeType){case h:var s=e.attributes,a=s.length,c=e.firstChild,u=e.tagName,l=u;if(!(n=o.isHTML(e.namespaceURI)||n)&&!e.prefix&&e.namespaceURI){for(var d,b=0;b<s.length;b++)if("xmlns"===s.item(b).name){d=s.item(b).value;break}if(!d)for(var C=i.length-1;C>=0;C--){if(""===(T=i[C]).prefix&&T.namespace===e.namespaceURI){d=T.namespace;break}}if(d!==e.namespaceURI)for(C=i.length-1;C>=0;C--){var T;if((T=i[C]).namespace===e.namespaceURI){T.prefix&&(l=T.prefix+":"+u);break}}}t.push("<",l);for(var w=0;w<a;w++){"xmlns"==(A=s.item(w)).prefix?i.push({prefix:A.localName,namespace:A.value}):"xmlns"==A.nodeName&&i.push({prefix:"",namespace:A.value})}for(w=0;w<a;w++){var A,P,O;if(fe(A=s.item(w),0,i))ge(t,(P=A.prefix||"")?"xmlns:"+P:"xmlns",O=A.namespaceURI),i.push({prefix:P,namespace:O});me(A,t,n,r,i)}if(u===l&&fe(e,0,i))ge(t,(P=e.prefix||"")?"xmlns:"+P:"xmlns",O=e.namespaceURI),i.push({prefix:P,namespace:O});if(c||n&&!/^(?:meta|link|img|br|hr|input)$/i.test(u)){if(t.push(">"),n&&/^script$/i.test(u))for(;c;)c.data?t.push(c.data):me(c,t,n,r,i.slice()),c=c.nextSibling;else for(;c;)me(c,t,n,r,i.slice()),c=c.nextSibling;t.push("</",l,">")}else t.push("/>");return;case y:case E:for(c=e.firstChild;c;)me(c,t,n,r,i.slice()),c=c.nextSibling;return;case p:return ge(t,e.name,e.value);case f:return t.push(e.data.replace(/[<&>]/g,B));case g:return t.push("<![CDATA[",e.data,"]]>");case S:return t.push("\x3c!--",e.data,"--\x3e");case v:var x=e.publicId,R=e.systemId;if(t.push("<!DOCTYPE ",e.name),x)t.push(" PUBLIC ",x),R&&"."!=R&&t.push(" ",R),t.push(">");else if(R&&"."!=R)t.push(" SYSTEM ",R,">");else{var I=e.internalSubset;I&&t.push(" [",I,"]"),t.push(">")}return;case _:return t.push("<?",e.target," ",e.data,"?>");case m:return t.push("&",e.nodeName,";");default:t.push("??",e.nodeName)}}function be(e,t,n){e[t]=n}x.prototype=Error.prototype,u(T,x),R.prototype={length:0,item:function(e){return this[e]||null},toString:function(e,t){for(var n=[],r=0;r<this.length;r++)me(this[r],n,e,t);return n.join("")},filter:function(e){return Array.prototype.filter.call(this,e)},indexOf:function(e){return Array.prototype.indexOf.call(this,e)}},I.prototype.item=function(e){return N(this),this[e]},l(I,R),M.prototype={length:0,item:R.prototype.item,getNamedItem:function(e){for(var t=this.length;t--;){var n=this[t];if(n.nodeName==e)return n}},setNamedItem:function(e){var t=e.ownerElement;if(t&&t!=this._ownerElement)throw new x(O);var n=this.getNamedItem(e.nodeName);return L(this._ownerElement,this,e,n),n},setNamedItemNS:function(e){var t,n=e.ownerElement;if(n&&n!=this._ownerElement)throw new x(O);return t=this.getNamedItemNS(e.namespaceURI,e.localName),L(this._ownerElement,this,e,t),t},removeNamedItem:function(e){var t=this.getNamedItem(e);return k(this._ownerElement,this,t),t},removeNamedItemNS:function(e,t){var n=this.getNamedItemNS(e,t);return k(this._ownerElement,this,n),n},getNamedItemNS:function(e,t){for(var n=this.length;n--;){var r=this[n];if(r.localName==t&&r.namespaceURI==e)return r}return null}},U.prototype={hasFeature:function(e,t){return!0},createDocument:function(e,t,n){var r=new F;if(r.implementation=this,r.childNodes=new R,r.doctype=n||null,n&&r.appendChild(n),t){var i=r.createElementNS(e,t);r.appendChild(i)}return r},createDocumentType:function(e,t,n){var r=new se;return r.name=e,r.nodeName=e,r.publicId=t||"",r.systemId=n||"",r}},V.prototype={firstChild:null,lastChild:null,previousSibling:null,nextSibling:null,attributes:null,parentNode:null,childNodes:null,ownerDocument:null,nodeValue:null,namespaceURI:null,prefix:null,localName:null,insertBefore:function(e,t){return Z(this,e,t)},replaceChild:function(e,t){Z(this,e,t,Q),t&&this.removeChild(t)},removeChild:function(e){return q(this,e)},appendChild:function(e){return this.insertBefore(e,null)},hasChildNodes:function(){return null!=this.firstChild},cloneNode:function(e){return function e(t,n,r){var i=new n.constructor;for(var o in n)if(Object.prototype.hasOwnProperty.call(n,o)){var s=n[o];"object"!=typeof s&&s!=i[o]&&(i[o]=s)}n.childNodes&&(i.childNodes=new R);switch(i.ownerDocument=t,i.nodeType){case h:var a=n.attributes,c=i.attributes=new M,u=a.length;c._ownerElement=i;for(var l=0;l<u;l++)i.setAttributeNode(e(t,a.item(l),!0));break;case p:r=!0}if(r)for(var d=n.firstChild;d;)i.appendChild(e(t,d,r)),d=d.nextSibling;return i}(this.ownerDocument||this,this,e)},normalize:function(){for(var e=this.firstChild;e;){var t=e.nextSibling;t&&t.nodeType==f&&e.nodeType==f?(this.removeChild(t),e.appendData(t.data)):(e.normalize(),e=t)}},isSupported:function(e,t){return this.ownerDocument.implementation.hasFeature(e,t)},hasAttributes:function(){return this.attributes.length>0},lookupPrefix:function(e){for(var t=this;t;){var n=t._nsMap;if(n)for(var r in n)if(Object.prototype.hasOwnProperty.call(n,r)&&n[r]===e)return r;t=t.nodeType==p?t.ownerDocument:t.parentNode}return null},lookupNamespaceURI:function(e){for(var t=this;t;){var n=t._nsMap;if(n&&Object.prototype.hasOwnProperty.call(n,e))return n[e];t=t.nodeType==p?t.ownerDocument:t.parentNode}return null},isDefaultNamespace:function(e){return null==this.lookupPrefix(e)}},u(d,V),u(d,V.prototype),F.prototype={nodeName:"#document",nodeType:y,doctype:null,documentElement:null,_inc:1,insertBefore:function(e,t){if(e.nodeType==E){for(var n=e.firstChild;n;){var r=n.nextSibling;this.insertBefore(n,t),n=r}return e}return Z(this,e,t),e.ownerDocument=this,null===this.documentElement&&e.nodeType===h&&(this.documentElement=e),e},removeChild:function(e){return this.documentElement==e&&(this.documentElement=null),q(this,e)},replaceChild:function(e,t){Z(this,e,t,Q),e.ownerDocument=this,t&&this.removeChild(t),z(e)&&(this.documentElement=e)},importNode:function(e,t){return function e(t,n,r){var i;switch(n.nodeType){case h:(i=n.cloneNode(!1)).ownerDocument=t;case E:break;case p:r=!0}i||(i=n.cloneNode(!1));if(i.ownerDocument=t,i.parentNode=null,r)for(var o=n.firstChild;o;)i.appendChild(e(t,o,r)),o=o.nextSibling;return i}(this,e,t)},getElementById:function(e){var t=null;return j(this.documentElement,(function(n){if(n.nodeType==h&&n.getAttribute("id")==e)return t=n,!0})),t},getElementsByClassName:function(e){var t=c(e);return new I(this,(function(n){var r=[];return t.length>0&&j(n.documentElement,(function(i){if(i!==n&&i.nodeType===h){var o=i.getAttribute("class");if(o){var s=e===o;if(!s){var a=c(o);s=t.every((u=a,function(e){return u&&-1!==u.indexOf(e)}))}s&&r.push(i)}}var u})),r}))},createElement:function(e){var t=new ee;return t.ownerDocument=this,t.nodeName=e,t.tagName=e,t.localName=e,t.childNodes=new R,(t.attributes=new M)._ownerElement=t,t},createDocumentFragment:function(){var e=new le;return e.ownerDocument=this,e.childNodes=new R,e},createTextNode:function(e){var t=new re;return t.ownerDocument=this,t.appendData(e),t},createComment:function(e){var t=new ie;return t.ownerDocument=this,t.appendData(e),t},createCDATASection:function(e){var t=new oe;return t.ownerDocument=this,t.appendData(e),t},createProcessingInstruction:function(e,t){var n=new de;return n.ownerDocument=this,n.tagName=n.target=e,n.nodeValue=n.data=t,n},createAttribute:function(e){var t=new te;return t.ownerDocument=this,t.name=e,t.nodeName=e,t.localName=e,t.specified=!0,t},createEntityReference:function(e){var t=new ue;return t.ownerDocument=this,t.nodeName=e,t},createElementNS:function(e,t){var n=new ee,r=t.split(":"),i=n.attributes=new M;return n.childNodes=new R,n.ownerDocument=this,n.nodeName=t,n.tagName=t,n.namespaceURI=e,2==r.length?(n.prefix=r[0],n.localName=r[1]):n.localName=t,i._ownerElement=n,n},createAttributeNS:function(e,t){var n=new te,r=t.split(":");return n.ownerDocument=this,n.nodeName=t,n.name=t,n.namespaceURI=e,n.specified=!0,2==r.length?(n.prefix=r[0],n.localName=r[1]):n.localName=t,n}},l(F,V),ee.prototype={nodeType:h,hasAttribute:function(e){return null!=this.getAttributeNode(e)},getAttribute:function(e){var t=this.getAttributeNode(e);return t&&t.value||""},getAttributeNode:function(e){return this.attributes.getNamedItem(e)},setAttribute:function(e,t){var n=this.ownerDocument.createAttribute(e);n.value=n.nodeValue=""+t,this.setAttributeNode(n)},removeAttribute:function(e){var t=this.getAttributeNode(e);t&&this.removeAttributeNode(t)},appendChild:function(e){return e.nodeType===E?this.insertBefore(e,null):function(e,t){return t.parentNode&&t.parentNode.removeChild(t),t.parentNode=e,t.previousSibling=e.lastChild,t.nextSibling=null,t.previousSibling?t.previousSibling.nextSibling=t:e.firstChild=t,e.lastChild=t,G(e.ownerDocument,e,t),t}(this,e)},setAttributeNode:function(e){return this.attributes.setNamedItem(e)},setAttributeNodeNS:function(e){return this.attributes.setNamedItemNS(e)},removeAttributeNode:function(e){return this.attributes.removeNamedItem(e.nodeName)},removeAttributeNS:function(e,t){var n=this.getAttributeNodeNS(e,t);n&&this.removeAttributeNode(n)},hasAttributeNS:function(e,t){return null!=this.getAttributeNodeNS(e,t)},getAttributeNS:function(e,t){var n=this.getAttributeNodeNS(e,t);return n&&n.value||""},setAttributeNS:function(e,t,n){var r=this.ownerDocument.createAttributeNS(e,t);r.value=r.nodeValue=""+n,this.setAttributeNode(r)},getAttributeNodeNS:function(e,t){return this.attributes.getNamedItemNS(e,t)},getElementsByTagName:function(e){return new I(this,(function(t){var n=[];return j(t,(function(r){r===t||r.nodeType!=h||"*"!==e&&r.tagName!=e||n.push(r)})),n}))},getElementsByTagNameNS:function(e,t){return new I(this,(function(n){var r=[];return j(n,(function(i){i===n||i.nodeType!==h||"*"!==e&&i.namespaceURI!==e||"*"!==t&&i.localName!=t||r.push(i)})),r}))}},F.prototype.getElementsByTagName=ee.prototype.getElementsByTagName,F.prototype.getElementsByTagNameNS=ee.prototype.getElementsByTagNameNS,l(ee,V),te.prototype.nodeType=p,l(te,V),ne.prototype={data:"",substringData:function(e,t){return this.data.substring(e,e+t)},appendData:function(e){e=this.data+e,this.nodeValue=this.data=e,this.length=e.length},insertData:function(e,t){this.replaceData(e,0,t)},appendChild:function(e){throw new Error(w[A])},deleteData:function(e,t){this.replaceData(e,t,"")},replaceData:function(e,t,n){n=this.data.substring(0,e)+n+this.data.substring(e+t),this.nodeValue=this.data=n,this.length=n.length}},l(ne,V),re.prototype={nodeName:"#text",nodeType:f,splitText:function(e){var t=this.data,n=t.substring(e);t=t.substring(0,e),this.data=this.nodeValue=t,this.length=t.length;var r=this.ownerDocument.createTextNode(n);return this.parentNode&&this.parentNode.insertBefore(r,this.nextSibling),r}},l(re,ne),ie.prototype={nodeName:"#comment",nodeType:S},l(ie,ne),oe.prototype={nodeName:"#cdata-section",nodeType:g},l(oe,ne),se.prototype.nodeType=v,l(se,V),ae.prototype.nodeType=C,l(ae,V),ce.prototype.nodeType=b,l(ce,V),ue.prototype.nodeType=m,l(ue,V),le.prototype.nodeName="#document-fragment",le.prototype.nodeType=E,l(le,V),de.prototype.nodeType=_,l(de,V),he.prototype.serializeToString=function(e,t,n){return pe.call(e,t,n)},V.prototype.toString=pe;try{if(Object.defineProperty){Object.defineProperty(I.prototype,"length",{get:function(){return N(this),this.$$length}}),Object.defineProperty(V.prototype,"textContent",{get:function(){return function e(t){switch(t.nodeType){case h:case E:var n=[];for(t=t.firstChild;t;)7!==t.nodeType&&8!==t.nodeType&&n.push(e(t)),t=t.nextSibling;return n.join("");default:return t.nodeValue}}(this)},set:function(e){switch(this.nodeType){case h:case E:for(;this.firstChild;)this.removeChild(this.firstChild);(e||String(e))&&this.appendChild(this.ownerDocument.createTextNode(e));break;default:this.data=e,this.value=e,this.nodeValue=e}}}),be=function(e,t,n){e["$$"+t]=n}}}catch(e){}t.DocumentType=se,t.DOMException=x,t.DOMImplementation=U,t.Element=ee,t.Node=V,t.NodeList=R,t.XMLSerializer=he},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Client=void 0;var r=n(9),i=n(1),o=n(4),s=n(0),a=n(10),c=n(2),u=n(51),l=t.Client=function(){function e(){throw new Error("Client.object is static: the application must not create its instances.")}return e.initialize=function(){if(i.Logger.trace(),0!=arguments.length)throw new s.VxError(s.VxError.CODE.ENUMPARAMS,"Client.initialize()",e.logSubsystemId);return!e.isInitialized&&(i.Logger.log(e.logSubsystemId,"Initialized Vivox5 version "+e.internalVersion),e.isInitialized=!0)},e.uninitialize=function(){if(i.Logger.trace(),0!=arguments.length)throw new s.VxError(s.VxError.CODE.ENUMPARAMS,"Client.uninitialize()",e.logSubsystemId);if(!e.isInitialized)return!1;for(var t in e.loginSessions){var n=e.loginSessions[t];delete e.loginSessions[t],n.logout(),n=void 0}return e.isInitialized=!1,!0},e.getRandomUserName=function(t){if(void 0===t&&(t="wrtc_"),i.Logger.trace(),arguments.length>1)throw new s.VxError(s.VxError.CODE.ENUMPARAMS,"Client.getRandomUserName()",e.logSubsystemId);if("string"!=typeof t&&void 0!==t)throw new s.VxError(s.VxError.CODE.EPARAMTYPE,"prefix","string","Client.getRandomUserName()",e.logSubsystemId);c.Tools.isValidUserName(t)||(t="");var n=t+c.Tools.createUniqueId();return n},e.getRandomAccountId=function(t,n,r,a){if(void 0===a&&(a="wrtc_"),i.Logger.trace(),arguments.length<3||arguments.length>4)throw new s.VxError(s.VxError.CODE.ENUMPARAMS,"Client.getRandomAccountId()",e.logSubsystemId);c.Tools.validateIssuerName(t,"Client.getRandomAccountId()",e.logSubsystemId),n=c.Tools.validateAndFormatDomainName(n,"Client.getRandomAccountId()",e.logSubsystemId),c.Tools.validateEnvironmentId(r,"Client.getRandomAccountId()",e.logSubsystemId);var u=e.getRandomUserName(a);return new o.AccountId(t,u,n,r)},e.getRandomChannelName=function(){if(i.Logger.trace(),0!=arguments.length)throw new s.VxError(s.VxError.CODE.ENUMPARAMS,"Client.getRandomChannelName()",e.logSubsystemId);return c.Tools.createUniqueId()},e.getRandomChannelId=function(t,n,o,a){if(i.Logger.trace(),arguments.length<3)throw new s.VxError(s.VxError.CODE.ENUMPARAMS,"Client.getRandomChannelId()",e.logSubsystemId);c.Tools.validateIssuerName(t,"Client.getRandomChannelId()",e.logSubsystemId),n=c.Tools.validateAndFormatDomainName(n,"Client.getRandomChannelId()",e.logSubsystemId),c.Tools.validateEnvironmentId(a,"Client.getRandomChannelId()",e.logSubsystemId),c.Tools.validateChannelType(o,"Client.getRandomChannelId()",e.logSubsystemId);var u=e.getRandomChannelName();return new r.ChannelId(t,u,n,o,a)},e.getLoginSession=function(t,n,r){if(void 0===n&&(n=!0),void 0===r&&(r=void 0),i.Logger.trace(),!e.isInitialized)throw new s.VxError(s.VxError.CODE.ESTATE,"not initialized","Client.getLoginSession()",e.logSubsystemId);if(arguments.length<1||arguments.length>3)throw new s.VxError(s.VxError.CODE.ENUMPARAMS,"Client.getLoginSession()",e.logSubsystemId);if(!(t instanceof o.AccountId))throw new s.VxError(s.VxError.CODE.EPARAMTYPE,"loginSessionId","AccountId","Client.getLoginSession()",e.logSubsystemId);if(t.isEmpty())throw new s.VxError(s.VxError.CODE.EPARAMVALUE,"loginSessionId","Client.getLoginSession()",e.logSubsystemId);if("boolean"!=typeof n)throw new s.VxError(s.VxError.CODE.EPARAMTYPE,"forceSecurePreloginURI","boolean","Client.getLoginSession()",e.logSubsystemId);if(void 0!==r&&"string"!=typeof r)throw new s.VxError(s.VxError.CODE.EPARAMTYPE,"uriWsXmpp","string or undefined","Client.getLoginSession()",e.logSubsystemId);if(void 0!==r&&!c.Tools.isValidWsUri(r))throw new s.VxError(s.VxError.CODE.EPARAMVALUE,"uriWsXmpp","Client.getLoginSession()",e.logSubsystemId);var u=t.toString();if(u in e.loginSessions)return e.loginSessions[u];var l=new a.LoginSession(t,n,r);return e.loginSessions[u]=l,l},e.deleteLoginSession=function(t){if(i.Logger.trace(),1!=arguments.length)throw new s.VxError(s.VxError.CODE.ENUMPARAMS,"Client.deleteLoginSession()",e.logSubsystemId);if(!(t instanceof a.LoginSession||t instanceof o.AccountId))throw new s.VxError(s.VxError.CODE.EPARAMTYPE,"loginSessionOrId","LoginSession or AccountId","Client.deleteLoginSession()",e.logSubsystemId);var n=null;if(!(n=t instanceof o.AccountId?t:"loginSessionId"in(t=t)?t.loginSessionId.toString():"")||!(n in e.loginSessions))return!1;var r=e.loginSessions[n];return delete e.loginSessions[n],r.state==a.LoginSession.LOGINSTATE.PRELOGIN||r.state==a.LoginSession.LOGINSTATE.LOGGING_IN||r.state==a.LoginSession.LOGINSTATE.LOGGED_IN?r.logout():r.state!=a.LoginSession.LOGINSTATE.LOGGED_OUT&&r.state!=a.LoginSession.LOGINSTATE.FINISHED||r.close(),!0},e.toString=function(){return"[object Client]"},e.onLoginSessionDisconnectedInternal=function(t){i.Logger.trace();var n=t.loginSessionId.toString();t.close(),n in e.loginSessions&&delete e.loginSessions[n]},e.internalVersion="5.25.0.".concat(u.BUILD_DATE),e.isInitialized=!1,e.loginSessions=new Map,e.logSubsystemId="CLIENT",e}();Object.defineProperties(l,{internalVersion:{writable:!1,configurable:!1,enumerable:!0},isInitialized:{writable:!0,configurable:!1,enumerable:!0},loginSessions:{writable:!1,configurable:!1,enumerable:!0},logSubsystemId:{writable:!1,configurable:!1,enumerable:!0},initialize:{writable:!1,configurable:!1,enumerable:!0},uninitialize:{writable:!1,configurable:!1,enumerable:!0},getRandomUserName:{writable:!1,configurable:!1,enumerable:!0},getRandomAccountId:{writable:!1,configurable:!1,enumerable:!0},getRandomChannelName:{writable:!1,configurable:!1,enumerable:!0},getRandomChannelId:{writable:!1,configurable:!1,enumerable:!0},getLoginSession:{writable:!1,configurable:!1,enumerable:!0},deleteLoginSession:{writable:!1,configurable:!1,enumerable:!0},toString:{writable:!1,configurable:!1,enumerable:!0},onLoginSessionDisconnectedInternal:{writable:!1,configurable:!1,enumerable:!1}})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PresenceSubscription=t.PresenceSubState=void 0;var r,i=n(13),o=n(1),s=n(4),a=n(0),c=n(10),u=n(11),l=n(25),d=n(2);!function(e){e[e.NONE=0]="NONE",e[e.SUBSCRIBING=1]="SUBSCRIBING",e[e.SUBSCRIBED=2]="SUBSCRIBED"}(r=t.PresenceSubState||(t.PresenceSubState={}));var h=t.PresenceSubscription=function(){function e(e,t,n){void 0===n&&(n=r.NONE);var h=this;if(this.internalId=d.Tools.generateInternalId(),this._className="PresenceSubscription",this.removePresenceSubscriptionHandlers=function(){o.Logger.trace(),h._handOnSubscribed&&(h._stropheConnection.deleteHandler(h._handOnSubscribed),h._handOnSubscribed=void 0),h._handOnUnsubscribed&&(h._stropheConnection.deleteHandler(h._handOnUnsubscribed),h._handOnUnsubscribed=void 0),h._handOnPresence&&(h._stropheConnection.deleteHandler(h._handOnPresence),h._handOnPresence=void 0)},this.onPresSubscribed=function(e){return o.Logger.trace(),h._substate=r.SUBSCRIBED,h.log("Subscribed to buddy "+h._jidBuddy),h.onSubscribed&&"function"==typeof h.onSubscribed&&h.onSubscribed(h),!0},this.onPresUnsubscribed=function(e){return o.Logger.trace(),h.removePresenceSubscriptionHandlers(),h.log("Unsubscribed from buddy "+h._jidBuddy),h.afterUnsubscribed(),!1},this.onPresence=function(e){if(e.hasAttribute("type")&&"unavailable"!=e.getAttribute("type"))return!0;o.Logger.trace(),h.substate==r.SUBSCRIBING&&(h._substate=r.SUBSCRIBED,h.log("Subscription state of "+h._jidBuddy+" unexpectedly changed from SUBSCRIBING to SUBSCRIBED due to presence arrival"));var t=u.Presence.STATUS.AVAILABLE;if(e.hasAttribute("type")&&"unavailable"==e.getAttribute("type"))t=u.Presence.STATUS.UNAVAILABLE;else{var n=null,s=e.getElementsByTagName("show");switch(s&&s[0]&&s[0].childNodes.length>=1&&3==s[0].childNodes[0].nodeType&&(n=s[0].childNodes[0].nodeValue),n){case"chat":t=u.Presence.STATUS.CHAT;break;case"dnd":t=u.Presence.STATUS.DONOTDISTURB;break;case"away":t=u.Presence.STATUS.AWAY;break;case"xa":t=u.Presence.STATUS.EXTENDEDAWAY;break;default:t=u.Presence.STATUS.AVAILABLE}}var a=void 0,c=e.getElementsByTagName("status");c&&c[0]&&c[0].childNodes.length>=1&&3==c[0].childNodes[0].nodeType&&(a=c[0].childNodes[0].nodeValue);var l=e.getAttribute("from"),d=i.Strophe.getResourceFromJid(l);return h._locations[d]=new u.Presence(t,a),h.log("Presence for buddy "+h._jidBuddy+" (resource "+d+") updated to "+h._locations[d]),h.onBuddyPresence&&"function"==typeof h.onBuddyPresence&&h.onBuddyPresence(h),!0},o.Logger.trace(),Object.defineProperty(this,"internalId",{writable:!1,configurable:!1,enumerable:!1}),this._logSubsystemId="PS-"+(e instanceof c.LoginSession&&"internalId"in e?e.internalId:"?")+"-"+this.internalId,arguments.length<2||arguments.length>3)throw new a.VxError(a.VxError.CODE.ENUMPARAMS,this._className,this._logSubsystemId);if(!(e instanceof c.LoginSession))throw new a.VxError(a.VxError.CODE.EPARAMTYPE,"loginSession","LoginSession",this._className,this._logSubsystemId);if(!(t instanceof s.AccountId))throw new a.VxError(a.VxError.CODE.EPARAMTYPE,"subscribedAccount","AccountId",this._className,this._logSubsystemId);if(t.isEmpty())throw new a.VxError(a.VxError.CODE.EPARAMVALUE,"subscribedAccount",this._className,this._logSubsystemId);if("number"!=typeof n)throw new a.VxError(a.VxError.CODE.EPARAMTYPE,"initialState","number",this._className,this._logSubsystemId);this._loginSession=e,this.subscribedAccount=t,this._substate=n,this._locations=new l.PresenceLocations,this._jidBuddy=t.toString(),this._stropheConnection=e.stropheConnection,this.addPresenceSubscriptionHandlers(),this._self=this}return Object.defineProperty(e.prototype,"loginSession",{get:function(){return this._loginSession},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"substate",{get:function(){return this._substate},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"locations",{get:function(){return this._locations},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onSubscribed",{get:function(){return this._cbOnSubscribed},set:function(e){this.validateCB(e,"onSubscribed"),this._cbOnSubscribed=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onUnsubscribed",{get:function(){return this._cbOnUnsubscribed},set:function(e){this.validateCB(e,"onUnsubscribed"),this._cbOnUnsubscribed=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onBuddyPresence",{get:function(){return this._cbOnBuddyPresence},set:function(e){this.validateCB(e,"onBuddyPresence"),this._cbOnBuddyPresence=e},enumerable:!1,configurable:!0}),e.prototype.subscribe=function(e){void 0===e&&(e=!1);var t="PresenceSubscription.subscribe()";if(o.Logger.trace(),arguments.length>1)throw new a.VxError(a.VxError.CODE.ENUMPARAMS,t,this._logSubsystemId);if("boolean"!=typeof e&&void 0!==e)throw new a.VxError(a.VxError.CODE.EPARAMTYPE,"forceSubscribe","boolean or undefined",t,this._logSubsystemId);if((this.substate==r.SUBSCRIBING||this.substate==r.SUBSCRIBED)&&!e)return!0;this.log("Subscribing to buddy "+this._jidBuddy);var n=(0,i.$pres)({to:this._jidBuddy,type:"subscribe",id:d.Tools.makeUuid()});return this._stropheConnection.send(n.tree()),this._substate=r.SUBSCRIBING,!0},e.prototype.unsubscribe=function(){var e="PresenceSubscription.unsubscribe()";if(o.Logger.trace(),0!=arguments.length)throw new a.VxError(a.VxError.CODE.ENUMPARAMS,e,this._logSubsystemId);if(this.substate==r.NONE)return!0;this.removePresenceSubscriptionHandlers(),this.log("Unsubscribing from buddy "+this._jidBuddy);var t=(0,i.$pres)({to:this._jidBuddy,type:"unsubscribe",id:d.Tools.makeUuid()});this._stropheConnection.send(t.tree());var n=(0,i.$pres)({to:this._jidBuddy,type:"unsubscribed",id:d.Tools.makeUuid()});this._stropheConnection.send(n.tree());var s=(0,i.$iq)({type:"set",id:d.Tools.makeUuid()}).c("query",{xmlns:i.Strophe.NS.ROSTER}).c("item",{jid:this._jidBuddy,subscription:"remove"});return this._stropheConnection.send(s.tree()),this.afterUnsubscribed(),!0},e.prototype.remove=function(){var e="PresenceSubscription.remove()";if(o.Logger.trace(),0!=arguments.length)throw new a.VxError(a.VxError.CODE.ENUMPARAMS,e,this._logSubsystemId);return this.substate==r.NONE||(this.removePresenceSubscriptionHandlers(),this.log("Removed subscription to buddy "+this._jidBuddy),this.afterUnsubscribed()),!0},e.prototype.close=function(){o.Logger.trace(),this._self&&(this.releaseSubscriptionResources(),delete this._self.presence,this._self=void 0)},e.prototype.toString=function(){return"[object PresenceSubscription("+this._loginSession.loginSessionId.toString()+" -> "+this.subscribedAccount.toString()+")]"},e.prototype.log=function(e){o.Logger.log(this._logSubsystemId,e)},e.prototype.validateCB=function(e,t){if("function"!=typeof e&&void 0!==e)throw new a.VxError(a.VxError.CODE.EPROPTYPE,t,"function",this._className,this._logSubsystemId)},e.prototype.addPresenceSubscriptionHandlers=function(){o.Logger.trace(),this._handOnSubscribed=this._stropheConnection.addHandler(this.onPresSubscribed,null,"presence","subscribed",null,this._jidBuddy,{matchBareFromJid:!0}),this._handOnUnsubscribed=this._stropheConnection.addHandler(this.onPresUnsubscribed,null,"presence","unsubscribed",null,this._jidBuddy,{matchBareFromJid:!0}),this._handOnPresence=this._stropheConnection.addHandler(this.onPresence,null,"presence",null,null,this._jidBuddy,{matchBareFromJid:!0})},e.prototype.afterUnsubscribed=function(){o.Logger.trace(),this._substate=r.NONE,d.Tools.clearObject(this._locations),this.onUnsubscribed&&"function"==typeof this.onUnsubscribed&&this.onUnsubscribed(this)},e.prototype.releaseSubscriptionResources=function(){o.Logger.trace(),d.Tools.clearObject(this._locations),this._locations=void 0,this._cbOnSubscribed=void 0,this._cbOnUnsubscribed=void 0,this._cbOnBuddyPresence=void 0,this.removePresenceSubscriptionHandlers(),this._stropheConnection=void 0},e.SUBSTATE=r,e}();Object.defineProperties(h,{subscribe:{writable:!1,configurable:!1,enumerable:!0},unsubscribe:{writable:!1,configurable:!1,enumerable:!0},remove:{writable:!1,configurable:!1,enumerable:!1},close:{writable:!1,configurable:!1,enumerable:!1},toString:{writable:!1,configurable:!1,enumerable:!0}}),Object.defineProperty(h,"SUBSTATE",{writable:!1,configurable:!1,enumerable:!0})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PresenceLocations=void 0;var r=n(11),i=function(){function e(){}return Object.defineProperty(e.prototype,"defaultLocation",{get:function(){var e=void 0;for(var t in this)this.hasOwnProperty(t)&&(e?r.Presence.STATUS.RANK[this[t].status.value]>r.Presence.STATUS.RANK[this[e].status]&&(e=t):e=t);return e?this[e]:void 0},enumerable:!1,configurable:!0}),e.prototype.toString=function(){return"[object PresenceLocations]"},e}();t.PresenceLocations=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Xml=void 0,t.Xml={xmlParserLoggingDebug:!1,xmlParserLoggingVxErrors:!0,xmlParser:void 0,xmlSerializer:void 0,parseXml:function(e){t.Xml.xmlParser||(t.Xml.xmlParser=new DOMParser);try{var n=t.Xml.xmlParser.parseFromString(e,"application/xml");return n.getElementsByTagName("parsererror").length>0?(t.Xml.xmlParserLoggingVxErrors&&console.log("[ERRR] VxError in XML parsing: "+t.Xml.xmlToString(n)),null):n}catch(e){return t.Xml.xmlParserLoggingVxErrors&&console.log("[ERRR] VxError in XML parsing: "+e),null}},xmlToObj:function(e){var n=void 0;return 9==e.nodeType?(t.Xml.xmlParserLoggingDebug&&console.log("ROOT node is normal XML Document",e.nodeName),n=t.Xml.xmlNodeToObj(e)):1==e.nodeType?(t.Xml.xmlParserLoggingDebug&&console.log('Processing ROOT node "%s"',e.nodeName),n[e.nodeName]=t.Xml.xmlNodeToObj(e)):(t.Xml.xmlParserLoggingDebug&&console.log("ROOT node is not XML element"),n=t.Xml.xmlNodeToObj(e)),n},xmlNodeToObj:function(e){var n={};if(1==e.nodeType){if(t.Xml.xmlParserLoggingDebug&&console.log('This is element node "%s"',e.nodeName),e.attributes.length>0){n._attrs={};for(var r=0;r<e.attributes.length;r++){var i=e.attributes.item(r);n._attrs[i.nodeName]=i.nodeValue}}}else 3==e.nodeType&&(t.Xml.xmlParserLoggingDebug&&console.log('This is text node "%s"',e.nodeValue),n=e.nodeValue);if(e.hasChildNodes())for(r=0;r<e.childNodes.length;r++){var o=e.childNodes.item(r),s=o.nodeName;if(t.Xml.xmlParserLoggingDebug&&console.log('Processing child node "%s"',s),0==r&&3==o.nodeType&&1==e.childNodes.length){var a=n._attrs;(n=new String(o.nodeValue))._attrs=a;break}if(void 0===n[s])n[s]=t.Xml.xmlNodeToObj(o);else{if(void 0===n[s].push){var c=n[s];n[s]=[],n[s].push(c)}n[s].push(t.Xml.xmlNodeToObj(o))}}return n},objToXml:function(e){var n=new Document;return t.Xml.objToXmlNode(n,n,e),n},objToXmlNode:function(e,n,r){for(var i in r)if("_attrs"!=i){var o=e.createElement(i);if(t.Xml.xmlParserLoggingDebug&&console.log("Created node "+i),n.appendChild(o),void 0!==r[i]._attrs)for(var s in r[i]._attrs)o.setAttribute(s,r[i]._attrs[s]);if("string"==typeof r[i]||r[i]instanceof String||"number"==typeof r[i]||"boolean"==typeof r[i]){if(""!==r[i]){var a=e.createTextNode(r[i]);o.appendChild(a)}}else"object"==typeof r[i]&&t.Xml.objToXmlNode(e,o,r[i])}},xmlToString:function(e){return void 0===t.Xml.xmlSerializer&&("undefined"!=typeof XMLSerializer?t.Xml.xmlSerializer=new XMLSerializer:t.Xml.xmlSerializer=null),t.Xml.xmlSerializer?t.Xml.xmlSerializer.serializeToString(e):e.xml?e.xml:null}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Xmpp=void 0,t.Xmpp={NS:{URN_XMPP_BLOCKING:"urn:xmpp:blocking",URN_VIVOX_PRESENCE:"urn:vivox:presence",URN_VIVOX_MUC:"urn:vivox:muc"},DEFAULT_TRANSACTION_TIMEOUT:1e4,isXmppVxError:function(e){if(e.hasAttribute("type")&&"error"==e.getAttribute("type"))return!0;var t=e.getElementsByTagName("error");return t&&t.length>0}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.VxError=t.Tools=t.Token=t.TextMessage=t.PresenceSubscription=t.PresenceStatus=t.PresenceLocations=t.Presence=t.Participant=t.LoginSession=t.Logger=t.Client=t.ChannelSession=t.ChannelId=t.AccountId=t.Vivox5=void 0,n(56);var r=n(4);Object.defineProperty(t,"AccountId",{enumerable:!0,get:function(){return r.AccountId}});var i=n(9);Object.defineProperty(t,"ChannelId",{enumerable:!0,get:function(){return i.ChannelId}});var o=n(7);Object.defineProperty(t,"ChannelSession",{enumerable:!0,get:function(){return o.ChannelSession}});var s=n(23);Object.defineProperty(t,"Client",{enumerable:!0,get:function(){return s.Client}});var a=n(1);Object.defineProperty(t,"Logger",{enumerable:!0,get:function(){return a.Logger}});var c=n(10);Object.defineProperty(t,"LoginSession",{enumerable:!0,get:function(){return c.LoginSession}});var u=n(15);Object.defineProperty(t,"Participant",{enumerable:!0,get:function(){return u.Participant}});var l=n(11);Object.defineProperty(t,"Presence",{enumerable:!0,get:function(){return l.Presence}}),Object.defineProperty(t,"PresenceStatus",{enumerable:!0,get:function(){return l.PresenceStatus}});var d=n(25);Object.defineProperty(t,"PresenceLocations",{enumerable:!0,get:function(){return d.PresenceLocations}});var h=n(24);Object.defineProperty(t,"PresenceSubscription",{enumerable:!0,get:function(){return h.PresenceSubscription}});var p=n(14);Object.defineProperty(t,"TextMessage",{enumerable:!0,get:function(){return p.TextMessage}});var f=n(16);Object.defineProperty(t,"Token",{enumerable:!0,get:function(){return f.Token}});var g=n(2);Object.defineProperty(t,"Tools",{enumerable:!0,get:function(){return g.Tools}});var m=n(0);Object.defineProperty(t,"VxError",{enumerable:!0,get:function(){return m.VxError}});var b=t.Vivox5=function(){function e(){}return Object.defineProperty(e,"loggerInfo",{set:function(e){a.Logger.loggerInfo=e},enumerable:!1,configurable:!0}),Object.defineProperty(e,"loggerTraf",{set:function(e){a.Logger.loggerTraf=e},enumerable:!1,configurable:!0}),e.AccountId=r.AccountId,e.ChannelId=i.ChannelId,e.ChannelSession=o.ChannelSession,e.Client=s.Client,e.Error=m.VxError,e.LoginSession=c.LoginSession,e.Participant=u.Participant,e.Presence=l.Presence,e.PresenceLocations=d.PresenceLocations,e.PresenceSubscription=h.PresenceSubscription,e.TextMessage=p.TextMessage,e.Tools=g.Tools,e.Token=f.Token,e.log=a.Logger.log,e.logTraffic=a.Logger.logTraffic,e.logXmppError=a.Logger.logTraffic,e.trace=a.Logger.trace,e}();Object.defineProperties(b,{Tools:{writable:!1,configurable:!1,enumerable:!0},Xml:{writable:!1,configurable:!1,enumerable:!1},Xmpp:{writable:!1,configurable:!1,enumerable:!1},Token:{writable:!1,configurable:!1,enumerable:!1},log:{writable:!1,configurable:!1,enumerable:!0},logTraffic:{writable:!1,configurable:!1,enumerable:!1},logXmppError:{writable:!1,configurable:!1,enumerable:!1},trace:{writable:!1,configurable:!1,enumerable:!0}}),Object.defineProperty(b,"Error",{writable:!1,configurable:!1,enumerable:!0}),Object.defineProperty(b,"AccountId",{writable:!1,configurable:!1,enumerable:!0}),Object.defineProperty(b,"ChannelId",{writable:!1,configurable:!1,enumerable:!0}),Object.defineProperty(b,"Participant",{writable:!1,configurable:!1,enumerable:!0}),Object.defineProperty(b,"Client",{writable:!1,configurable:!1,enumerable:!0}),Object.defineProperty(b,"LoginSession",{writable:!1,configurable:!1,enumerable:!0}),Object.defineProperty(b,"PresenceSubscription",{writable:!1,configurable:!1,enumerable:!0}),Object.defineProperty(b,"ChannelSession",{writable:!1,configurable:!1,enumerable:!0}),Object.defineProperty(b,"Presence",{writable:!1,configurable:!1,enumerable:!0}),Object.defineProperty(b,"PresenceLocations",{writable:!1,configurable:!1,enumerable:!0}),Object.defineProperty(b,"TextMessage",{writable:!1,configurable:!1,enumerable:!0})},function(e,t,n){n(30).install()},function(e,t,n){(function(e){var r,i=n(31).SourceMapConsumer,o=n(38);try{(r=n(!function(){var e=new Error("Cannot find module 'fs'");throw e.code="MODULE_NOT_FOUND",e}())).existsSync&&r.readFileSync||(r=null)}catch(e){}var s=n(39),a=!1,c=!1,u=!1,l="auto",d={},h={},p=/^data:application\/json[^,]+base64,/,f=[],g=[];function m(){return"browser"===l||"node"!==l&&("undefined"!=typeof window&&"function"==typeof XMLHttpRequest&&!(window.require&&window.module&&window.process&&"renderer"===window.process.type))}function b(e){return function(t){for(var n=0;n<e.length;n++){var r=e[n](t);if(r)return r}return null}}var _=b(f);function S(e,t){if(!e)return t;var n=o.dirname(e),r=/^\w+:\/\/[^\/]*/.exec(n),i=r?r[0]:"",s=n.slice(i.length);return i&&/^\/\w\:/.test(s)?(i+="/")+o.resolve(n.slice(i.length),t).replace(/\\/g,"/"):i+o.resolve(n.slice(i.length),t)}f.push((function(e){if(e=e.trim(),/^file:/.test(e)&&(e=e.replace(/file:\/\/\/(\w:)?/,(function(e,t){return t?"":"/"}))),e in d)return d[e];var t="";try{if(r)r.existsSync(e)&&(t=r.readFileSync(e,"utf8"));else{var n=new XMLHttpRequest;n.open("GET",e,!1),n.send(null),4===n.readyState&&200===n.status&&(t=n.responseText)}}catch(e){}return d[e]=t}));var y=b(g);function v(e){var t=h[e.source];if(!t){var n=y(e.source);n?(t=h[e.source]={url:n.url,map:new i(n.map)}).map.sourcesContent&&t.map.sources.forEach((function(e,n){var r=t.map.sourcesContent[n];if(r){var i=S(t.url,e);d[i]=r}})):t=h[e.source]={url:null,map:null}}if(t&&t.map&&"function"==typeof t.map.originalPositionFor){var r=t.map.originalPositionFor(e);if(null!==r.source)return r.source=S(t.url,r.source),r}return e}function E(){var e,t="";if(this.isNative())t="native";else{!(e=this.getScriptNameOrSourceURL())&&this.isEval()&&(t=this.getEvalOrigin(),t+=", "),t+=e||"<anonymous>";var n=this.getLineNumber();if(null!=n){t+=":"+n;var r=this.getColumnNumber();r&&(t+=":"+r)}}var i="",o=this.getFunctionName(),s=!0,a=this.isConstructor();if(!(this.isToplevel()||a)){var c=this.getTypeName();"[object Object]"===c&&(c="null");var u=this.getMethodName();o?(c&&0!=o.indexOf(c)&&(i+=c+"."),i+=o,u&&o.indexOf("."+u)!=o.length-u.length-1&&(i+=" [as "+u+"]")):i+=c+"."+(u||"<anonymous>")}else a?i+="new "+(o||"<anonymous>"):o?i+=o:(i+=t,s=!1);return s&&(i+=" ("+t+")"),i}function C(e){var t={};return Object.getOwnPropertyNames(Object.getPrototypeOf(e)).forEach((function(n){t[n]=/^(?:is|get)/.test(n)?function(){return e[n].call(e)}:e[n]})),t.toString=E,t}function T(e){if(e.isNative())return e;var t=e.getFileName()||e.getScriptNameOrSourceURL();if(t){var n=e.getLineNumber(),r=e.getColumnNumber()-1;1===n&&r>62&&!m()&&!e.isEval()&&(r-=62);var i=v({source:t,line:n,column:r}),o=(e=C(e)).getFunctionName;return e.getFunctionName=function(){return i.name||o()},e.getFileName=function(){return i.source},e.getLineNumber=function(){return i.line},e.getColumnNumber=function(){return i.column+1},e.getScriptNameOrSourceURL=function(){return i.source},e}var s=e.isEval()&&e.getEvalOrigin();return s?(s=function e(t){var n=/^eval at ([^(]+) \((.+):(\d+):(\d+)\)$/.exec(t);if(n){var r=v({source:n[2],line:+n[3],column:n[4]-1});return"eval at "+n[1]+" ("+r.source+":"+r.line+":"+(r.column+1)+")"}return(n=/^eval at ([^(]+) \((.+)\)$/.exec(t))?"eval at "+n[1]+" ("+e(n[2])+")":t}(s),(e=C(e)).getEvalOrigin=function(){return s},e):e}function w(e,t){return u&&(d={},h={}),(e.name||"Error")+": "+(e.message||"")+t.map((function(e){return"\n    at "+T(e)})).join("")}function A(e){var t=/\n    at [^(]+ \((.*):(\d+):(\d+)\)/.exec(e.stack);if(t){var n=t[1],i=+t[2],o=+t[3],s=d[n];if(!s&&r&&r.existsSync(n))try{s=r.readFileSync(n,"utf8")}catch(e){s=""}if(s){var a=s.split(/(?:\r\n|\r|\n)/)[i-1];if(a)return n+":"+i+"\n"+a+"\n"+new Array(o).join(" ")+"^"}}return null}function P(t){var n=A(t);e.stderr._handle&&e.stderr._handle.setBlocking&&e.stderr._handle.setBlocking(!0),n&&(console.error(),console.error(n)),console.error(t.stack),e.exit(1)}g.push((function(e){var t,n=function(e){var t;if(m())try{var n=new XMLHttpRequest;n.open("GET",e,!1),n.send(null),t=4===n.readyState?n.responseText:null;var r=n.getResponseHeader("SourceMap")||n.getResponseHeader("X-SourceMap");if(r)return r}catch(e){}t=_(e);for(var i,o,s=/(?:\/\/[@#][ \t]+sourceMappingURL=([^\s'"]+?)[ \t]*$)|(?:\/\*[@#][ \t]+sourceMappingURL=([^\*]+?)[ \t]*(?:\*\/)[ \t]*$)/gm;o=s.exec(t);)i=o;return i?i[1]:null}(e);if(!n)return null;if(p.test(n)){var r=n.slice(n.indexOf(",")+1);t=s(r,"base64").toString(),n=e}else n=S(e,n),t=_(n);return t?{url:n,map:t}:null}));var O=f.slice(0),x=g.slice(0);t.wrapCallSite=T,t.getErrorSource=A,t.mapSourcePosition=v,t.retrieveSourceMap=y,t.install=function(t){if((t=t||{}).environment&&(l=t.environment,-1===["node","browser","auto"].indexOf(l)))throw new Error("environment "+l+" was unknown. Available options are {auto, browser, node}");if(t.retrieveFile&&(t.overrideRetrieveFile&&(f.length=0),f.unshift(t.retrieveFile)),t.retrieveSourceMap&&(t.overrideRetrieveSourceMap&&(g.length=0),g.unshift(t.retrieveSourceMap)),t.hookRequire&&!m()){var r;try{r=n(!function(){var e=new Error("Cannot find module 'module'");throw e.code="MODULE_NOT_FOUND",e}())}catch(e){}var i=r.prototype._compile;i.__sourceMapSupport||(r.prototype._compile=function(e,t){return d[t]=e,h[t]=void 0,i.call(this,e,t)},r.prototype._compile.__sourceMapSupport=!0)}var o;(u||(u="emptyCacheBetweenOperations"in t&&t.emptyCacheBetweenOperations),a||(a=!0,Error.prepareStackTrace=w),c)||(!("handleUncaughtExceptions"in t)||t.handleUncaughtExceptions)&&"object"==typeof e&&null!==e&&"function"==typeof e.on&&(c=!0,o=e.emit,e.emit=function(e){if("uncaughtException"===e){var t=arguments[1]&&arguments[1].stack,n=this.listeners(e).length>0;if(t&&!n)return P(arguments[1])}return o.apply(this,arguments)})},t.resetRetrieveHandlers=function(){f.length=0,g.length=0,f=O.slice(0),g=x.slice(0),y=b(g),_=b(f)}}).call(this,n(17))},function(e,t,n){t.SourceMapGenerator=n(18).SourceMapGenerator,t.SourceMapConsumer=n(34).SourceMapConsumer,t.SourceNode=n(37).SourceNode},function(e,t){var n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split("");t.encode=function(e){if(0<=e&&e<n.length)return n[e];throw new TypeError("Must be between 0 and 63: "+e)},t.decode=function(e){return 65<=e&&e<=90?e-65:97<=e&&e<=122?e-97+26:48<=e&&e<=57?e-48+52:43==e?62:47==e?63:-1}},function(e,t,n){var r=n(6);function i(){this._array=[],this._sorted=!0,this._last={generatedLine:-1,generatedColumn:0}}i.prototype.unsortedForEach=function(e,t){this._array.forEach(e,t)},i.prototype.add=function(e){var t,n,i,o,s,a;t=this._last,n=e,i=t.generatedLine,o=n.generatedLine,s=t.generatedColumn,a=n.generatedColumn,o>i||o==i&&a>=s||r.compareByGeneratedPositionsInflated(t,n)<=0?(this._last=e,this._array.push(e)):(this._sorted=!1,this._array.push(e))},i.prototype.toArray=function(){return this._sorted||(this._array.sort(r.compareByGeneratedPositionsInflated),this._sorted=!0),this._array},t.MappingList=i},function(e,t,n){var r=n(6),i=n(35),o=n(20).ArraySet,s=n(19),a=n(36).quickSort;function c(e,t){var n=e;return"string"==typeof e&&(n=r.parseSourceMapInput(e)),null!=n.sections?new d(n,t):new u(n,t)}function u(e,t){var n=e;"string"==typeof e&&(n=r.parseSourceMapInput(e));var i=r.getArg(n,"version"),s=r.getArg(n,"sources"),a=r.getArg(n,"names",[]),c=r.getArg(n,"sourceRoot",null),u=r.getArg(n,"sourcesContent",null),l=r.getArg(n,"mappings"),d=r.getArg(n,"file",null);if(i!=this._version)throw new Error("Unsupported version: "+i);c&&(c=r.normalize(c)),s=s.map(String).map(r.normalize).map((function(e){return c&&r.isAbsolute(c)&&r.isAbsolute(e)?r.relative(c,e):e})),this._names=o.fromArray(a.map(String),!0),this._sources=o.fromArray(s,!0),this._absoluteSources=this._sources.toArray().map((function(e){return r.computeSourceURL(c,e,t)})),this.sourceRoot=c,this.sourcesContent=u,this._mappings=l,this._sourceMapURL=t,this.file=d}function l(){this.generatedLine=0,this.generatedColumn=0,this.source=null,this.originalLine=null,this.originalColumn=null,this.name=null}function d(e,t){var n=e;"string"==typeof e&&(n=r.parseSourceMapInput(e));var i=r.getArg(n,"version"),s=r.getArg(n,"sections");if(i!=this._version)throw new Error("Unsupported version: "+i);this._sources=new o,this._names=new o;var a={line:-1,column:0};this._sections=s.map((function(e){if(e.url)throw new Error("Support for url field in sections not implemented.");var n=r.getArg(e,"offset"),i=r.getArg(n,"line"),o=r.getArg(n,"column");if(i<a.line||i===a.line&&o<a.column)throw new Error("Section offsets must be ordered and non-overlapping.");return a=n,{generatedOffset:{generatedLine:i+1,generatedColumn:o+1},consumer:new c(r.getArg(e,"map"),t)}}))}c.fromSourceMap=function(e,t){return u.fromSourceMap(e,t)},c.prototype._version=3,c.prototype.__generatedMappings=null,Object.defineProperty(c.prototype,"_generatedMappings",{configurable:!0,enumerable:!0,get:function(){return this.__generatedMappings||this._parseMappings(this._mappings,this.sourceRoot),this.__generatedMappings}}),c.prototype.__originalMappings=null,Object.defineProperty(c.prototype,"_originalMappings",{configurable:!0,enumerable:!0,get:function(){return this.__originalMappings||this._parseMappings(this._mappings,this.sourceRoot),this.__originalMappings}}),c.prototype._charIsMappingSeparator=function(e,t){var n=e.charAt(t);return";"===n||","===n},c.prototype._parseMappings=function(e,t){throw new Error("Subclasses must implement _parseMappings")},c.GENERATED_ORDER=1,c.ORIGINAL_ORDER=2,c.GREATEST_LOWER_BOUND=1,c.LEAST_UPPER_BOUND=2,c.prototype.eachMapping=function(e,t,n){var i,o=t||null;switch(n||c.GENERATED_ORDER){case c.GENERATED_ORDER:i=this._generatedMappings;break;case c.ORIGINAL_ORDER:i=this._originalMappings;break;default:throw new Error("Unknown order of iteration.")}var s=this.sourceRoot;i.map((function(e){var t=null===e.source?null:this._sources.at(e.source);return{source:t=r.computeSourceURL(s,t,this._sourceMapURL),generatedLine:e.generatedLine,generatedColumn:e.generatedColumn,originalLine:e.originalLine,originalColumn:e.originalColumn,name:null===e.name?null:this._names.at(e.name)}}),this).forEach(e,o)},c.prototype.allGeneratedPositionsFor=function(e){var t=r.getArg(e,"line"),n={source:r.getArg(e,"source"),originalLine:t,originalColumn:r.getArg(e,"column",0)};if(n.source=this._findSourceIndex(n.source),n.source<0)return[];var o=[],s=this._findMapping(n,this._originalMappings,"originalLine","originalColumn",r.compareByOriginalPositions,i.LEAST_UPPER_BOUND);if(s>=0){var a=this._originalMappings[s];if(void 0===e.column)for(var c=a.originalLine;a&&a.originalLine===c;)o.push({line:r.getArg(a,"generatedLine",null),column:r.getArg(a,"generatedColumn",null),lastColumn:r.getArg(a,"lastGeneratedColumn",null)}),a=this._originalMappings[++s];else for(var u=a.originalColumn;a&&a.originalLine===t&&a.originalColumn==u;)o.push({line:r.getArg(a,"generatedLine",null),column:r.getArg(a,"generatedColumn",null),lastColumn:r.getArg(a,"lastGeneratedColumn",null)}),a=this._originalMappings[++s]}return o},t.SourceMapConsumer=c,u.prototype=Object.create(c.prototype),u.prototype.consumer=c,u.prototype._findSourceIndex=function(e){var t,n=e;if(null!=this.sourceRoot&&(n=r.relative(this.sourceRoot,n)),this._sources.has(n))return this._sources.indexOf(n);for(t=0;t<this._absoluteSources.length;++t)if(this._absoluteSources[t]==e)return t;return-1},u.fromSourceMap=function(e,t){var n=Object.create(u.prototype),i=n._names=o.fromArray(e._names.toArray(),!0),s=n._sources=o.fromArray(e._sources.toArray(),!0);n.sourceRoot=e._sourceRoot,n.sourcesContent=e._generateSourcesContent(n._sources.toArray(),n.sourceRoot),n.file=e._file,n._sourceMapURL=t,n._absoluteSources=n._sources.toArray().map((function(e){return r.computeSourceURL(n.sourceRoot,e,t)}));for(var c=e._mappings.toArray().slice(),d=n.__generatedMappings=[],h=n.__originalMappings=[],p=0,f=c.length;p<f;p++){var g=c[p],m=new l;m.generatedLine=g.generatedLine,m.generatedColumn=g.generatedColumn,g.source&&(m.source=s.indexOf(g.source),m.originalLine=g.originalLine,m.originalColumn=g.originalColumn,g.name&&(m.name=i.indexOf(g.name)),h.push(m)),d.push(m)}return a(n.__originalMappings,r.compareByOriginalPositions),n},u.prototype._version=3,Object.defineProperty(u.prototype,"sources",{get:function(){return this._absoluteSources.slice()}}),u.prototype._parseMappings=function(e,t){for(var n,i,o,c,u,d=1,h=0,p=0,f=0,g=0,m=0,b=e.length,_=0,S={},y={},v=[],E=[];_<b;)if(";"===e.charAt(_))d++,_++,h=0;else if(","===e.charAt(_))_++;else{for((n=new l).generatedLine=d,c=_;c<b&&!this._charIsMappingSeparator(e,c);c++);if(o=S[i=e.slice(_,c)])_+=i.length;else{for(o=[];_<c;)s.decode(e,_,y),u=y.value,_=y.rest,o.push(u);if(2===o.length)throw new Error("Found a source, but no line and column");if(3===o.length)throw new Error("Found a source and line, but no column");S[i]=o}n.generatedColumn=h+o[0],h=n.generatedColumn,o.length>1&&(n.source=g+o[1],g+=o[1],n.originalLine=p+o[2],p=n.originalLine,n.originalLine+=1,n.originalColumn=f+o[3],f=n.originalColumn,o.length>4&&(n.name=m+o[4],m+=o[4])),E.push(n),"number"==typeof n.originalLine&&v.push(n)}a(E,r.compareByGeneratedPositionsDeflated),this.__generatedMappings=E,a(v,r.compareByOriginalPositions),this.__originalMappings=v},u.prototype._findMapping=function(e,t,n,r,o,s){if(e[n]<=0)throw new TypeError("Line must be greater than or equal to 1, got "+e[n]);if(e[r]<0)throw new TypeError("Column must be greater than or equal to 0, got "+e[r]);return i.search(e,t,o,s)},u.prototype.computeColumnSpans=function(){for(var e=0;e<this._generatedMappings.length;++e){var t=this._generatedMappings[e];if(e+1<this._generatedMappings.length){var n=this._generatedMappings[e+1];if(t.generatedLine===n.generatedLine){t.lastGeneratedColumn=n.generatedColumn-1;continue}}t.lastGeneratedColumn=1/0}},u.prototype.originalPositionFor=function(e){var t={generatedLine:r.getArg(e,"line"),generatedColumn:r.getArg(e,"column")},n=this._findMapping(t,this._generatedMappings,"generatedLine","generatedColumn",r.compareByGeneratedPositionsDeflated,r.getArg(e,"bias",c.GREATEST_LOWER_BOUND));if(n>=0){var i=this._generatedMappings[n];if(i.generatedLine===t.generatedLine){var o=r.getArg(i,"source",null);null!==o&&(o=this._sources.at(o),o=r.computeSourceURL(this.sourceRoot,o,this._sourceMapURL));var s=r.getArg(i,"name",null);return null!==s&&(s=this._names.at(s)),{source:o,line:r.getArg(i,"originalLine",null),column:r.getArg(i,"originalColumn",null),name:s}}}return{source:null,line:null,column:null,name:null}},u.prototype.hasContentsOfAllSources=function(){return!!this.sourcesContent&&(this.sourcesContent.length>=this._sources.size()&&!this.sourcesContent.some((function(e){return null==e})))},u.prototype.sourceContentFor=function(e,t){if(!this.sourcesContent)return null;var n=this._findSourceIndex(e);if(n>=0)return this.sourcesContent[n];var i,o=e;if(null!=this.sourceRoot&&(o=r.relative(this.sourceRoot,o)),null!=this.sourceRoot&&(i=r.urlParse(this.sourceRoot))){var s=o.replace(/^file:\/\//,"");if("file"==i.scheme&&this._sources.has(s))return this.sourcesContent[this._sources.indexOf(s)];if((!i.path||"/"==i.path)&&this._sources.has("/"+o))return this.sourcesContent[this._sources.indexOf("/"+o)]}if(t)return null;throw new Error('"'+o+'" is not in the SourceMap.')},u.prototype.generatedPositionFor=function(e){var t=r.getArg(e,"source");if((t=this._findSourceIndex(t))<0)return{line:null,column:null,lastColumn:null};var n={source:t,originalLine:r.getArg(e,"line"),originalColumn:r.getArg(e,"column")},i=this._findMapping(n,this._originalMappings,"originalLine","originalColumn",r.compareByOriginalPositions,r.getArg(e,"bias",c.GREATEST_LOWER_BOUND));if(i>=0){var o=this._originalMappings[i];if(o.source===n.source)return{line:r.getArg(o,"generatedLine",null),column:r.getArg(o,"generatedColumn",null),lastColumn:r.getArg(o,"lastGeneratedColumn",null)}}return{line:null,column:null,lastColumn:null}},t.BasicSourceMapConsumer=u,d.prototype=Object.create(c.prototype),d.prototype.constructor=c,d.prototype._version=3,Object.defineProperty(d.prototype,"sources",{get:function(){for(var e=[],t=0;t<this._sections.length;t++)for(var n=0;n<this._sections[t].consumer.sources.length;n++)e.push(this._sections[t].consumer.sources[n]);return e}}),d.prototype.originalPositionFor=function(e){var t={generatedLine:r.getArg(e,"line"),generatedColumn:r.getArg(e,"column")},n=i.search(t,this._sections,(function(e,t){var n=e.generatedLine-t.generatedOffset.generatedLine;return n||e.generatedColumn-t.generatedOffset.generatedColumn})),o=this._sections[n];return o?o.consumer.originalPositionFor({line:t.generatedLine-(o.generatedOffset.generatedLine-1),column:t.generatedColumn-(o.generatedOffset.generatedLine===t.generatedLine?o.generatedOffset.generatedColumn-1:0),bias:e.bias}):{source:null,line:null,column:null,name:null}},d.prototype.hasContentsOfAllSources=function(){return this._sections.every((function(e){return e.consumer.hasContentsOfAllSources()}))},d.prototype.sourceContentFor=function(e,t){for(var n=0;n<this._sections.length;n++){var r=this._sections[n].consumer.sourceContentFor(e,!0);if(r)return r}if(t)return null;throw new Error('"'+e+'" is not in the SourceMap.')},d.prototype.generatedPositionFor=function(e){for(var t=0;t<this._sections.length;t++){var n=this._sections[t];if(-1!==n.consumer._findSourceIndex(r.getArg(e,"source"))){var i=n.consumer.generatedPositionFor(e);if(i)return{line:i.line+(n.generatedOffset.generatedLine-1),column:i.column+(n.generatedOffset.generatedLine===i.line?n.generatedOffset.generatedColumn-1:0)}}}return{line:null,column:null}},d.prototype._parseMappings=function(e,t){this.__generatedMappings=[],this.__originalMappings=[];for(var n=0;n<this._sections.length;n++)for(var i=this._sections[n],o=i.consumer._generatedMappings,s=0;s<o.length;s++){var c=o[s],u=i.consumer._sources.at(c.source);u=r.computeSourceURL(i.consumer.sourceRoot,u,this._sourceMapURL),this._sources.add(u),u=this._sources.indexOf(u);var l=null;c.name&&(l=i.consumer._names.at(c.name),this._names.add(l),l=this._names.indexOf(l));var d={source:u,generatedLine:c.generatedLine+(i.generatedOffset.generatedLine-1),generatedColumn:c.generatedColumn+(i.generatedOffset.generatedLine===c.generatedLine?i.generatedOffset.generatedColumn-1:0),originalLine:c.originalLine,originalColumn:c.originalColumn,name:l};this.__generatedMappings.push(d),"number"==typeof d.originalLine&&this.__originalMappings.push(d)}a(this.__generatedMappings,r.compareByGeneratedPositionsDeflated),a(this.__originalMappings,r.compareByOriginalPositions)},t.IndexedSourceMapConsumer=d},function(e,t){t.GREATEST_LOWER_BOUND=1,t.LEAST_UPPER_BOUND=2,t.search=function(e,n,r,i){if(0===n.length)return-1;var o=function e(n,r,i,o,s,a){var c=Math.floor((r-n)/2)+n,u=s(i,o[c],!0);return 0===u?c:u>0?r-c>1?e(c,r,i,o,s,a):a==t.LEAST_UPPER_BOUND?r<o.length?r:-1:c:c-n>1?e(n,c,i,o,s,a):a==t.LEAST_UPPER_BOUND?c:n<0?-1:n}(-1,n.length,e,n,r,i||t.GREATEST_LOWER_BOUND);if(o<0)return-1;for(;o-1>=0&&0===r(n[o],n[o-1],!0);)--o;return o}},function(e,t){function n(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}function r(e,t,i,o){if(i<o){var s=i-1;n(e,(l=i,d=o,Math.round(l+Math.random()*(d-l))),o);for(var a=e[o],c=i;c<o;c++)t(e[c],a)<=0&&n(e,s+=1,c);n(e,s+1,c);var u=s+1;r(e,t,i,u-1),r(e,t,u+1,o)}var l,d}t.quickSort=function(e,t){r(e,t,0,e.length-1)}},function(e,t,n){var r=n(18).SourceMapGenerator,i=n(6),o=/(\r?\n)/,s="$$$isSourceNode$$$";function a(e,t,n,r,i){this.children=[],this.sourceContents={},this.line=null==e?null:e,this.column=null==t?null:t,this.source=null==n?null:n,this.name=null==i?null:i,this[s]=!0,null!=r&&this.add(r)}a.fromStringWithSourceMap=function(e,t,n){var r=new a,s=e.split(o),c=0,u=function(){return e()+(e()||"");function e(){return c<s.length?s[c++]:void 0}},l=1,d=0,h=null;return t.eachMapping((function(e){if(null!==h){if(!(l<e.generatedLine)){var t=(n=s[c]||"").substr(0,e.generatedColumn-d);return s[c]=n.substr(e.generatedColumn-d),d=e.generatedColumn,p(h,t),void(h=e)}p(h,u()),l++,d=0}for(;l<e.generatedLine;)r.add(u()),l++;if(d<e.generatedColumn){var n=s[c]||"";r.add(n.substr(0,e.generatedColumn)),s[c]=n.substr(e.generatedColumn),d=e.generatedColumn}h=e}),this),c<s.length&&(h&&p(h,u()),r.add(s.splice(c).join(""))),t.sources.forEach((function(e){var o=t.sourceContentFor(e);null!=o&&(null!=n&&(e=i.join(n,e)),r.setSourceContent(e,o))})),r;function p(e,t){if(null===e||void 0===e.source)r.add(t);else{var o=n?i.join(n,e.source):e.source;r.add(new a(e.originalLine,e.originalColumn,o,t,e.name))}}},a.prototype.add=function(e){if(Array.isArray(e))e.forEach((function(e){this.add(e)}),this);else{if(!e[s]&&"string"!=typeof e)throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+e);e&&this.children.push(e)}return this},a.prototype.prepend=function(e){if(Array.isArray(e))for(var t=e.length-1;t>=0;t--)this.prepend(e[t]);else{if(!e[s]&&"string"!=typeof e)throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+e);this.children.unshift(e)}return this},a.prototype.walk=function(e){for(var t,n=0,r=this.children.length;n<r;n++)(t=this.children[n])[s]?t.walk(e):""!==t&&e(t,{source:this.source,line:this.line,column:this.column,name:this.name})},a.prototype.join=function(e){var t,n,r=this.children.length;if(r>0){for(t=[],n=0;n<r-1;n++)t.push(this.children[n]),t.push(e);t.push(this.children[n]),this.children=t}return this},a.prototype.replaceRight=function(e,t){var n=this.children[this.children.length-1];return n[s]?n.replaceRight(e,t):"string"==typeof n?this.children[this.children.length-1]=n.replace(e,t):this.children.push("".replace(e,t)),this},a.prototype.setSourceContent=function(e,t){this.sourceContents[i.toSetString(e)]=t},a.prototype.walkSourceContents=function(e){for(var t=0,n=this.children.length;t<n;t++)this.children[t][s]&&this.children[t].walkSourceContents(e);var r=Object.keys(this.sourceContents);for(t=0,n=r.length;t<n;t++)e(i.fromSetString(r[t]),this.sourceContents[r[t]])},a.prototype.toString=function(){var e="";return this.walk((function(t){e+=t})),e},a.prototype.toStringWithSourceMap=function(e){var t={code:"",line:1,column:0},n=new r(e),i=!1,o=null,s=null,a=null,c=null;return this.walk((function(e,r){t.code+=e,null!==r.source&&null!==r.line&&null!==r.column?(o===r.source&&s===r.line&&a===r.column&&c===r.name||n.addMapping({source:r.source,original:{line:r.line,column:r.column},generated:{line:t.line,column:t.column},name:r.name}),o=r.source,s=r.line,a=r.column,c=r.name,i=!0):i&&(n.addMapping({generated:{line:t.line,column:t.column}}),o=null,i=!1);for(var u=0,l=e.length;u<l;u++)10===e.charCodeAt(u)?(t.line++,t.column=0,u+1===l?(o=null,i=!1):i&&n.addMapping({source:r.source,original:{line:r.line,column:r.column},generated:{line:t.line,column:t.column},name:r.name})):t.column++})),this.walkSourceContents((function(e,t){n.setSourceContent(e,t)})),{code:t.code,map:n}},t.SourceNode=a},function(e,t,n){(function(e){function n(e,t){for(var n=0,r=e.length-1;r>=0;r--){var i=e[r];"."===i?e.splice(r,1):".."===i?(e.splice(r,1),n++):n&&(e.splice(r,1),n--)}if(t)for(;n--;n)e.unshift("..");return e}function r(e,t){if(e.filter)return e.filter(t);for(var n=[],r=0;r<e.length;r++)t(e[r],r,e)&&n.push(e[r]);return n}t.resolve=function(){for(var t="",i=!1,o=arguments.length-1;o>=-1&&!i;o--){var s=o>=0?arguments[o]:e.cwd();if("string"!=typeof s)throw new TypeError("Arguments to path.resolve must be strings");s&&(t=s+"/"+t,i="/"===s.charAt(0))}return(i?"/":"")+(t=n(r(t.split("/"),(function(e){return!!e})),!i).join("/"))||"."},t.normalize=function(e){var o=t.isAbsolute(e),s="/"===i(e,-1);return(e=n(r(e.split("/"),(function(e){return!!e})),!o).join("/"))||o||(e="."),e&&s&&(e+="/"),(o?"/":"")+e},t.isAbsolute=function(e){return"/"===e.charAt(0)},t.join=function(){var e=Array.prototype.slice.call(arguments,0);return t.normalize(r(e,(function(e,t){if("string"!=typeof e)throw new TypeError("Arguments to path.join must be strings");return e})).join("/"))},t.relative=function(e,n){function r(e){for(var t=0;t<e.length&&""===e[t];t++);for(var n=e.length-1;n>=0&&""===e[n];n--);return t>n?[]:e.slice(t,n-t+1)}e=t.resolve(e).substr(1),n=t.resolve(n).substr(1);for(var i=r(e.split("/")),o=r(n.split("/")),s=Math.min(i.length,o.length),a=s,c=0;c<s;c++)if(i[c]!==o[c]){a=c;break}var u=[];for(c=a;c<i.length;c++)u.push("..");return(u=u.concat(o.slice(a))).join("/")},t.sep="/",t.delimiter=":",t.dirname=function(e){if("string"!=typeof e&&(e+=""),0===e.length)return".";for(var t=e.charCodeAt(0),n=47===t,r=-1,i=!0,o=e.length-1;o>=1;--o)if(47===(t=e.charCodeAt(o))){if(!i){r=o;break}}else i=!1;return-1===r?n?"/":".":n&&1===r?"/":e.slice(0,r)},t.basename=function(e,t){var n=function(e){"string"!=typeof e&&(e+="");var t,n=0,r=-1,i=!0;for(t=e.length-1;t>=0;--t)if(47===e.charCodeAt(t)){if(!i){n=t+1;break}}else-1===r&&(i=!1,r=t+1);return-1===r?"":e.slice(n,r)}(e);return t&&n.substr(-1*t.length)===t&&(n=n.substr(0,n.length-t.length)),n},t.extname=function(e){"string"!=typeof e&&(e+="");for(var t=-1,n=0,r=-1,i=!0,o=0,s=e.length-1;s>=0;--s){var a=e.charCodeAt(s);if(47!==a)-1===r&&(i=!1,r=s+1),46===a?-1===t?t=s:1!==o&&(o=1):-1!==t&&(o=-1);else if(!i){n=s+1;break}}return-1===t||-1===r||0===o||1===o&&t===r-1&&t===n+1?"":e.slice(t,r)};var i="b"==="ab".substr(-1)?function(e,t,n){return e.substr(t,n)}:function(e,t,n){return t<0&&(t=e.length+t),e.substr(t,n)}}).call(this,n(17))},function(e,t,n){(function(t){var n=Object.prototype.toString,r=void 0!==t&&"function"==typeof t.alloc&&"function"==typeof t.allocUnsafe&&"function"==typeof t.from;e.exports=function(e,i,o){if("number"==typeof e)throw new TypeError('"value" argument must not be a number');return s=e,"ArrayBuffer"===n.call(s).slice(8,-1)?function(e,n,i){n>>>=0;var o=e.byteLength-n;if(o<0)throw new RangeError("'offset' is out of bounds");if(void 0===i)i=o;else if((i>>>=0)>o)throw new RangeError("'length' is out of bounds");return r?t.from(e.slice(n,n+i)):new t(new Uint8Array(e.slice(n,n+i)))}(e,i,o):"string"==typeof e?function(e,n){if("string"==typeof n&&""!==n||(n="utf8"),!t.isEncoding(n))throw new TypeError('"encoding" must be a valid string encoding');return r?t.from(e,n):new t(e,n)}(e,i):r?t.from(e):new t(e);var s}}).call(this,n(40).Buffer)},function(e,t,n){"use strict";(function(e){
/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <http://feross.org>
 * @license  MIT
 */
var r=n(41),i=n(42),o=n(43);function s(){return c.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function a(e,t){if(s()<t)throw new RangeError("Invalid typed array length");return c.TYPED_ARRAY_SUPPORT?(e=new Uint8Array(t)).__proto__=c.prototype:(null===e&&(e=new c(t)),e.length=t),e}function c(e,t,n){if(!(c.TYPED_ARRAY_SUPPORT||this instanceof c))return new c(e,t,n);if("number"==typeof e){if("string"==typeof t)throw new Error("If encoding is specified then the first argument must be a string");return d(this,e)}return u(this,e,t,n)}function u(e,t,n,r){if("number"==typeof t)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer?function(e,t,n,r){if(t.byteLength,n<0||t.byteLength<n)throw new RangeError("'offset' is out of bounds");if(t.byteLength<n+(r||0))throw new RangeError("'length' is out of bounds");t=void 0===n&&void 0===r?new Uint8Array(t):void 0===r?new Uint8Array(t,n):new Uint8Array(t,n,r);c.TYPED_ARRAY_SUPPORT?(e=t).__proto__=c.prototype:e=h(e,t);return e}(e,t,n,r):"string"==typeof t?function(e,t,n){"string"==typeof n&&""!==n||(n="utf8");if(!c.isEncoding(n))throw new TypeError('"encoding" must be a valid string encoding');var r=0|f(t,n),i=(e=a(e,r)).write(t,n);i!==r&&(e=e.slice(0,i));return e}(e,t,n):function(e,t){if(c.isBuffer(t)){var n=0|p(t.length);return 0===(e=a(e,n)).length||t.copy(e,0,0,n),e}if(t){if("undefined"!=typeof ArrayBuffer&&t.buffer instanceof ArrayBuffer||"length"in t)return"number"!=typeof t.length||(r=t.length)!=r?a(e,0):h(e,t);if("Buffer"===t.type&&o(t.data))return h(e,t.data)}var r;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(e,t)}function l(e){if("number"!=typeof e)throw new TypeError('"size" argument must be a number');if(e<0)throw new RangeError('"size" argument must not be negative')}function d(e,t){if(l(t),e=a(e,t<0?0:0|p(t)),!c.TYPED_ARRAY_SUPPORT)for(var n=0;n<t;++n)e[n]=0;return e}function h(e,t){var n=t.length<0?0:0|p(t.length);e=a(e,n);for(var r=0;r<n;r+=1)e[r]=255&t[r];return e}function p(e){if(e>=s())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+s().toString(16)+" bytes");return 0|e}function f(e,t){if(c.isBuffer(e))return e.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;"string"!=typeof e&&(e=""+e);var n=e.length;if(0===n)return 0;for(var r=!1;;)switch(t){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":case void 0:return j(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return F(e).length;default:if(r)return j(e).length;t=(""+t).toLowerCase(),r=!0}}function g(e,t,n){var r=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if((n>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return x(this,t,n);case"utf8":case"utf-8":return A(this,t,n);case"ascii":return P(this,t,n);case"latin1":case"binary":return O(this,t,n);case"base64":return w(this,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return R(this,t,n);default:if(r)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),r=!0}}function m(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}function b(e,t,n,r,i){if(0===e.length)return-1;if("string"==typeof n?(r=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),n=+n,isNaN(n)&&(n=i?0:e.length-1),n<0&&(n=e.length+n),n>=e.length){if(i)return-1;n=e.length-1}else if(n<0){if(!i)return-1;n=0}if("string"==typeof t&&(t=c.from(t,r)),c.isBuffer(t))return 0===t.length?-1:_(e,t,n,r,i);if("number"==typeof t)return t&=255,c.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(e,t,n):Uint8Array.prototype.lastIndexOf.call(e,t,n):_(e,[t],n,r,i);throw new TypeError("val must be string, number or Buffer")}function _(e,t,n,r,i){var o,s=1,a=e.length,c=t.length;if(void 0!==r&&("ucs2"===(r=String(r).toLowerCase())||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(e.length<2||t.length<2)return-1;s=2,a/=2,c/=2,n/=2}function u(e,t){return 1===s?e[t]:e.readUInt16BE(t*s)}if(i){var l=-1;for(o=n;o<a;o++)if(u(e,o)===u(t,-1===l?0:o-l)){if(-1===l&&(l=o),o-l+1===c)return l*s}else-1!==l&&(o-=o-l),l=-1}else for(n+c>a&&(n=a-c),o=n;o>=0;o--){for(var d=!0,h=0;h<c;h++)if(u(e,o+h)!==u(t,h)){d=!1;break}if(d)return o}return-1}function S(e,t,n,r){n=Number(n)||0;var i=e.length-n;r?(r=Number(r))>i&&(r=i):r=i;var o=t.length;if(o%2!=0)throw new TypeError("Invalid hex string");r>o/2&&(r=o/2);for(var s=0;s<r;++s){var a=parseInt(t.substr(2*s,2),16);if(isNaN(a))return s;e[n+s]=a}return s}function y(e,t,n,r){return H(j(t,e.length-n),e,n,r)}function v(e,t,n,r){return H(function(e){for(var t=[],n=0;n<e.length;++n)t.push(255&e.charCodeAt(n));return t}(t),e,n,r)}function E(e,t,n,r){return v(e,t,n,r)}function C(e,t,n,r){return H(F(t),e,n,r)}function T(e,t,n,r){return H(function(e,t){for(var n,r,i,o=[],s=0;s<e.length&&!((t-=2)<0);++s)n=e.charCodeAt(s),r=n>>8,i=n%256,o.push(i),o.push(r);return o}(t,e.length-n),e,n,r)}function w(e,t,n){return 0===t&&n===e.length?r.fromByteArray(e):r.fromByteArray(e.slice(t,n))}function A(e,t,n){n=Math.min(e.length,n);for(var r=[],i=t;i<n;){var o,s,a,c,u=e[i],l=null,d=u>239?4:u>223?3:u>191?2:1;if(i+d<=n)switch(d){case 1:u<128&&(l=u);break;case 2:128==(192&(o=e[i+1]))&&(c=(31&u)<<6|63&o)>127&&(l=c);break;case 3:o=e[i+1],s=e[i+2],128==(192&o)&&128==(192&s)&&(c=(15&u)<<12|(63&o)<<6|63&s)>2047&&(c<55296||c>57343)&&(l=c);break;case 4:o=e[i+1],s=e[i+2],a=e[i+3],128==(192&o)&&128==(192&s)&&128==(192&a)&&(c=(15&u)<<18|(63&o)<<12|(63&s)<<6|63&a)>65535&&c<1114112&&(l=c)}null===l?(l=65533,d=1):l>65535&&(l-=65536,r.push(l>>>10&1023|55296),l=56320|1023&l),r.push(l),i+=d}return function(e){var t=e.length;if(t<=4096)return String.fromCharCode.apply(String,e);var n="",r=0;for(;r<t;)n+=String.fromCharCode.apply(String,e.slice(r,r+=4096));return n}(r)}t.Buffer=c,t.SlowBuffer=function(e){+e!=e&&(e=0);return c.alloc(+e)},t.INSPECT_MAX_BYTES=50,c.TYPED_ARRAY_SUPPORT=void 0!==e.TYPED_ARRAY_SUPPORT?e.TYPED_ARRAY_SUPPORT:function(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()&&"function"==typeof e.subarray&&0===e.subarray(1,1).byteLength}catch(e){return!1}}(),t.kMaxLength=s(),c.poolSize=8192,c._augment=function(e){return e.__proto__=c.prototype,e},c.from=function(e,t,n){return u(null,e,t,n)},c.TYPED_ARRAY_SUPPORT&&(c.prototype.__proto__=Uint8Array.prototype,c.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&c[Symbol.species]===c&&Object.defineProperty(c,Symbol.species,{value:null,configurable:!0})),c.alloc=function(e,t,n){return function(e,t,n,r){return l(t),t<=0?a(e,t):void 0!==n?"string"==typeof r?a(e,t).fill(n,r):a(e,t).fill(n):a(e,t)}(null,e,t,n)},c.allocUnsafe=function(e){return d(null,e)},c.allocUnsafeSlow=function(e){return d(null,e)},c.isBuffer=function(e){return!(null==e||!e._isBuffer)},c.compare=function(e,t){if(!c.isBuffer(e)||!c.isBuffer(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var n=e.length,r=t.length,i=0,o=Math.min(n,r);i<o;++i)if(e[i]!==t[i]){n=e[i],r=t[i];break}return n<r?-1:r<n?1:0},c.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},c.concat=function(e,t){if(!o(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return c.alloc(0);var n;if(void 0===t)for(t=0,n=0;n<e.length;++n)t+=e[n].length;var r=c.allocUnsafe(t),i=0;for(n=0;n<e.length;++n){var s=e[n];if(!c.isBuffer(s))throw new TypeError('"list" argument must be an Array of Buffers');s.copy(r,i),i+=s.length}return r},c.byteLength=f,c.prototype._isBuffer=!0,c.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)m(this,t,t+1);return this},c.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)m(this,t,t+3),m(this,t+1,t+2);return this},c.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)m(this,t,t+7),m(this,t+1,t+6),m(this,t+2,t+5),m(this,t+3,t+4);return this},c.prototype.toString=function(){var e=0|this.length;return 0===e?"":0===arguments.length?A(this,0,e):g.apply(this,arguments)},c.prototype.equals=function(e){if(!c.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===c.compare(this,e)},c.prototype.inspect=function(){var e="",n=t.INSPECT_MAX_BYTES;return this.length>0&&(e=this.toString("hex",0,n).match(/.{2}/g).join(" "),this.length>n&&(e+=" ... ")),"<Buffer "+e+">"},c.prototype.compare=function(e,t,n,r,i){if(!c.isBuffer(e))throw new TypeError("Argument must be a Buffer");if(void 0===t&&(t=0),void 0===n&&(n=e?e.length:0),void 0===r&&(r=0),void 0===i&&(i=this.length),t<0||n>e.length||r<0||i>this.length)throw new RangeError("out of range index");if(r>=i&&t>=n)return 0;if(r>=i)return-1;if(t>=n)return 1;if(this===e)return 0;for(var o=(i>>>=0)-(r>>>=0),s=(n>>>=0)-(t>>>=0),a=Math.min(o,s),u=this.slice(r,i),l=e.slice(t,n),d=0;d<a;++d)if(u[d]!==l[d]){o=u[d],s=l[d];break}return o<s?-1:s<o?1:0},c.prototype.includes=function(e,t,n){return-1!==this.indexOf(e,t,n)},c.prototype.indexOf=function(e,t,n){return b(this,e,t,n,!0)},c.prototype.lastIndexOf=function(e,t,n){return b(this,e,t,n,!1)},c.prototype.write=function(e,t,n,r){if(void 0===t)r="utf8",n=this.length,t=0;else if(void 0===n&&"string"==typeof t)r=t,n=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t|=0,isFinite(n)?(n|=0,void 0===r&&(r="utf8")):(r=n,n=void 0)}var i=this.length-t;if((void 0===n||n>i)&&(n=i),e.length>0&&(n<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");r||(r="utf8");for(var o=!1;;)switch(r){case"hex":return S(this,e,t,n);case"utf8":case"utf-8":return y(this,e,t,n);case"ascii":return v(this,e,t,n);case"latin1":case"binary":return E(this,e,t,n);case"base64":return C(this,e,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return T(this,e,t,n);default:if(o)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),o=!0}},c.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function P(e,t,n){var r="";n=Math.min(e.length,n);for(var i=t;i<n;++i)r+=String.fromCharCode(127&e[i]);return r}function O(e,t,n){var r="";n=Math.min(e.length,n);for(var i=t;i<n;++i)r+=String.fromCharCode(e[i]);return r}function x(e,t,n){var r=e.length;(!t||t<0)&&(t=0),(!n||n<0||n>r)&&(n=r);for(var i="",o=t;o<n;++o)i+=B(e[o]);return i}function R(e,t,n){for(var r=e.slice(t,n),i="",o=0;o<r.length;o+=2)i+=String.fromCharCode(r[o]+256*r[o+1]);return i}function I(e,t,n){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>n)throw new RangeError("Trying to access beyond buffer length")}function N(e,t,n,r,i,o){if(!c.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>i||t<o)throw new RangeError('"value" argument is out of bounds');if(n+r>e.length)throw new RangeError("Index out of range")}function M(e,t,n,r){t<0&&(t=65535+t+1);for(var i=0,o=Math.min(e.length-n,2);i<o;++i)e[n+i]=(t&255<<8*(r?i:1-i))>>>8*(r?i:1-i)}function D(e,t,n,r){t<0&&(t=4294967295+t+1);for(var i=0,o=Math.min(e.length-n,4);i<o;++i)e[n+i]=t>>>8*(r?i:3-i)&255}function L(e,t,n,r,i,o){if(n+r>e.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function k(e,t,n,r,o){return o||L(e,0,n,4),i.write(e,t,n,r,23,4),n+4}function U(e,t,n,r,o){return o||L(e,0,n,8),i.write(e,t,n,r,52,8),n+8}c.prototype.slice=function(e,t){var n,r=this.length;if((e=~~e)<0?(e+=r)<0&&(e=0):e>r&&(e=r),(t=void 0===t?r:~~t)<0?(t+=r)<0&&(t=0):t>r&&(t=r),t<e&&(t=e),c.TYPED_ARRAY_SUPPORT)(n=this.subarray(e,t)).__proto__=c.prototype;else{var i=t-e;n=new c(i,void 0);for(var o=0;o<i;++o)n[o]=this[o+e]}return n},c.prototype.readUIntLE=function(e,t,n){e|=0,t|=0,n||I(e,t,this.length);for(var r=this[e],i=1,o=0;++o<t&&(i*=256);)r+=this[e+o]*i;return r},c.prototype.readUIntBE=function(e,t,n){e|=0,t|=0,n||I(e,t,this.length);for(var r=this[e+--t],i=1;t>0&&(i*=256);)r+=this[e+--t]*i;return r},c.prototype.readUInt8=function(e,t){return t||I(e,1,this.length),this[e]},c.prototype.readUInt16LE=function(e,t){return t||I(e,2,this.length),this[e]|this[e+1]<<8},c.prototype.readUInt16BE=function(e,t){return t||I(e,2,this.length),this[e]<<8|this[e+1]},c.prototype.readUInt32LE=function(e,t){return t||I(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},c.prototype.readUInt32BE=function(e,t){return t||I(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},c.prototype.readIntLE=function(e,t,n){e|=0,t|=0,n||I(e,t,this.length);for(var r=this[e],i=1,o=0;++o<t&&(i*=256);)r+=this[e+o]*i;return r>=(i*=128)&&(r-=Math.pow(2,8*t)),r},c.prototype.readIntBE=function(e,t,n){e|=0,t|=0,n||I(e,t,this.length);for(var r=t,i=1,o=this[e+--r];r>0&&(i*=256);)o+=this[e+--r]*i;return o>=(i*=128)&&(o-=Math.pow(2,8*t)),o},c.prototype.readInt8=function(e,t){return t||I(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},c.prototype.readInt16LE=function(e,t){t||I(e,2,this.length);var n=this[e]|this[e+1]<<8;return 32768&n?4294901760|n:n},c.prototype.readInt16BE=function(e,t){t||I(e,2,this.length);var n=this[e+1]|this[e]<<8;return 32768&n?4294901760|n:n},c.prototype.readInt32LE=function(e,t){return t||I(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},c.prototype.readInt32BE=function(e,t){return t||I(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},c.prototype.readFloatLE=function(e,t){return t||I(e,4,this.length),i.read(this,e,!0,23,4)},c.prototype.readFloatBE=function(e,t){return t||I(e,4,this.length),i.read(this,e,!1,23,4)},c.prototype.readDoubleLE=function(e,t){return t||I(e,8,this.length),i.read(this,e,!0,52,8)},c.prototype.readDoubleBE=function(e,t){return t||I(e,8,this.length),i.read(this,e,!1,52,8)},c.prototype.writeUIntLE=function(e,t,n,r){(e=+e,t|=0,n|=0,r)||N(this,e,t,n,Math.pow(2,8*n)-1,0);var i=1,o=0;for(this[t]=255&e;++o<n&&(i*=256);)this[t+o]=e/i&255;return t+n},c.prototype.writeUIntBE=function(e,t,n,r){(e=+e,t|=0,n|=0,r)||N(this,e,t,n,Math.pow(2,8*n)-1,0);var i=n-1,o=1;for(this[t+i]=255&e;--i>=0&&(o*=256);)this[t+i]=e/o&255;return t+n},c.prototype.writeUInt8=function(e,t,n){return e=+e,t|=0,n||N(this,e,t,1,255,0),c.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=255&e,t+1},c.prototype.writeUInt16LE=function(e,t,n){return e=+e,t|=0,n||N(this,e,t,2,65535,0),c.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):M(this,e,t,!0),t+2},c.prototype.writeUInt16BE=function(e,t,n){return e=+e,t|=0,n||N(this,e,t,2,65535,0),c.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):M(this,e,t,!1),t+2},c.prototype.writeUInt32LE=function(e,t,n){return e=+e,t|=0,n||N(this,e,t,4,4294967295,0),c.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e):D(this,e,t,!0),t+4},c.prototype.writeUInt32BE=function(e,t,n){return e=+e,t|=0,n||N(this,e,t,4,4294967295,0),c.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):D(this,e,t,!1),t+4},c.prototype.writeIntLE=function(e,t,n,r){if(e=+e,t|=0,!r){var i=Math.pow(2,8*n-1);N(this,e,t,n,i-1,-i)}var o=0,s=1,a=0;for(this[t]=255&e;++o<n&&(s*=256);)e<0&&0===a&&0!==this[t+o-1]&&(a=1),this[t+o]=(e/s>>0)-a&255;return t+n},c.prototype.writeIntBE=function(e,t,n,r){if(e=+e,t|=0,!r){var i=Math.pow(2,8*n-1);N(this,e,t,n,i-1,-i)}var o=n-1,s=1,a=0;for(this[t+o]=255&e;--o>=0&&(s*=256);)e<0&&0===a&&0!==this[t+o+1]&&(a=1),this[t+o]=(e/s>>0)-a&255;return t+n},c.prototype.writeInt8=function(e,t,n){return e=+e,t|=0,n||N(this,e,t,1,127,-128),c.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),e<0&&(e=255+e+1),this[t]=255&e,t+1},c.prototype.writeInt16LE=function(e,t,n){return e=+e,t|=0,n||N(this,e,t,2,32767,-32768),c.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):M(this,e,t,!0),t+2},c.prototype.writeInt16BE=function(e,t,n){return e=+e,t|=0,n||N(this,e,t,2,32767,-32768),c.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):M(this,e,t,!1),t+2},c.prototype.writeInt32LE=function(e,t,n){return e=+e,t|=0,n||N(this,e,t,4,2147483647,-2147483648),c.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):D(this,e,t,!0),t+4},c.prototype.writeInt32BE=function(e,t,n){return e=+e,t|=0,n||N(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),c.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):D(this,e,t,!1),t+4},c.prototype.writeFloatLE=function(e,t,n){return k(this,e,t,!0,n)},c.prototype.writeFloatBE=function(e,t,n){return k(this,e,t,!1,n)},c.prototype.writeDoubleLE=function(e,t,n){return U(this,e,t,!0,n)},c.prototype.writeDoubleBE=function(e,t,n){return U(this,e,t,!1,n)},c.prototype.copy=function(e,t,n,r){if(n||(n=0),r||0===r||(r=this.length),t>=e.length&&(t=e.length),t||(t=0),r>0&&r<n&&(r=n),r===n)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("sourceStart out of bounds");if(r<0)throw new RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),e.length-t<r-n&&(r=e.length-t+n);var i,o=r-n;if(this===e&&n<t&&t<r)for(i=o-1;i>=0;--i)e[i+t]=this[i+n];else if(o<1e3||!c.TYPED_ARRAY_SUPPORT)for(i=0;i<o;++i)e[i+t]=this[i+n];else Uint8Array.prototype.set.call(e,this.subarray(n,n+o),t);return o},c.prototype.fill=function(e,t,n,r){if("string"==typeof e){if("string"==typeof t?(r=t,t=0,n=this.length):"string"==typeof n&&(r=n,n=this.length),1===e.length){var i=e.charCodeAt(0);i<256&&(e=i)}if(void 0!==r&&"string"!=typeof r)throw new TypeError("encoding must be a string");if("string"==typeof r&&!c.isEncoding(r))throw new TypeError("Unknown encoding: "+r)}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<n)throw new RangeError("Out of range index");if(n<=t)return this;var o;if(t>>>=0,n=void 0===n?this.length:n>>>0,e||(e=0),"number"==typeof e)for(o=t;o<n;++o)this[o]=e;else{var s=c.isBuffer(e)?e:j(new c(e,r).toString()),a=s.length;for(o=0;o<n-t;++o)this[o+t]=s[o%a]}return this};var V=/[^+\/0-9A-Za-z-_]/g;function B(e){return e<16?"0"+e.toString(16):e.toString(16)}function j(e,t){var n;t=t||1/0;for(var r=e.length,i=null,o=[],s=0;s<r;++s){if((n=e.charCodeAt(s))>55295&&n<57344){if(!i){if(n>56319){(t-=3)>-1&&o.push(239,191,189);continue}if(s+1===r){(t-=3)>-1&&o.push(239,191,189);continue}i=n;continue}if(n<56320){(t-=3)>-1&&o.push(239,191,189),i=n;continue}n=65536+(i-55296<<10|n-56320)}else i&&(t-=3)>-1&&o.push(239,191,189);if(i=null,n<128){if((t-=1)<0)break;o.push(n)}else if(n<2048){if((t-=2)<0)break;o.push(n>>6|192,63&n|128)}else if(n<65536){if((t-=3)<0)break;o.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;o.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return o}function F(e){return r.toByteArray(function(e){if((e=function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}(e).replace(V,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function H(e,t,n,r){for(var i=0;i<r&&!(i+n>=t.length||i>=e.length);++i)t[i+n]=e[i];return i}}).call(this,n(12))},function(e,t,n){"use strict";t.byteLength=function(e){var t=u(e),n=t[0],r=t[1];return 3*(n+r)/4-r},t.toByteArray=function(e){var t,n,r=u(e),s=r[0],a=r[1],c=new o(function(e,t,n){return 3*(t+n)/4-n}(0,s,a)),l=0,d=a>0?s-4:s;for(n=0;n<d;n+=4)t=i[e.charCodeAt(n)]<<18|i[e.charCodeAt(n+1)]<<12|i[e.charCodeAt(n+2)]<<6|i[e.charCodeAt(n+3)],c[l++]=t>>16&255,c[l++]=t>>8&255,c[l++]=255&t;2===a&&(t=i[e.charCodeAt(n)]<<2|i[e.charCodeAt(n+1)]>>4,c[l++]=255&t);1===a&&(t=i[e.charCodeAt(n)]<<10|i[e.charCodeAt(n+1)]<<4|i[e.charCodeAt(n+2)]>>2,c[l++]=t>>8&255,c[l++]=255&t);return c},t.fromByteArray=function(e){for(var t,n=e.length,i=n%3,o=[],s=0,a=n-i;s<a;s+=16383)o.push(l(e,s,s+16383>a?a:s+16383));1===i?(t=e[n-1],o.push(r[t>>2]+r[t<<4&63]+"==")):2===i&&(t=(e[n-2]<<8)+e[n-1],o.push(r[t>>10]+r[t>>4&63]+r[t<<2&63]+"="));return o.join("")};for(var r=[],i=[],o="undefined"!=typeof Uint8Array?Uint8Array:Array,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",a=0,c=s.length;a<c;++a)r[a]=s[a],i[s.charCodeAt(a)]=a;function u(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=e.indexOf("=");return-1===n&&(n=t),[n,n===t?0:4-n%4]}function l(e,t,n){for(var i,o,s=[],a=t;a<n;a+=3)i=(e[a]<<16&16711680)+(e[a+1]<<8&65280)+(255&e[a+2]),s.push(r[(o=i)>>18&63]+r[o>>12&63]+r[o>>6&63]+r[63&o]);return s.join("")}i["-".charCodeAt(0)]=62,i["_".charCodeAt(0)]=63},function(e,t){
/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */
t.read=function(e,t,n,r,i){var o,s,a=8*i-r-1,c=(1<<a)-1,u=c>>1,l=-7,d=n?i-1:0,h=n?-1:1,p=e[t+d];for(d+=h,o=p&(1<<-l)-1,p>>=-l,l+=a;l>0;o=256*o+e[t+d],d+=h,l-=8);for(s=o&(1<<-l)-1,o>>=-l,l+=r;l>0;s=256*s+e[t+d],d+=h,l-=8);if(0===o)o=1-u;else{if(o===c)return s?NaN:1/0*(p?-1:1);s+=Math.pow(2,r),o-=u}return(p?-1:1)*s*Math.pow(2,o-r)},t.write=function(e,t,n,r,i,o){var s,a,c,u=8*o-i-1,l=(1<<u)-1,d=l>>1,h=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,p=r?0:o-1,f=r?1:-1,g=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,s=l):(s=Math.floor(Math.log(t)/Math.LN2),t*(c=Math.pow(2,-s))<1&&(s--,c*=2),(t+=s+d>=1?h/c:h*Math.pow(2,1-d))*c>=2&&(s++,c/=2),s+d>=l?(a=0,s=l):s+d>=1?(a=(t*c-1)*Math.pow(2,i),s+=d):(a=t*Math.pow(2,d-1)*Math.pow(2,i),s=0));i>=8;e[n+p]=255&a,p+=f,a/=256,i-=8);for(s=s<<i|a,u+=i;u>0;e[n+p]=255&s,p+=f,s/=256,u-=8);e[n+p-f]|=128*g}},function(e,t){var n={}.toString;e.exports=Array.isArray||function(e){return"[object Array]"==n.call(e)}},function(e,t,n){"use strict";e.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}},function(e,t,n){var r=n(8),i=n(22),o=n(46),s=n(47),a=i.DOMImplementation,c=r.NAMESPACE,u=s.ParseError,l=s.XMLReader;function d(e){return e.replace(/\r[\n\u0085]/g,"\n").replace(/[\r\u0085\u2028]/g,"\n")}function h(e){this.options=e||{locator:{}}}function p(){this.cdata=!1}function f(e,t){t.lineNumber=e.lineNumber,t.columnNumber=e.columnNumber}function g(e){if(e)return"\n@"+(e.systemId||"")+"#[line:"+e.lineNumber+",col:"+e.columnNumber+"]"}function m(e,t,n){return"string"==typeof e?e.substr(t,n):e.length>=t+n||t?new java.lang.String(e,t,n)+"":e}function b(e,t){e.currentElement?e.currentElement.appendChild(t):e.doc.appendChild(t)}h.prototype.parseFromString=function(e,t){var n=this.options,r=new l,i=n.domBuilder||new p,s=n.errorHandler,a=n.locator,u=n.xmlns||{},h=/\/x?html?$/.test(t),f=h?o.HTML_ENTITIES:o.XML_ENTITIES;a&&i.setDocumentLocator(a),r.errorHandler=function(e,t,n){if(!e){if(t instanceof p)return t;e=t}var r={},i=e instanceof Function;function o(t){var o=e[t];!o&&i&&(o=2==e.length?function(n){e(t,n)}:e),r[t]=o&&function(e){o("[xmldom "+t+"]\t"+e+g(n))}||function(){}}return n=n||{},o("warning"),o("error"),o("fatalError"),r}(s,i,a),r.domBuilder=n.domBuilder||i,h&&(u[""]=c.HTML),u.xml=u.xml||c.XML;var m=n.normalizeLineEndings||d;return e&&"string"==typeof e?r.parse(m(e),u,f):r.errorHandler.error("invalid doc source"),i.doc},p.prototype={startDocument:function(){this.doc=(new a).createDocument(null,null,null),this.locator&&(this.doc.documentURI=this.locator.systemId)},startElement:function(e,t,n,r){var i=this.doc,o=i.createElementNS(e,n||t),s=r.length;b(this,o),this.currentElement=o,this.locator&&f(this.locator,o);for(var a=0;a<s;a++){e=r.getURI(a);var c=r.getValue(a),u=(n=r.getQName(a),i.createAttributeNS(e,n));this.locator&&f(r.getLocator(a),u),u.value=u.nodeValue=c,o.setAttributeNode(u)}},endElement:function(e,t,n){var r=this.currentElement;r.tagName;this.currentElement=r.parentNode},startPrefixMapping:function(e,t){},endPrefixMapping:function(e){},processingInstruction:function(e,t){var n=this.doc.createProcessingInstruction(e,t);this.locator&&f(this.locator,n),b(this,n)},ignorableWhitespace:function(e,t,n){},characters:function(e,t,n){if(e=m.apply(this,arguments)){if(this.cdata)var r=this.doc.createCDATASection(e);else r=this.doc.createTextNode(e);this.currentElement?this.currentElement.appendChild(r):/^\s*$/.test(e)&&this.doc.appendChild(r),this.locator&&f(this.locator,r)}},skippedEntity:function(e){},endDocument:function(){this.doc.normalize()},setDocumentLocator:function(e){(this.locator=e)&&(e.lineNumber=0)},comment:function(e,t,n){e=m.apply(this,arguments);var r=this.doc.createComment(e);this.locator&&f(this.locator,r),b(this,r)},startCDATA:function(){this.cdata=!0},endCDATA:function(){this.cdata=!1},startDTD:function(e,t,n){var r=this.doc.implementation;if(r&&r.createDocumentType){var i=r.createDocumentType(e,t,n);this.locator&&f(this.locator,i),b(this,i),this.doc.doctype=i}},warning:function(e){console.warn("[xmldom warning]\t"+e,g(this.locator))},error:function(e){console.error("[xmldom error]\t"+e,g(this.locator))},fatalError:function(e){throw new u(e,this.locator)}},"endDTD,startEntity,endEntity,attributeDecl,elementDecl,externalEntityDecl,internalEntityDecl,resolveEntity,getExternalSubset,notationDecl,unparsedEntityDecl".replace(/\w+/g,(function(e){p.prototype[e]=function(){return null}})),t.__DOMHandler=p,t.normalizeLineEndings=d,t.DOMParser=h},function(e,t,n){var r=n(8).freeze;t.XML_ENTITIES=r({amp:"&",apos:"'",gt:">",lt:"<",quot:'"'}),t.HTML_ENTITIES=r({lt:"<",gt:">",amp:"&",quot:'"',apos:"'",Agrave:"",Aacute:"",Acirc:"",Atilde:"",Auml:"",Aring:"",AElig:"",Ccedil:"",Egrave:"",Eacute:"",Ecirc:"",Euml:"",Igrave:"",Iacute:"",Icirc:"",Iuml:"",ETH:"",Ntilde:"",Ograve:"",Oacute:"",Ocirc:"",Otilde:"",Ouml:"",Oslash:"",Ugrave:"",Uacute:"",Ucirc:"",Uuml:"",Yacute:"",THORN:"",szlig:"",agrave:"",aacute:"",acirc:"",atilde:"",auml:"",aring:"",aelig:"",ccedil:"",egrave:"",eacute:"",ecirc:"",euml:"",igrave:"",iacute:"",icirc:"",iuml:"",eth:"",ntilde:"",ograve:"",oacute:"",ocirc:"",otilde:"",ouml:"",oslash:"",ugrave:"",uacute:"",ucirc:"",uuml:"",yacute:"",thorn:"",yuml:"",nbsp:"",iexcl:"",cent:"",pound:"",curren:"",yen:"",brvbar:"",sect:"",uml:"",copy:"",ordf:"",laquo:"",not:"",shy:"",reg:"",macr:"",deg:"",plusmn:"",sup2:"",sup3:"",acute:"",micro:"",para:"",middot:"",cedil:"",sup1:"",ordm:"",raquo:"",frac14:"",frac12:"",frac34:"",iquest:"",times:"",divide:"",forall:"",part:"",exist:"",empty:"",nabla:"",isin:"",notin:"",ni:"",prod:"",sum:"",minus:"",lowast:"",radic:"",prop:"",infin:"",ang:"",and:"",or:"",cap:"",cup:"",int:"",there4:"",sim:"",cong:"",asymp:"",ne:"",equiv:"",le:"",ge:"",sub:"",sup:"",nsub:"",sube:"",supe:"",oplus:"",otimes:"",perp:"",sdot:"",Alpha:"",Beta:"",Gamma:"",Delta:"",Epsilon:"",Zeta:"",Eta:"",Theta:"",Iota:"",Kappa:"",Lambda:"",Mu:"",Nu:"",Xi:"",Omicron:"",Pi:"",Rho:"",Sigma:"",Tau:"",Upsilon:"",Phi:"",Chi:"",Psi:"",Omega:"",alpha:"",beta:"",gamma:"",delta:"",epsilon:"",zeta:"",eta:"",theta:"",iota:"",kappa:"",lambda:"",mu:"",nu:"",xi:"",omicron:"",pi:"",rho:"",sigmaf:"",sigma:"",tau:"",upsilon:"",phi:"",chi:"",psi:"",omega:"",thetasym:"",upsih:"",piv:"",OElig:"",oelig:"",Scaron:"",scaron:"",Yuml:"",fnof:"",circ:"",tilde:"",ensp:"",emsp:"",thinsp:"",zwnj:"",zwj:"",lrm:"",rlm:"",ndash:"",mdash:"",lsquo:"",rsquo:"",sbquo:"",ldquo:"",rdquo:"",bdquo:"",dagger:"",Dagger:"",bull:"",hellip:"",permil:"",prime:"",Prime:"",lsaquo:"",rsaquo:"",oline:"",euro:"",trade:"",larr:"",uarr:"",rarr:"",darr:"",harr:"",crarr:"",lceil:"",rceil:"",lfloor:"",rfloor:"",loz:"",spades:"",clubs:"",hearts:"",diams:""}),t.entityMap=t.HTML_ENTITIES},function(e,t,n){var r=n(8).NAMESPACE,i=/[A-Z_a-z\xC0-\xD6\xD8-\xF6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,o=new RegExp("[\\-\\.0-9"+i.source.slice(1,-1)+"\\u00B7\\u0300-\\u036F\\u203F-\\u2040]"),s=new RegExp("^"+i.source+o.source+"*(?::"+i.source+o.source+"*)?$");function a(e,t){this.message=e,this.locator=t,Error.captureStackTrace&&Error.captureStackTrace(this,a)}function c(){}function u(e,t){return t.lineNumber=e.lineNumber,t.columnNumber=e.columnNumber,t}function l(e,t,n,i,o,s){function a(e,t,r){n.attributeNames.hasOwnProperty(e)&&s.fatalError("Attribute "+e+" redefined"),n.addValue(e,t.replace(/[\t\n\r]/g," ").replace(/&#?\w+;/g,o),r)}for(var c,u=++t,l=0;;){var d=e.charAt(u);switch(d){case"=":if(1===l)c=e.slice(t,u),l=3;else{if(2!==l)throw new Error("attribute equal must after attrName");l=3}break;case"'":case'"':if(3===l||1===l){if(1===l&&(s.warning('attribute value must after "="'),c=e.slice(t,u)),t=u+1,!((u=e.indexOf(d,t))>0))throw new Error("attribute value no end '"+d+"' match");a(c,h=e.slice(t,u),t-1),l=5}else{if(4!=l)throw new Error('attribute value must after "="');a(c,h=e.slice(t,u),t),s.warning('attribute "'+c+'" missed start quot('+d+")!!"),t=u+1,l=5}break;case"/":switch(l){case 0:n.setTagName(e.slice(t,u));case 5:case 6:case 7:l=7,n.closed=!0;case 4:case 1:break;case 2:n.closed=!0;break;default:throw new Error("attribute invalid close char('/')")}break;case"":return s.error("unexpected end of input"),0==l&&n.setTagName(e.slice(t,u)),u;case">":switch(l){case 0:n.setTagName(e.slice(t,u));case 5:case 6:case 7:break;case 4:case 1:"/"===(h=e.slice(t,u)).slice(-1)&&(n.closed=!0,h=h.slice(0,-1));case 2:2===l&&(h=c),4==l?(s.warning('attribute "'+h+'" missed quot(")!'),a(c,h,t)):(r.isHTML(i[""])&&h.match(/^(?:disabled|checked|selected)$/i)||s.warning('attribute "'+h+'" missed value!! "'+h+'" instead!!'),a(h,h,t));break;case 3:throw new Error("attribute value missed!!")}return u;case"":d=" ";default:if(d<=" ")switch(l){case 0:n.setTagName(e.slice(t,u)),l=6;break;case 1:c=e.slice(t,u),l=2;break;case 4:var h=e.slice(t,u);s.warning('attribute "'+h+'" missed quot(")!!'),a(c,h,t);case 5:l=6}else switch(l){case 2:n.tagName;r.isHTML(i[""])&&c.match(/^(?:disabled|checked|selected)$/i)||s.warning('attribute "'+c+'" missed value!! "'+c+'" instead2!!'),a(c,c,t),t=u,l=1;break;case 5:s.warning('attribute space is required"'+c+'"!!');case 6:l=1,t=u;break;case 3:l=4,t=u;break;case 7:throw new Error("elements closed character '/' and '>' must be connected to")}}u++}}function d(e,t,n){for(var i=e.tagName,o=null,s=e.length;s--;){var a=e[s],c=a.qName,u=a.value;if((p=c.indexOf(":"))>0)var l=a.prefix=c.slice(0,p),d=c.slice(p+1),h="xmlns"===l&&d;else d=c,l=null,h="xmlns"===c&&"";a.localName=d,!1!==h&&(null==o&&(o={},f(n,n={})),n[h]=o[h]=u,a.uri=r.XMLNS,t.startPrefixMapping(h,u))}for(s=e.length;s--;){(l=(a=e[s]).prefix)&&("xml"===l&&(a.uri=r.XML),"xmlns"!==l&&(a.uri=n[l||""]))}var p;(p=i.indexOf(":"))>0?(l=e.prefix=i.slice(0,p),d=e.localName=i.slice(p+1)):(l=null,d=e.localName=i);var g=e.uri=n[l||""];if(t.startElement(g,d,i,e),!e.closed)return e.currentNSMap=n,e.localNSMap=o,!0;if(t.endElement(g,d,i),o)for(l in o)Object.prototype.hasOwnProperty.call(o,l)&&t.endPrefixMapping(l)}function h(e,t,n,r,i){if(/^(?:script|textarea)$/i.test(n)){var o=e.indexOf("</"+n+">",t),s=e.substring(t+1,o);if(/[&<]/.test(s))return/^script$/i.test(n)?(i.characters(s,0,s.length),o):(s=s.replace(/&#?\w+;/g,r),i.characters(s,0,s.length),o)}return t+1}function p(e,t,n,r){var i=r[n];return null==i&&((i=e.lastIndexOf("</"+n+">"))<t&&(i=e.lastIndexOf("</"+n)),r[n]=i),i<t}function f(e,t){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])}function g(e,t,n,r){switch(e.charAt(t+2)){case"-":return"-"===e.charAt(t+3)?(i=e.indexOf("--\x3e",t+4))>t?(n.comment(e,t+4,i-t-4),i+3):(r.error("Unclosed comment"),-1):-1;default:if("CDATA["==e.substr(t+3,6)){var i=e.indexOf("]]>",t+9);return n.startCDATA(),n.characters(e,t+9,i-t-9),n.endCDATA(),i+3}var o=function(e,t){var n,r=[],i=/'[^']+'|"[^"]+"|[^\s<>\/=]+=?|(\/?\s*>|<)/g;i.lastIndex=t,i.exec(e);for(;n=i.exec(e);)if(r.push(n),n[1])return r}(e,t),s=o.length;if(s>1&&/!doctype/i.test(o[0][0])){var a=o[1][0],c=!1,u=!1;s>3&&(/^public$/i.test(o[2][0])?(c=o[3][0],u=s>4&&o[4][0]):/^system$/i.test(o[2][0])&&(u=o[3][0]));var l=o[s-1];return n.startDTD(a,c,u),n.endDTD(),l.index+l[0].length}}return-1}function m(e,t,n){var r=e.indexOf("?>",t);if(r){var i=e.substring(t,r).match(/^<\?(\S*)\s*([\s\S]*?)\s*$/);if(i){i[0].length;return n.processingInstruction(i[1],i[2]),r+2}return-1}return-1}function b(){this.attributeNames={}}a.prototype=new Error,a.prototype.name=a.name,c.prototype={parse:function(e,t,n){var i=this.domBuilder;i.startDocument(),f(t,t={}),function(e,t,n,i,o){function s(e){var t=e.slice(1,-1);return Object.hasOwnProperty.call(n,t)?n[t]:"#"===t.charAt(0)?function(e){if(e>65535){var t=55296+((e-=65536)>>10),n=56320+(1023&e);return String.fromCharCode(t,n)}return String.fromCharCode(e)}(parseInt(t.substr(1).replace("x","0x"))):(o.error("entity not found:"+e),e)}function c(t){if(t>T){var n=e.substring(T,t).replace(/&#?\w+;/g,s);v&&f(T),i.characters(n,0,t-T),T=t}}function f(t,n){for(;t>=S&&(n=y.exec(e));)_=n.index,S=_+n[0].length,v.lineNumber++;v.columnNumber=t-_+1}var _=0,S=0,y=/.*(?:\r\n?|\n)|.*$/g,v=i.locator,E=[{currentNSMap:t}],C={},T=0;for(;;){try{var w=e.indexOf("<",T);if(w<0){if(!e.substr(T).match(/^\s*$/)){var A=i.doc,P=A.createTextNode(e.substr(T));A.appendChild(P),i.currentElement=P}return}switch(w>T&&c(w),e.charAt(w+1)){case"/":var O=e.indexOf(">",w+3),x=e.substring(w+2,O).replace(/[ \t\n\r]+$/g,""),R=E.pop();O<0?(x=e.substring(w+2).replace(/[\s<].*/,""),o.error("end tag name: "+x+" is not complete:"+R.tagName),O=w+1+x.length):x.match(/\s</)&&(x=x.replace(/[\s<].*/,""),o.error("end tag name: "+x+" maybe not complete"),O=w+1+x.length);var I=R.localNSMap,N=R.tagName==x;if(N||R.tagName&&R.tagName.toLowerCase()==x.toLowerCase()){if(i.endElement(R.uri,R.localName,x),I)for(var M in I)Object.prototype.hasOwnProperty.call(I,M)&&i.endPrefixMapping(M);N||o.fatalError("end tag name: "+x+" is not match the current start tagName:"+R.tagName)}else E.push(R);O++;break;case"?":v&&f(w),O=m(e,w,i);break;case"!":v&&f(w),O=g(e,w,i,o);break;default:v&&f(w);var D=new b,L=E[E.length-1].currentNSMap,k=(O=l(e,w,D,L,s,o),D.length);if(!D.closed&&p(e,O,D.tagName,C)&&(D.closed=!0,n.nbsp||o.warning("unclosed xml attribute")),v&&k){for(var U=u(v,{}),V=0;V<k;V++){var B=D[V];f(B.offset),B.locator=u(v,{})}i.locator=U,d(D,i,L)&&E.push(D),i.locator=v}else d(D,i,L)&&E.push(D);r.isHTML(D.uri)&&!D.closed?O=h(e,O,D.tagName,s,i):O++}}catch(e){if(e instanceof a)throw e;o.error("element parse error: "+e),O=-1}O>T?T=O:c(Math.max(w,T)+1)}}(e,t,n,i,this.errorHandler),i.endDocument()}},b.prototype={setTagName:function(e){if(!s.test(e))throw new Error("invalid tagName:"+e);this.tagName=e},addValue:function(e,t,n){if(!s.test(e))throw new Error("invalid attribute:"+e);this.attributeNames[e]=this.length,this[this.length++]={qName:e,value:t,offset:n}},length:0,getLocalName:function(e){return this[e].localName},getLocator:function(e){return this[e].locator},getQName:function(e){return this[e].qName},getURI:function(e){return this[e].uri},getValue:function(e){return this[e].value}},t.XMLReader=c,t.ParseError=a},function(e,t,n){var r,i,o;e.exports=(o=n(5),i=(r=o).lib.WordArray,r.enc.Base64={stringify:function(e){var t=e.words,n=e.sigBytes,r=this._map;e.clamp();for(var i=[],o=0;o<n;o+=3)for(var s=(t[o>>>2]>>>24-o%4*8&255)<<16|(t[o+1>>>2]>>>24-(o+1)%4*8&255)<<8|t[o+2>>>2]>>>24-(o+2)%4*8&255,a=0;a<4&&o+.75*a<n;a++)i.push(r.charAt(s>>>6*(3-a)&63));var c=r.charAt(64);if(c)for(;i.length%4;)i.push(c);return i.join("")},parse:function(e){var t=e.length,n=this._map,r=this._reverseMap;if(!r){r=this._reverseMap=[];for(var o=0;o<n.length;o++)r[n.charCodeAt(o)]=o}var s=n.charAt(64);if(s){var a=e.indexOf(s);-1!==a&&(t=a)}return function(e,t,n){for(var r=[],o=0,s=0;s<t;s++)if(s%4){var a=n[e.charCodeAt(s-1)]<<s%4*2,c=n[e.charCodeAt(s)]>>>6-s%4*2,u=a|c;r[o>>>2]|=u<<24-o%4*8,o++}return i.create(r,o)}(e,t,r)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="},o.enc.Base64)},function(e,t){},function(e,t,n){var r;e.exports=(r=n(5),r.enc.Utf8)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BUILD_DATE=void 0;t.BUILD_DATE="20241101"},function(e,t,n){var r;e.exports=(r=n(5),n(53),n(54),r.HmacSHA256)},function(e,t,n){var r;e.exports=(r=n(5),function(e){var t=r,n=t.lib,i=n.WordArray,o=n.Hasher,s=t.algo,a=[],c=[];!function(){function t(t){for(var n=e.sqrt(t),r=2;r<=n;r++)if(!(t%r))return!1;return!0}function n(e){return 4294967296*(e-(0|e))|0}for(var r=2,i=0;i<64;)t(r)&&(i<8&&(a[i]=n(e.pow(r,.5))),c[i]=n(e.pow(r,1/3)),i++),r++}();var u=[],l=s.SHA256=o.extend({_doReset:function(){this._hash=new i.init(a.slice(0))},_doProcessBlock:function(e,t){for(var n=this._hash.words,r=n[0],i=n[1],o=n[2],s=n[3],a=n[4],l=n[5],d=n[6],h=n[7],p=0;p<64;p++){if(p<16)u[p]=0|e[t+p];else{var f=u[p-15],g=(f<<25|f>>>7)^(f<<14|f>>>18)^f>>>3,m=u[p-2],b=(m<<15|m>>>17)^(m<<13|m>>>19)^m>>>10;u[p]=g+u[p-7]+b+u[p-16]}var _=r&i^r&o^i&o,S=(r<<30|r>>>2)^(r<<19|r>>>13)^(r<<10|r>>>22),y=h+((a<<26|a>>>6)^(a<<21|a>>>11)^(a<<7|a>>>25))+(a&l^~a&d)+c[p]+u[p];h=d,d=l,l=a,a=s+y|0,s=o,o=i,i=r,r=y+(S+_)|0}n[0]=n[0]+r|0,n[1]=n[1]+i|0,n[2]=n[2]+o|0,n[3]=n[3]+s|0,n[4]=n[4]+a|0,n[5]=n[5]+l|0,n[6]=n[6]+d|0,n[7]=n[7]+h|0},_doFinalize:function(){var t=this._data,n=t.words,r=8*this._nDataBytes,i=8*t.sigBytes;return n[i>>>5]|=128<<24-i%32,n[14+(i+64>>>9<<4)]=e.floor(r/4294967296),n[15+(i+64>>>9<<4)]=r,t.sigBytes=4*n.length,this._process(),this._hash},clone:function(){var e=o.clone.call(this);return e._hash=this._hash.clone(),e}});t.SHA256=o._createHelper(l),t.HmacSHA256=o._createHmacHelper(l)}(Math),r.SHA256)},function(e,t,n){var r,i,o,s;e.exports=(r=n(5),o=(i=r).lib.Base,s=i.enc.Utf8,void(i.algo.HMAC=o.extend({init:function(e,t){e=this._hasher=new e.init,"string"==typeof t&&(t=s.parse(t));var n=e.blockSize,r=4*n;t.sigBytes>r&&(t=e.finalize(t)),t.clamp();for(var i=this._oKey=t.clone(),o=this._iKey=t.clone(),a=i.words,c=o.words,u=0;u<n;u++)a[u]^=1549556828,c[u]^=909522486;i.sigBytes=o.sigBytes=r,this.reset()},reset:function(){var e=this._hasher;e.reset(),e.update(this._iKey)},update:function(e){return this._hasher.update(e),this},finalize:function(e){var t=this._hasher,n=t.finalize(e);return t.reset(),t.finalize(this._oKey.clone().concat(n))}})))},function(e,t,n){var r;e.exports=(r=n(5),r.enc.Latin1)},function(e,t,n){"use strict";n.r(t);var r={};n.r(r),n.d(r,"shimGetUserMedia",(function(){return S})),n.d(r,"shimGetDisplayMedia",(function(){return y})),n.d(r,"shimMediaStream",(function(){return v})),n.d(r,"shimOnTrack",(function(){return E})),n.d(r,"shimGetSendersWithDtmf",(function(){return C})),n.d(r,"shimGetStats",(function(){return T})),n.d(r,"shimSenderReceiverGetStats",(function(){return w})),n.d(r,"shimAddTrackRemoveTrackWithNative",(function(){return A})),n.d(r,"shimAddTrackRemoveTrack",(function(){return P})),n.d(r,"shimPeerConnection",(function(){return O})),n.d(r,"fixNegotiationNeeded",(function(){return x}));var i={};n.r(i),n.d(i,"shimGetUserMedia",(function(){return R})),n.d(i,"shimGetDisplayMedia",(function(){return I})),n.d(i,"shimOnTrack",(function(){return N})),n.d(i,"shimPeerConnection",(function(){return M})),n.d(i,"shimSenderGetStats",(function(){return D})),n.d(i,"shimReceiverGetStats",(function(){return L})),n.d(i,"shimRemoveStream",(function(){return k})),n.d(i,"shimRTCDataChannel",(function(){return U})),n.d(i,"shimAddTransceiver",(function(){return V})),n.d(i,"shimGetParameters",(function(){return B})),n.d(i,"shimCreateOffer",(function(){return j})),n.d(i,"shimCreateAnswer",(function(){return F}));var o={};n.r(o),n.d(o,"shimLocalStreamsAPI",(function(){return H})),n.d(o,"shimRemoteStreamsAPI",(function(){return G})),n.d(o,"shimCallbacksAPI",(function(){return q})),n.d(o,"shimGetUserMedia",(function(){return X})),n.d(o,"shimConstraints",(function(){return z})),n.d(o,"shimRTCIceServerUrls",(function(){return Y})),n.d(o,"shimTrackEventTransceiver",(function(){return W})),n.d(o,"shimCreateOfferLegacy",(function(){return J})),n.d(o,"shimAudioContext",(function(){return $}));var s={};n.r(s),n.d(s,"shimRTCIceCandidate",(function(){return Z})),n.d(s,"shimRTCIceCandidateRelayProtocol",(function(){return ee})),n.d(s,"shimMaxMessageSize",(function(){return te})),n.d(s,"shimSendThrowTypeError",(function(){return ne})),n.d(s,"shimConnectionState",(function(){return re})),n.d(s,"removeExtmapAllowMixed",(function(){return ie})),n.d(s,"shimAddIceCandidateNullOrEmpty",(function(){return oe})),n.d(s,"shimParameterlessSetLocalDescription",(function(){return se}));let a=!0,c=!0;function u(e,t,n){const r=e.match(t);return r&&r.length>=n&&parseInt(r[n],10)}function l(e,t,n){if(!e.RTCPeerConnection)return;const r=e.RTCPeerConnection.prototype,i=r.addEventListener;r.addEventListener=function(e,r){if(e!==t)return i.apply(this,arguments);const o=e=>{const t=n(e);t&&(r.handleEvent?r.handleEvent(t):r(t))};return this._eventMap=this._eventMap||{},this._eventMap[t]||(this._eventMap[t]=new Map),this._eventMap[t].set(r,o),i.apply(this,[e,o])};const o=r.removeEventListener;r.removeEventListener=function(e,n){if(e!==t||!this._eventMap||!this._eventMap[t])return o.apply(this,arguments);if(!this._eventMap[t].has(n))return o.apply(this,arguments);const r=this._eventMap[t].get(n);return this._eventMap[t].delete(n),0===this._eventMap[t].size&&delete this._eventMap[t],0===Object.keys(this._eventMap).length&&delete this._eventMap,o.apply(this,[e,r])},Object.defineProperty(r,"on"+t,{get(){return this["_on"+t]},set(e){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),e&&this.addEventListener(t,this["_on"+t]=e)},enumerable:!0,configurable:!0})}function d(e){return"boolean"!=typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(a=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function h(e){return"boolean"!=typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(c=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function p(){if("object"==typeof window){if(a)return;"undefined"!=typeof console&&"function"==typeof console.log&&console.log.apply(console,arguments)}}function f(e,t){c&&console.warn(e+" is deprecated, please use "+t+" instead.")}function g(e){return"[object Object]"===Object.prototype.toString.call(e)}function m(e){return g(e)?Object.keys(e).reduce((function(t,n){const r=g(e[n]),i=r?m(e[n]):e[n],o=r&&!Object.keys(i).length;return void 0===i||o?t:Object.assign(t,{[n]:i})}),{}):e}function b(e,t,n){const r=n?"outbound-rtp":"inbound-rtp",i=new Map;if(null===t)return i;const o=[];return e.forEach(e=>{"track"===e.type&&e.trackIdentifier===t.id&&o.push(e)}),o.forEach(t=>{e.forEach(n=>{n.type===r&&n.trackId===t.id&&function e(t,n,r){n&&!r.has(n.id)&&(r.set(n.id,n),Object.keys(n).forEach(i=>{i.endsWith("Id")?e(t,t.get(n[i]),r):i.endsWith("Ids")&&n[i].forEach(n=>{e(t,t.get(n),r)})}))}(e,n,i)})}),i}const _=p;function S(e,t){const n=e&&e.navigator;if(!n.mediaDevices)return;const r=function(e){if("object"!=typeof e||e.mandatory||e.optional)return e;const t={};return Object.keys(e).forEach(n=>{if("require"===n||"advanced"===n||"mediaSource"===n)return;const r="object"==typeof e[n]?e[n]:{ideal:e[n]};void 0!==r.exact&&"number"==typeof r.exact&&(r.min=r.max=r.exact);const i=function(e,t){return e?e+t.charAt(0).toUpperCase()+t.slice(1):"deviceId"===t?"sourceId":t};if(void 0!==r.ideal){t.optional=t.optional||[];let e={};"number"==typeof r.ideal?(e[i("min",n)]=r.ideal,t.optional.push(e),e={},e[i("max",n)]=r.ideal,t.optional.push(e)):(e[i("",n)]=r.ideal,t.optional.push(e))}void 0!==r.exact&&"number"!=typeof r.exact?(t.mandatory=t.mandatory||{},t.mandatory[i("",n)]=r.exact):["min","max"].forEach(e=>{void 0!==r[e]&&(t.mandatory=t.mandatory||{},t.mandatory[i(e,n)]=r[e])})}),e.advanced&&(t.optional=(t.optional||[]).concat(e.advanced)),t},i=function(e,i){if(t.version>=61)return i(e);if((e=JSON.parse(JSON.stringify(e)))&&"object"==typeof e.audio){const t=function(e,t,n){t in e&&!(n in e)&&(e[n]=e[t],delete e[t])};t((e=JSON.parse(JSON.stringify(e))).audio,"autoGainControl","googAutoGainControl"),t(e.audio,"noiseSuppression","googNoiseSuppression"),e.audio=r(e.audio)}if(e&&"object"==typeof e.video){let o=e.video.facingMode;o=o&&("object"==typeof o?o:{ideal:o});const s=t.version<66;if(o&&("user"===o.exact||"environment"===o.exact||"user"===o.ideal||"environment"===o.ideal)&&(!n.mediaDevices.getSupportedConstraints||!n.mediaDevices.getSupportedConstraints().facingMode||s)){let t;if(delete e.video.facingMode,"environment"===o.exact||"environment"===o.ideal?t=["back","rear"]:"user"!==o.exact&&"user"!==o.ideal||(t=["front"]),t)return n.mediaDevices.enumerateDevices().then(n=>{let s=(n=n.filter(e=>"videoinput"===e.kind)).find(e=>t.some(t=>e.label.toLowerCase().includes(t)));return!s&&n.length&&t.includes("back")&&(s=n[n.length-1]),s&&(e.video.deviceId=o.exact?{exact:s.deviceId}:{ideal:s.deviceId}),e.video=r(e.video),_("chrome: "+JSON.stringify(e)),i(e)})}e.video=r(e.video)}return _("chrome: "+JSON.stringify(e)),i(e)},o=function(e){return t.version>=64?e:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[e.name]||e.name,message:e.message,constraint:e.constraint||e.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(n.getUserMedia=function(e,t,r){i(e,e=>{n.webkitGetUserMedia(e,t,e=>{r&&r(o(e))})})}.bind(n),n.mediaDevices.getUserMedia){const e=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(t){return i(t,t=>e(t).then(e=>{if(t.audio&&!e.getAudioTracks().length||t.video&&!e.getVideoTracks().length)throw e.getTracks().forEach(e=>{e.stop()}),new DOMException("","NotFoundError");return e},e=>Promise.reject(o(e))))}}}function y(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&("function"==typeof t?e.navigator.mediaDevices.getDisplayMedia=function(n){return t(n).then(t=>{const r=n.video&&n.video.width,i=n.video&&n.video.height,o=n.video&&n.video.frameRate;return n.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:t,maxFrameRate:o||3}},r&&(n.video.mandatory.maxWidth=r),i&&(n.video.mandatory.maxHeight=i),e.navigator.mediaDevices.getUserMedia(n)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))}function v(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function E(e){if("object"==typeof e&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(e){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=e)},enumerable:!0,configurable:!0});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=t=>{t.stream.addEventListener("addtrack",n=>{let r;r=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(e=>e.track&&e.track.id===n.track.id):{track:n.track};const i=new Event("track");i.track=n.track,i.receiver=r,i.transceiver={receiver:r},i.streams=[t.stream],this.dispatchEvent(i)}),t.stream.getTracks().forEach(n=>{let r;r=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(e=>e.track&&e.track.id===n.id):{track:n};const i=new Event("track");i.track=n,i.receiver=r,i.transceiver={receiver:r},i.streams=[t.stream],this.dispatchEvent(i)})},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}else l(e,"track",e=>(e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e))}function C(e){if("object"==typeof e&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){const t=function(e,t){return{track:t,get dtmf(){return void 0===this._dtmf&&("audio"===t.kind?this._dtmf=e.createDTMFSender(t):this._dtmf=null),this._dtmf},_pc:e}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const n=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,r){let i=n.apply(this,arguments);return i||(i=t(this,e),this._senders.push(i)),i};const r=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){r.apply(this,arguments);const t=this._senders.indexOf(e);-1!==t&&this._senders.splice(t,1)}}const n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){this._senders=this._senders||[],n.apply(this,[e]),e.getTracks().forEach(e=>{this._senders.push(t(this,e))})};const r=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){this._senders=this._senders||[],r.apply(this,[e]),e.getTracks().forEach(e=>{const t=this._senders.find(t=>t.track===e);t&&this._senders.splice(this._senders.indexOf(t),1)})}}else if("object"==typeof e&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){const t=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach(e=>e._pc=this),e},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function T(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[e,n,r]=arguments;if(arguments.length>0&&"function"==typeof e)return t.apply(this,arguments);if(0===t.length&&(0===arguments.length||"function"!=typeof e))return t.apply(this,[]);const i=function(e){const t={};return e.result().forEach(e=>{const n={id:e.id,timestamp:e.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[e.type]||e.type};e.names().forEach(t=>{n[t]=e.stat(t)}),t[n.id]=n}),t},o=function(e){return new Map(Object.keys(e).map(t=>[t,e[t]]))};if(arguments.length>=2){const r=function(e){n(o(i(e)))};return t.apply(this,[r,e])}return new Promise((e,n)=>{t.apply(this,[function(t){e(o(i(t)))},n])}).then(n,r)}}function w(e){if(!("object"==typeof e&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver))return;if(!("getStats"in e.RTCRtpSender.prototype)){const t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach(e=>e._pc=this),e});const n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){const e=n.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){const e=this;return this._pc.getStats().then(t=>b(t,e.track,!0))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){const t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){const e=t.apply(this,[]);return e.forEach(e=>e._pc=this),e}),l(e,"track",e=>(e.receiver._pc=e.srcElement,e)),e.RTCRtpReceiver.prototype.getStats=function(){const e=this;return this._pc.getStats().then(t=>b(t,e.track,!1))}}if(!("getStats"in e.RTCRtpSender.prototype)||!("getStats"in e.RTCRtpReceiver.prototype))return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){const e=arguments[0];let t,n,r;return this.getSenders().forEach(n=>{n.track===e&&(t?r=!0:t=n)}),this.getReceivers().forEach(t=>(t.track===e&&(n?r=!0:n=t),t.track===e)),r||t&&n?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):t?t.getStats():n?n.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return t.apply(this,arguments)}}function A(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(e=>this._shimmedLocalStreams[e][0])};const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,n){if(!n)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const r=t.apply(this,arguments);return this._shimmedLocalStreams[n.id]?-1===this._shimmedLocalStreams[n.id].indexOf(r)&&this._shimmedLocalStreams[n.id].push(r):this._shimmedLocalStreams[n.id]=[n,r],r};const n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){this._shimmedLocalStreams=this._shimmedLocalStreams||{},e.getTracks().forEach(e=>{if(this.getSenders().find(t=>t.track===e))throw new DOMException("Track already exists.","InvalidAccessError")});const t=this.getSenders();n.apply(this,arguments);const r=this.getSenders().filter(e=>-1===t.indexOf(e));this._shimmedLocalStreams[e.id]=[e].concat(r)};const r=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[e.id],r.apply(this,arguments)};const i=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},e&&Object.keys(this._shimmedLocalStreams).forEach(t=>{const n=this._shimmedLocalStreams[t].indexOf(e);-1!==n&&this._shimmedLocalStreams[t].splice(n,1),1===this._shimmedLocalStreams[t].length&&delete this._shimmedLocalStreams[t]}),i.apply(this,arguments)}}function P(e,t){if(!e.RTCPeerConnection)return;if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return A(e);const n=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){const e=n.apply(this);return this._reverseStreams=this._reverseStreams||{},e.map(e=>this._reverseStreams[e.id])};const r=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(t){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},t.getTracks().forEach(e=>{if(this.getSenders().find(t=>t.track===e))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[t.id]){const n=new e.MediaStream(t.getTracks());this._streams[t.id]=n,this._reverseStreams[n.id]=t,t=n}r.apply(this,[t])};const i=e.RTCPeerConnection.prototype.removeStream;function o(e,t){let n=t.sdp;return Object.keys(e._reverseStreams||[]).forEach(t=>{const r=e._reverseStreams[t],i=e._streams[r.id];n=n.replace(new RegExp(i.id,"g"),r.id)}),new RTCSessionDescription({type:t.type,sdp:n})}function s(e,t){let n=t.sdp;return Object.keys(e._reverseStreams||[]).forEach(t=>{const r=e._reverseStreams[t],i=e._streams[r.id];n=n.replace(new RegExp(r.id,"g"),i.id)}),new RTCSessionDescription({type:t.type,sdp:n})}e.RTCPeerConnection.prototype.removeStream=function(e){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},i.apply(this,[this._streams[e.id]||e]),delete this._reverseStreams[this._streams[e.id]?this._streams[e.id].id:e.id],delete this._streams[e.id]},e.RTCPeerConnection.prototype.addTrack=function(t,n){if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const r=[].slice.call(arguments,1);if(1!==r.length||!r[0].getTracks().find(e=>e===t))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");const i=this.getSenders().find(e=>e.track===t);if(i)throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const o=this._streams[n.id];if(o)o.addTrack(t),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const r=new e.MediaStream([t]);this._streams[n.id]=r,this._reverseStreams[r.id]=n,this.addStream(r)}return this.getSenders().find(e=>e.track===t)},["createOffer","createAnswer"].forEach((function(t){const n=e.RTCPeerConnection.prototype[t],r={[t](){const e=arguments;return arguments.length&&"function"==typeof arguments[0]?n.apply(this,[t=>{const n=o(this,t);e[0].apply(null,[n])},t=>{e[1]&&e[1].apply(null,t)},arguments[2]]):n.apply(this,arguments).then(e=>o(this,e))}};e.RTCPeerConnection.prototype[t]=r[t]}));const a=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=s(this,arguments[0]),a.apply(this,arguments)):a.apply(this,arguments)};const c=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get(){const e=c.get.apply(this);return""===e.type?e:o(this,e)}}),e.RTCPeerConnection.prototype.removeTrack=function(e){if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!e._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(e._pc===this))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let t;this._streams=this._streams||{},Object.keys(this._streams).forEach(n=>{this._streams[n].getTracks().find(t=>e.track===t)&&(t=this._streams[n])}),t&&(1===t.getTracks().length?this.removeStream(this._reverseStreams[t.id]):t.removeTrack(e.track),this.dispatchEvent(new Event("negotiationneeded")))}}function O(e,t){!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection&&t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(t){const n=e.RTCPeerConnection.prototype[t],r={[t](){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}};e.RTCPeerConnection.prototype[t]=r[t]}))}function x(e,t){l(e,"negotiationneeded",e=>{const n=e.target;if(!(t.version<72||n.getConfiguration&&"plan-b"===n.getConfiguration().sdpSemantics)||"stable"===n.signalingState)return e})}function R(e,t){const n=e&&e.navigator,r=e&&e.MediaStreamTrack;if(n.getUserMedia=function(e,t,r){f("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(e).then(t,r)},!(t.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){const e=function(e,t,n){t in e&&!(n in e)&&(e[n]=e[t],delete e[t])},t=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(n){return"object"==typeof n&&"object"==typeof n.audio&&(n=JSON.parse(JSON.stringify(n)),e(n.audio,"autoGainControl","mozAutoGainControl"),e(n.audio,"noiseSuppression","mozNoiseSuppression")),t(n)},r&&r.prototype.getSettings){const t=r.prototype.getSettings;r.prototype.getSettings=function(){const n=t.apply(this,arguments);return e(n,"mozAutoGainControl","autoGainControl"),e(n,"mozNoiseSuppression","noiseSuppression"),n}}if(r&&r.prototype.applyConstraints){const t=r.prototype.applyConstraints;r.prototype.applyConstraints=function(n){return"audio"===this.kind&&"object"==typeof n&&(n=JSON.parse(JSON.stringify(n)),e(n,"autoGainControl","mozAutoGainControl"),e(n,"noiseSuppression","mozNoiseSuppression")),t.apply(this,[n])}}}}function I(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(n){if(!n||!n.video){const e=new DOMException("getDisplayMedia without video constraints is undefined");return e.name="NotFoundError",e.code=8,Promise.reject(e)}return!0===n.video?n.video={mediaSource:t}:n.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(n)})}function N(e){"object"==typeof e&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function M(e,t){if("object"!=typeof e||!e.RTCPeerConnection&&!e.mozRTCPeerConnection)return;!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(t){const n=e.RTCPeerConnection.prototype[t],r={[t](){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}};e.RTCPeerConnection.prototype[t]=r[t]}));const n={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},r=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[e,i,o]=arguments;return r.apply(this,[e||null]).then(e=>{if(t.version<53&&!i)try{e.forEach(e=>{e.type=n[e.type]||e.type})}catch(t){if("TypeError"!==t.name)throw t;e.forEach((t,r)=>{e.set(r,Object.assign({},t,{type:n[t.type]||t.type}))})}return e}).then(i,o)}}function D(e){if("object"!=typeof e||!e.RTCPeerConnection||!e.RTCRtpSender)return;if(e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)return;const t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach(e=>e._pc=this),e});const n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){const e=n.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function L(e){if("object"!=typeof e||!e.RTCPeerConnection||!e.RTCRtpSender)return;if(e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)return;const t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){const e=t.apply(this,[]);return e.forEach(e=>e._pc=this),e}),l(e,"track",e=>(e.receiver._pc=e.srcElement,e)),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function k(e){e.RTCPeerConnection&&!("removeStream"in e.RTCPeerConnection.prototype)&&(e.RTCPeerConnection.prototype.removeStream=function(e){f("removeStream","removeTrack"),this.getSenders().forEach(t=>{t.track&&e.getTracks().includes(t.track)&&this.removeTrack(t)})})}function U(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function V(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.addTransceiver;t&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let e=arguments[1]&&arguments[1].sendEncodings;void 0===e&&(e=[]),e=[...e];const n=e.length>0;n&&e.forEach(e=>{if("rid"in e){if(!/^[a-z0-9]{0,16}$/i.test(e.rid))throw new TypeError("Invalid RID value provided.")}if("scaleResolutionDownBy"in e&&!(parseFloat(e.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in e&&!(parseFloat(e.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const r=t.apply(this,arguments);if(n){const{sender:t}=r,n=t.getParameters();(!("encodings"in n)||1===n.encodings.length&&0===Object.keys(n.encodings[0]).length)&&(n.encodings=e,t.sendEncodings=e,this.setParametersPromises.push(t.setParameters(n).then(()=>{delete t.sendEncodings}).catch(()=>{delete t.sendEncodings})))}return r})}function B(e){if("object"!=typeof e||!e.RTCRtpSender)return;const t=e.RTCRtpSender.prototype.getParameters;t&&(e.RTCRtpSender.prototype.getParameters=function(){const e=t.apply(this,arguments);return"encodings"in e||(e.encodings=[].concat(this.sendEncodings||[{}])),e})}function j(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}function F(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}function H(e){if("object"==typeof e&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(e){this._localStreams||(this._localStreams=[]),this._localStreams.includes(e)||this._localStreams.push(e),e.getAudioTracks().forEach(n=>t.call(this,n,e)),e.getVideoTracks().forEach(n=>t.call(this,n,e))},e.RTCPeerConnection.prototype.addTrack=function(e,...n){return n&&n.forEach(e=>{this._localStreams?this._localStreams.includes(e)||this._localStreams.push(e):this._localStreams=[e]}),t.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){this._localStreams||(this._localStreams=[]);const t=this._localStreams.indexOf(e);if(-1===t)return;this._localStreams.splice(t,1);const n=e.getTracks();this.getSenders().forEach(e=>{n.includes(e.track)&&this.removeTrack(e)})})}}function G(e){if("object"==typeof e&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(e){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=e),this.addEventListener("track",this._onaddstreampoly=e=>{e.streams.forEach(e=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(e))return;this._remoteStreams.push(e);const t=new Event("addstream");t.stream=e,this.dispatchEvent(t)})})}});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){const e=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(t){t.streams.forEach(t=>{if(e._remoteStreams||(e._remoteStreams=[]),e._remoteStreams.indexOf(t)>=0)return;e._remoteStreams.push(t);const n=new Event("addstream");n.stream=t,e.dispatchEvent(n)})}),t.apply(e,arguments)}}}function q(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype,n=t.createOffer,r=t.createAnswer,i=t.setLocalDescription,o=t.setRemoteDescription,s=t.addIceCandidate;t.createOffer=function(e,t){const r=arguments.length>=2?arguments[2]:arguments[0],i=n.apply(this,[r]);return t?(i.then(e,t),Promise.resolve()):i},t.createAnswer=function(e,t){const n=arguments.length>=2?arguments[2]:arguments[0],i=r.apply(this,[n]);return t?(i.then(e,t),Promise.resolve()):i};let a=function(e,t,n){const r=i.apply(this,[e]);return n?(r.then(t,n),Promise.resolve()):r};t.setLocalDescription=a,a=function(e,t,n){const r=o.apply(this,[e]);return n?(r.then(t,n),Promise.resolve()):r},t.setRemoteDescription=a,a=function(e,t,n){const r=s.apply(this,[e]);return n?(r.then(t,n),Promise.resolve()):r},t.addIceCandidate=a}function X(e){const t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){const e=t.mediaDevices,n=e.getUserMedia.bind(e);t.mediaDevices.getUserMedia=e=>n(z(e))}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=function(e,n,r){t.mediaDevices.getUserMedia(e).then(n,r)}.bind(t))}function z(e){return e&&void 0!==e.video?Object.assign({},e,{video:m(e.video)}):e}function Y(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection;e.RTCPeerConnection=function(e,n){if(e&&e.iceServers){const t=[];for(let n=0;n<e.iceServers.length;n++){let r=e.iceServers[n];void 0===r.urls&&r.url?(f("RTCIceServer.url","RTCIceServer.urls"),r=JSON.parse(JSON.stringify(r)),r.urls=r.url,delete r.url,t.push(r)):t.push(e.iceServers[n])}e.iceServers=t}return new t(e,n)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in t&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:()=>t.generateCertificate})}function W(e){"object"==typeof e&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function J(e){const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(e){if(e){void 0!==e.offerToReceiveAudio&&(e.offerToReceiveAudio=!!e.offerToReceiveAudio);const t=this.getTransceivers().find(e=>"audio"===e.receiver.track.kind);!1===e.offerToReceiveAudio&&t?"sendrecv"===t.direction?t.setDirection?t.setDirection("sendonly"):t.direction="sendonly":"recvonly"===t.direction&&(t.setDirection?t.setDirection("inactive"):t.direction="inactive"):!0!==e.offerToReceiveAudio||t||this.addTransceiver("audio",{direction:"recvonly"}),void 0!==e.offerToReceiveVideo&&(e.offerToReceiveVideo=!!e.offerToReceiveVideo);const n=this.getTransceivers().find(e=>"video"===e.receiver.track.kind);!1===e.offerToReceiveVideo&&n?"sendrecv"===n.direction?n.setDirection?n.setDirection("sendonly"):n.direction="sendonly":"recvonly"===n.direction&&(n.setDirection?n.setDirection("inactive"):n.direction="inactive"):!0!==e.offerToReceiveVideo||n||this.addTransceiver("video",{direction:"recvonly"})}return t.apply(this,arguments)}}function $(e){"object"!=typeof e||e.AudioContext||(e.AudioContext=e.webkitAudioContext)}var K=n(3),Q=n.n(K);function Z(e){if(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)return;const t=e.RTCIceCandidate;e.RTCIceCandidate=function(e){if("object"==typeof e&&e.candidate&&0===e.candidate.indexOf("a=")&&((e=JSON.parse(JSON.stringify(e))).candidate=e.candidate.substring(2)),e.candidate&&e.candidate.length){const n=new t(e),r=Q.a.parseCandidate(e.candidate);for(const e in r)e in n||Object.defineProperty(n,e,{value:r[e]});return n.toJSON=function(){return{candidate:n.candidate,sdpMid:n.sdpMid,sdpMLineIndex:n.sdpMLineIndex,usernameFragment:n.usernameFragment}},n}return new t(e)},e.RTCIceCandidate.prototype=t.prototype,l(e,"icecandidate",t=>(t.candidate&&Object.defineProperty(t,"candidate",{value:new e.RTCIceCandidate(t.candidate),writable:"false"}),t))}function ee(e){!e.RTCIceCandidate||e.RTCIceCandidate&&"relayProtocol"in e.RTCIceCandidate.prototype||l(e,"icecandidate",e=>{if(e.candidate){const t=Q.a.parseCandidate(e.candidate.candidate);"relay"===t.type&&(e.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[t.priority>>24])}return e})}function te(e,t){if(!e.RTCPeerConnection)return;"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get(){return void 0===this._sctp?null:this._sctp}});const n=function(e){if(!e||!e.sdp)return!1;const t=Q.a.splitSections(e.sdp);return t.shift(),t.some(e=>{const t=Q.a.parseMLine(e);return t&&"application"===t.kind&&-1!==t.protocol.indexOf("SCTP")})},r=function(e){const t=e.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(null===t||t.length<2)return-1;const n=parseInt(t[1],10);return n!=n?-1:n},i=function(e){let n=65536;return"firefox"===t.browser&&(n=t.version<57?-1===e?16384:2147483637:t.version<60?57===t.version?65535:65536:2147483637),n},o=function(e,n){let r=65536;"firefox"===t.browser&&57===t.version&&(r=65535);const i=Q.a.matchPrefix(e.sdp,"a=max-message-size:");return i.length>0?r=parseInt(i[0].substring(19),10):"firefox"===t.browser&&-1!==n&&(r=2147483637),r},s=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,"chrome"===t.browser&&t.version>=76){const{sdpSemantics:e}=this.getConfiguration();"plan-b"===e&&Object.defineProperty(this,"sctp",{get(){return void 0===this._sctp?null:this._sctp},enumerable:!0,configurable:!0})}if(n(arguments[0])){const e=r(arguments[0]),t=i(e),n=o(arguments[0],e);let s;s=0===t&&0===n?Number.POSITIVE_INFINITY:0===t||0===n?Math.max(t,n):Math.min(t,n);const a={};Object.defineProperty(a,"maxMessageSize",{get:()=>s}),this._sctp=a}return s.apply(this,arguments)}}function ne(e){if(!e.RTCPeerConnection||!("createDataChannel"in e.RTCPeerConnection.prototype))return;function t(e,t){const n=e.send;e.send=function(){const r=arguments[0],i=r.length||r.size||r.byteLength;if("open"===e.readyState&&t.sctp&&i>t.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+t.sctp.maxMessageSize+" bytes)");return n.apply(e,arguments)}}const n=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){const e=n.apply(this,arguments);return t(e,this),e},l(e,"datachannel",e=>(t(e.channel,e.target),e))}function re(e){if(!e.RTCPeerConnection||"connectionState"in e.RTCPeerConnection.prototype)return;const t=e.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(e){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),e&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=e)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(e=>{const n=t[e];t[e]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=e=>{const t=e.target;if(t._lastConnectionState!==t.connectionState){t._lastConnectionState=t.connectionState;const n=new Event("connectionstatechange",e);t.dispatchEvent(n)}return e},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),n.apply(this,arguments)}})}function ie(e,t){if(!e.RTCPeerConnection)return;if("chrome"===t.browser&&t.version>=71)return;if("safari"===t.browser&&t.version>=605)return;const n=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(t){if(t&&t.sdp&&-1!==t.sdp.indexOf("\na=extmap-allow-mixed")){const n=t.sdp.split("\n").filter(e=>"a=extmap-allow-mixed"!==e.trim()).join("\n");e.RTCSessionDescription&&t instanceof e.RTCSessionDescription?arguments[0]=new e.RTCSessionDescription({type:t.type,sdp:n}):t.sdp=n}return n.apply(this,arguments)}}function oe(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const n=e.RTCPeerConnection.prototype.addIceCandidate;n&&0!==n.length&&(e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?("chrome"===t.browser&&t.version<78||"firefox"===t.browser&&t.version<68||"safari"===t.browser)&&arguments[0]&&""===arguments[0].candidate?Promise.resolve():n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function se(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const n=e.RTCPeerConnection.prototype.setLocalDescription;n&&0!==n.length&&(e.RTCPeerConnection.prototype.setLocalDescription=function(){let e=arguments[0]||{};if("object"!=typeof e||e.type&&e.sdp)return n.apply(this,arguments);if(e={type:e.type,sdp:e.sdp},!e.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":e.type="offer";break;default:e.type="answer"}if(e.sdp||"offer"!==e.type&&"answer"!==e.type)return n.apply(this,[e]);const t="offer"===e.type?this.createOffer:this.createAnswer;return t.apply(this).then(e=>n.apply(this,[e]))})}const ae=function({window:e}={},t={shimChrome:!0,shimFirefox:!0,shimSafari:!0}){const n=p,a=function(e){const t={browser:null,version:null};if(void 0===e||!e.navigator)return t.browser="Not a browser.",t;const{navigator:n}=e;if(n.mozGetUserMedia)t.browser="firefox",t.version=u(n.userAgent,/Firefox\/(\d+)\./,1);else if(n.webkitGetUserMedia||!1===e.isSecureContext&&e.webkitRTCPeerConnection)t.browser="chrome",t.version=u(n.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!e.RTCPeerConnection||!n.userAgent.match(/AppleWebKit\/(\d+)\./))return t.browser="Not a supported browser.",t;t.browser="safari",t.version=u(n.userAgent,/AppleWebKit\/(\d+)\./,1),t.supportsUnifiedPlan=e.RTCRtpTransceiver&&"currentDirection"in e.RTCRtpTransceiver.prototype}return t}(e),c={browserDetails:a,commonShim:s,extractVersion:u,disableLog:d,disableWarnings:h,sdp:K};switch(a.browser){case"chrome":if(!r||!O||!t.shimChrome)return n("Chrome shim is not included in this adapter release."),c;if(null===a.version)return n("Chrome shim can not determine version, not shimming."),c;n("adapter.js shimming chrome."),c.browserShim=r,oe(e,a),se(e),S(e,a),v(e),O(e,a),E(e),P(e,a),C(e),T(e),w(e),x(e,a),Z(e),ee(e),re(e),te(e,a),ne(e),ie(e,a);break;case"firefox":if(!i||!M||!t.shimFirefox)return n("Firefox shim is not included in this adapter release."),c;n("adapter.js shimming firefox."),c.browserShim=i,oe(e,a),se(e),R(e,a),M(e,a),N(e),k(e),D(e),L(e),U(e),V(e),B(e),j(e),F(e),Z(e),re(e),te(e,a),ne(e);break;case"safari":if(!o||!t.shimSafari)return n("Safari shim is not included in this adapter release."),c;n("adapter.js shimming safari."),c.browserShim=o,oe(e,a),se(e),Y(e),J(e),q(e),H(e),G(e),W(e),X(e),$(e),Z(e),ee(e),te(e,a),ne(e),ie(e,a);break;default:n("Unsupported browser!")}return c}({window:"undefined"==typeof window?void 0:window});t.default=ae}])}));